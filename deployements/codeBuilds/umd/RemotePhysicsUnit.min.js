//lcb-powder-sim UMD - v1.0.2
"use strict";function loopCore(){if(isLoopStarted){const S=performance.now();for(timeAcc+=S-lastTime,lastTime=S;timeAcc>=PHYSICS_DELAY;)step(),timeAcc-=PHYSICS_DELAY;setTimeout(loopCore,0)}}function startLoop(){isLoopStarted||(isLoopStarted=!0,loopCore())}function stopLoop(){isLoopStarted&&(isLoopStarted=!1,pixels.buffer.byteLength&&postMessage({type:WORKER_MESSAGE_TYPES.PIXELS,pixels:pixels,pxStates:pxStates},[pixels.buffer,pxStates.buffer]))}function step(){pixels.buffer.byteLength&&(lastStepTime=performance.now(),physicsCore.step(pixels,pxStepUpdated,pxStates,sidePriority,mapWidth,mapHeight,MATERIALS,MATERIAL_GROUPS,D,MATERIAL_STATES,MATERIAL_STATES_GROUPS,SIDE_PRIORITIES),postMessage({type:WORKER_MESSAGE_TYPES.STEP,pixels:pixels,pxStates:pxStates},[pixels.buffer,pxStates.buffer]))}importScripts("./lcbPS.min.js"),self.lcbPS&&(self.SETTINGS=self.lcbPS.SETTINGS,self.PhysicsCore=self.lcbPS.PhysicsCore);const WORKER_MESSAGE_TYPES=SETTINGS.WORKER_MESSAGE_TYPES,WORKER_MESSAGE_GROUPS=SETTINGS.WORKER_MESSAGE_GROUPS,MATERIALS=SETTINGS.MATERIALS,MATERIAL_GROUPS=SETTINGS.MATERIAL_GROUPS,MATERIAL_STATES=SETTINGS.MATERIAL_STATES,MATERIAL_STATES_GROUPS=SETTINGS.MATERIAL_STATES_GROUPS,SIDE_PRIORITIES=SETTINGS.SIDE_PRIORITIES,D=SETTINGS.D,physicsCore=new PhysicsCore;let pixels,pxStepUpdated,pxStates,sidePriority,mapWidth,mapHeight,isLoopStarted=!1,lastTime=0,lastStepTime=0,PHYSICS_DELAY=1e3/60,timeAcc=0;self.onmessage=S=>{const e=S.data,t=e.type;t&WORKER_MESSAGE_GROUPS.GIVES_PIXELS_TO_WORKER&&(pixels=e.pixels,pxStates=e.pxStates),t===WORKER_MESSAGE_TYPES.STEP||t===WORKER_MESSAGE_TYPES.PIXELS&&performance.now()-lastStepTime>PHYSICS_DELAY?step():t===WORKER_MESSAGE_TYPES.START_LOOP?startLoop():t===WORKER_MESSAGE_TYPES.STOP_LOOP?stopLoop():t===WORKER_MESSAGE_TYPES.SIDE_PRIORITY?sidePriority=e.sidePriority:t===WORKER_MESSAGE_TYPES.MAP_SIZE?(mapWidth=e.mapWidth,mapHeight=e.mapHeight,pxStepUpdated=new Uint8Array(e.arraySize),pxStates=new Uint8Array(e.arraySize)):t===WORKER_MESSAGE_TYPES.INIT&&(PHYSICS_DELAY=1e3/e.aimedFps,pixels=e.pixels,pxStepUpdated=e.pxStepUpdated,pxStates=e.pxStates,sidePriority=e.sidePriority,mapWidth=e.mapWidth,mapHeight=e.mapHeight)};