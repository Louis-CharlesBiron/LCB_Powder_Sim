#!/usr/bin/env node
import{mkdirSync,copyFileSync,writeFileSync}from"fs";import{join,dirname}from"path";import{fileURLToPath}from"url";import{createInterface}from"readline";import{exec}from"child_process";import{createRequire}from"module";const PARAM=process.argv[2]?process.argv[2].startsWith("-")?process.argv[2].replace("-",""):process.argv[2]:"",DEST=join(process.cwd(),PARAM),PACKAGE_NAME=createRequire(import.meta.url)("../package.json").name,LIB_FOLDER_DEST=join(DEST,PACKAGE_NAME),LIB_FILE_NAMES=["lcbPS.min.js","RemotePhysicsUnit.min.js"],LIB_SRC_PATH=join(dirname(fileURLToPath(import.meta.url)),"../umd/");try{mkdirSync(DEST,{recursive:!0}),mkdirSync(LIB_FOLDER_DEST,{recursive:!0})}catch{}copyFileSync(LIB_SRC_PATH+LIB_FILE_NAMES[0],join(LIB_FOLDER_DEST,LIB_FILE_NAMES[0])),copyFileSync(LIB_SRC_PATH+LIB_FILE_NAMES[1],join(LIB_FOLDER_DEST,LIB_FILE_NAMES[1])),writeFileSync(join(DEST,"index.html"),`\n<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>LCB Powder Simulation | UMD Template</title>\n  <link rel="stylesheet" href="index.css">\n</head>\n  <body>\n    <canvas id="simulationCanvasId"></canvas>\n\n    <script src="${join(PACKAGE_NAME,LIB_FILE_NAMES[0])}"><\/script>\n    <script src="index.js"><\/script>\n  </body>\n</html>\n`.trim()),writeFileSync(join(DEST,"index.css"),"\nhtml, body {\n    width: 100%;\n    height: 100%;\n    background-color: black;\n    color: aliceblue;\n    overflow: hidden;\n    margin: 0;\n    padding: 0;\n}".trim()),writeFileSync(join(DEST,"index.js"),'\nconst {Simulation} = lcbPS\n\n// Creating the powder simulation\nconst simulation = new Simulation(\n    document.getElementById("simulationCanvasId"),\n    onSimulationReady,\n    {\n        usesWebWorkers: true,\n        autoStart: true,\n        aimedFPS: 60,\n    },\n    {\n        autoSimulationSizing: true,\n        showBorder: true,\n        showGrid: true,\n        visualEffectsEnabled: true,\n    }\n)\n\n// Function that runs when the simulation is loaded\nfunction onSimulationReady(simulation) {\n    console.log("The simulation is ready!")\n}\n'.trim()),console.log("LCB Powder Simulator: Browser project template successfully created at '"+DEST+"'!\n");const cli=createInterface({input:process.stdin,output:process.stdout});cli.question("Open in explorer [Y/N]?  ",value=>{const v=value?.toLowerCase()?.trim();["code","c"].includes(v)?exec("code --new-window "+DEST):v&&!["y","yes","ye","ok","for sure"].includes(v)||exec("explorer "+DEST),cli.close()}),process.stdin.on("keypress",(_,key)=>{"escape"==key.name&&cli.close()});