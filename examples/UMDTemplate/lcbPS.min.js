//lcb-powder-sim UMD - v1.0.0
!function(t){"undefined"==typeof window&&(["DOMParser","IntersectionObserver","HTMLVideoElement","HTMLAudioElement","SVGImageElement","HTMLImageElement","HTMLCanvasElement","document"].forEach(t=>self[t]=class{constructor(){}}),self.window={}),"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():self.lcbPS=t()}(function(){"use strict";class t{static DEFAULT_ACCEPTABLE_DIFFERENCE=1e-7;static CIRC=2*Math.PI;static TO_DEGREES=Math.PI/180;static getLast(t,e=0){return t[t.length-1-e]}static addAt(t,e,i=0){return t.slice(0,i).concat(e,t.slice(i))}static random(t,e,i=0){if(e+=i?0:1,i){const s=10**i;return Math.round((Math.random()*(e-t)+t)*s)/s}return Math.random()*(e-t)+t|0}static truncateDecimals(t,e=6){const i=10**e;return Math.trunc(t*i)/i}static clamp(t,e=-Infinity,i=Infinity){return t<e?e:t>i?i:t}static avg(t){let e=t.length,i=0;for(let s=0;s<e;s++)i+=t[s];return i/e}static normalize(t,e,i){return(t-e)/(i-e)}static ccw(t,e,i){return(i[1]-t[1])*(e[0]-t[0])>(e[1]-t[1])*(i[0]-t[0])}static ccw_coords(t,e,i,s,r,n){return(n-e)*(i-t)>(s-e)*(r-t)}static hasLinearIntersection(e,i,s,r){const n=t.ccw_coords,a=e[0],o=e[1],h=i[0],l=i[1],_=s[0],u=s[1],c=r[0],E=r[1];return n(a,o,_,u,c,E)!=n(h,l,_,u,c,E)&&n(a,o,h,l,_,u)!=n(a,o,h,l,c,E)}static noDelayInterval(t,e){return e(),setInterval(e,t)}static isDefined(t){return null!=t}static isFunction(t){return"function"==typeof t}static round(t,e=0){const i=10**e;return Math.round(t*i)/i}static fade(t,e=0,i=0,s=5){return s-=i,e%2?i+s*(1-t):i+s*t}static getRatio(e,i,s=100){let r=e.pos||e,n=i.pos||i;return Math.min(1,t.getDist(r[0],r[1],n[0],n[1])/s)}static getNearestDots(e,i=e.parent){let s=i.dots,r=s.length,n=e.x,a=e.y,o=[];for(let i=0;i<r;i++){const r=s[i];r.id!=e.id&&o.push([r,t.getDist(n,a,r.pos[0],r.pos[1])])}return o.toSorted((t,e)=>t[1]-e[1])}static getRegulationCB(t,e=1e3){let i;return(...s)=>{clearTimeout(i),i=setTimeout(()=>t(...s),e)}}static noTimeoutInterval(t,e=1e3){return t(),setInterval(t,e)}static unlinkArr2(t){return[t[0],t[1]]}static unlinkArr3(t){return[t[0],t[1],t[2]]}static unlinkPositions(e){const i=Array.isArray,s=t.unlinkArr2,r=e?.[0],n=e?.[1];return i(e)?[i(r)?s(r):r,i(n)?s(n):n]:e}static rotatePos(e=[0,0],i=0,s=[0,0]){const r=t.toRad(i),n=Math.cos(r),a=Math.sin(r),o=e[0]-s[0],h=e[1]-s[1];return[o*n-h*a+s[0],o*a+h*n+s[1]]}static scalePos(t=[0,0],e=[1,1],i=[0,0]){const s=t[0]-i[0],r=t[1]-i[1];return[s*e[0]+i[0],r*e[1]+i[1]]}static getPositionsCenter(t){return[(t[0][0]+t[1][0])/2,(t[0][1]+t[1][1])/2]}static getDist(t,e,i,s){const r=t-i,n=e-s;return Math.sqrt(r*r+n*n)}static getDist_pos(t,e){const i=t[0]-e[0],s=t[1]-e[1];return Math.sqrt(i*i+s*s)}static getLinearFn(t,e){const i=(e[1]-t[1])/(e[0]-t[0]),s=-i*t[0]+t[1];return[i,s,t=>i*t+s,t]}static getLinearFn_coords(t,e,i,s){const r=(s-e)/(i-t),n=-r*t+e;return[r,n,t=>r*t+n,[t,e]]}static getPerpendicularLinearFn(t){const e=-1/t[0],i=t[3],s=-e*i[0]+i[1];return[e,s,t=>e*t+s,i]}static getValueFromRange(e){return Array.isArray(e)?t.random(e[0],e[1]):e}static arrayEquals(t,e){return t.length===e.length&&t.every((t,i)=>t==e[i])}static addPos(t,e){return[(t[0]||0)+(e[0]||0),(t[1]||0)+(e[1]||0)]}static subPos(t,e){return[(t[0]||0)-(e[0]||0),(t[1]||0)-(e[1]||0)]}static mulPos(t,e){return[(t[0]||0)*(e[0]||0),(t[1]||0)*(e[1]||0)]}static divPos(t,e){return[(t[0]||0)/(e[0]||0),(t[1]||0)/(e[1]||0)]}static posEquals(t,e){return e&&t&&t[0]==e[0]&&t[1]==e[1]}static positionsEquals(t,e){return t&&e&&t[0][0]==e[0][0]&&t[0][1]==e[0][1]&&t[1][0]==e[1][0]&&t[1][1]==e[1][1]}static mod(t,e,i=t){return t-e*i-(i<0)*t}static toRad(e){return e*t.TO_DEGREES}static toDeg(e){return e/t.TO_DEGREES}static getAcceptableDiff(e,i=t.DEFAULT_ACCEPTABLE_DIFFERENCE){const s=Math.round(e);return s-e<=i?s:e}static getMinMax(t,e=null){let i=Infinity,s=-Infinity,r=t.length;for(let n=0;n<r;n++){const r=e?+t[n][e]:t[n];r<i&&(i=r),r>s&&(s=r)}return[i,s]}static repeatedTimeout(t,e,i=5){let s=0;for(let r=0;r<t;r++)setTimeout(()=>e(r),s+=i)}static stackTraceLog(...t){try{throw new Error("stackTraceLog")}catch(e){console.log(e,...t)}}}class e{static COMMON_REFRESH_RATES=[30,60,75,90,120,144,165,240,360,480,500];static ABNORMAL_FLUCTUATION_THRESHOLD=20;constructor(t){this._averageSampleSize=t||10,this._times=[],this._averageSample=[],this._maxFps=0}getFpsRaw(){let t,e=performance.now();for(;this._times.length&&this._times[0]<=e-1e3;)this._times.shift();return t=this._times.push(e),this._maxFps<t&&(this._maxFps=t),t}getFps(){const e=this._averageSample;return e.push(this.getFpsRaw()),e.length>this._averageSampleSize&&e.shift(),0|Math.min(t.avg(e),this._maxFps)}getApproximatedUserRefreshRate(t=this.maxFps){return performance.now()>1e3?e.COMMON_REFRESH_RATES.reduce((e,i)=>e<t-1?i:e,null):null}getRecommendedFPS(t=!0,i=8){if(performance.now()>1e3){const s=e.COMMON_REFRESH_RATES,r=this._averageSample.reduce((t,e)=>t+e,0)/this._averageSampleSize;return r&&t?s[s.indexOf(s.reduce((t,e)=>t<r+i?e:t,null))-1]||s[0]:this.getApproximatedUserRefreshRate(r)}return null}runRecommendedFPSEvaluation(e,i=1e4,s=10,r=!0,n=8){s=s?s|=0:10,i<s&&(i=s);const a=i/s,o=[];for(let s=a;s<=i;s+=a)setTimeout(()=>{if(o.push(this.getRecommendedFPS(r,n)),s>=i&&t.isFunction(e)){const[i,s]=t.getMinMax(o),r=t.avg(o),a=this.getApproximatedUserRefreshRate(r-n);e({recommendedValue:a,stats:{rawResults:o,min:i,max:s,avg:r}})}},1e3+s)}[Symbol.toPrimitive](){return this.getFps()}*[Symbol.iterator](){const t=this._times,e=t.length;for(let i=0;i<e;i++)yield t[i]}get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"FPSCounter"}get maxFps(){return this._maxFps-1}get averageSampleSize(){return this._averageSampleSize}get fpsRaw(){return this._times.length}set averageSampleSize(t){this._averageSampleSize=t}}class i{static DEFAULT_COLOR="aliceblue";static DEFAULT_RGBA=[240,248,255,1];static DEFAULT_COLOR_VALUE="rgba(240, 248, 255, 1)";static CSS_COLOR_TO_RGBA_CONVERTIONS={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],grey:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightsteelblue:[176,224,230,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};static RGBA_TO_CSS_COLOR_CONVERTIONS={"0,0,0,0":"transparent","240,248,255,1":"aliceblue","250,235,215,1":"antiquewhite","0,255,255,1":"aqua","127,255,212,1":"aquamarine","240,255,255,1":"azure","245,245,220,1":"beige","255,228,196,1":"bisque","0,0,0,1":"black","255,235,205,1":"blanchedalmond","0,0,255,1":"blue","138,43,226,1":"blueviolet","165,42,42,1":"brown","222,184,135,1":"burlywood","95,158,160,1":"cadetblue","127,255,0,1":"chartreuse","210,105,30,1":"chocolate","255,127,80,1":"coral","100,149,237,1":"cornflowerblue","255,248,220,1":"cornsilk","220,20,60,1":"crimson","0,0,139,1":"darkblue","0,139,139,1":"darkcyan","184,134,11,1":"darkgoldenrod","169,169,169,1":"darkgray","0,100,0,1":"darkgreen","189,183,107,1":"darkkhaki","139,0,139,1":"darkmagenta","85,107,47,1":"darkolivegreen","255,140,0,1":"darkorange","153,50,204,1":"darkorchid","139,0,0,1":"darkred","233,150,122,1":"darksalmon","143,188,143,1":"darkseagreen","72,61,139,1":"darkslateblue","47,79,79,1":"darkslategray","0,206,209,1":"darkturquoise","148,0,211,1":"darkviolet","255,20,147,1":"deeppink","0,191,255,1":"deepskyblue","105,105,105,1":"dimgray","30,144,255,1":"dodgerblue","178,34,34,1":"firebrick","255,250,240,1":"floralwhite","34,139,34,1":"forestgreen","220,220,220,1":"gainsboro","248,248,255,1":"ghostwhite","255,215,0,1":"gold","218,165,32,1":"goldenrod","128,128,128,1":"gray","0,128,0,1":"green","173,255,47,1":"greenyellow","240,255,240,1":"honeydew","255,105,180,1":"hotpink","205,92,92,1":"indianred","75,0,130,1":"indigo","255,255,240,1":"ivory","240,230,140,1":"khaki","230,230,250,1":"lavender","255,240,245,1":"lavenderblush","124,252,0,1":"lawngreen","255,250,205,1":"lemonchiffon","173,216,230,1":"lightblue","240,128,128,1":"lightcoral","224,255,255,1":"lightcyan","250,250,210,1":"lightgoldenrodyellow","211,211,211,1":"lightgray","144,238,144,1":"lightgreen","255,182,193,1":"lightpink","255,160,122,1":"lightsalmon","32,178,170,1":"lightseagreen","135,206,250,1":"lightskyblue","119,136,153,1":"lightslategray","176,224,230,1":"lightsteelblue","255,255,224,1":"lightyellow","0,255,0,1":"lime","50,205,50,1":"limegreen","250,240,230,1":"linen","255,0,255,1":"magenta","128,0,0,1":"maroon","102,205,170,1":"mediumaquamarine","0,0,205,1":"mediumblue","186,85,211,1":"mediumorchid","147,112,219,1":"mediumpurple","60,179,113,1":"mediumseagreen","123,104,238,1":"mediumslateblue","0,250,154,1":"mediumspringgreen","72,209,204,1":"mediumturquoise","199,21,133,1":"mediumvioletred","25,25,112,1":"midnightblue","245,255,250,1":"mintcream","255,228,225,1":"mistyrose","255,228,181,1":"moccasin","255,222,173,1":"navajowhite","0,0,128,1":"navy","253,245,230,1":"oldlace","128,128,0,1":"olive","107,142,35,1":"olivedrab","255,165,0,1":"orange","255,69,0,1":"orangered","218,112,214,1":"orchid","238,232,170,1":"palegoldenrod","152,251,152,1":"palegreen","175,238,238,1":"paleturquoise","219,112,147,1":"palevioletred","255,239,213,1":"papayawhip","255,218,185,1":"peachpuff","205,133,63,1":"peru","255,192,203,1":"pink","221,160,221,1":"plum","128,0,128,1":"purple","102,51,153,1":"rebeccapurple","255,0,0,1":"red","188,143,143,1":"rosybrown","65,105,225,1":"royalblue","139,69,19,1":"saddlebrown","250,128,114,1":"salmon","244,164,96,1":"sandybrown","46,139,87,1":"seagreen","255,245,238,1":"seashell","160,82,45,1":"sienna","192,192,192,1":"silver","135,206,235,1":"skyblue","106,90,205,1":"slateblue","112,128,144,1":"slategray","255,250,250,1":"snow","0,255,127,1":"springgreen","70,130,180,1":"steelblue","210,180,140,1":"tan","0,128,128,1":"teal","216,191,216,1":"thistle","255,99,71,1":"tomato","64,224,208,1":"turquoise","238,130,238,1":"violet","245,222,179,1":"wheat","255,255,255,1":"white","245,245,245,1":"whitesmoke","255,255,0,1":"yellow","154,205,50,1":"yellowgreen"};static FORMATS={RGBA:"RGBA",TEXT:"TEXT",HEX:"HEX",GRADIENT:"GRADIENT",PATTERN:"PATTERN",COLOR:"COLOR",HSV:"HSVA"};static CONVERTABLE_FORMATS={RGBA:"RGBA",TEXT:"TEXT",HEX:"HEX",HSV:"HSVA"};static STRICT_FORMATS={RGBA:"RGBA",COLOR:"COLOR"};static DEFAULT_TEMPERANCE=0;static SEARCH_STARTS={TOP_LEFT:"TOP_LEFT",BOTTOM_RIGHT:"BOTTOM_RIGHT"};static DEFAULT_SEARCH_START=i.SEARCH_STARTS.TOP_LEFT;static DEFAULT_DECIMAL_ROUNDING_POINT=3;static OPACITY_VISIBILITY_THRESHOLD=.029;#t=null;#e=null;constructor(t,e=!1){const s=i.getFormat(t);this._color=t instanceof i?t._color:s&&t||i.DEFAULT_COLOR,this._format=s||i.getFormat(this._color),this.#i(),this._isChannel=e||!1}#i(){const e=i.FORMATS,s=this._format;if(s==e.GRADIENT||s==e.PATTERN)this.#t=this.#e=[];else{this.#t=s!=e.RGBA?this.convertTo():i.#s(this._color);const r=this.#t,n=i.DEFAULT_DECIMAL_ROUNDING_POINT,a=t.round,o=r[3];r[0]=a(r[0],n),r[1]=a(r[1],n),r[2]=a(r[2],n),r[3]=null!=o?a(o,n):1,this.#e=i.convertTo(r,e.HSV)}}static convertTo(t,e=i.CONVERTABLE_FORMATS.RGBA){let s=i.getFormat(t),r=t,n=i.CONVERTABLE_FORMATS,a=n.RGBA,o=n.HEX,h=n.TEXT,l=n.HSV;return s&&(e==a?s==o?r=i.#r(t):s==h?r=i.#s(i.CSS_COLOR_TO_RGBA_CONVERTIONS[t]):s==l&&(r=i.#n(t)):e==o?r=s==a?i.#a(t):i.#a(i.convertTo(t,a)):e==h?r=s==a?i.RGBA_TO_CSS_COLOR_CONVERTIONS[t.toString()]??t:i.RGBA_TO_CSS_COLOR_CONVERTIONS[i.convertTo(t,a).toString()]??t:e==l&&(r=s==a?i.#o(t):i.#o(i.convertTo(t,a)))),r}convertTo(t=this._color,e=i.CONVERTABLE_FORMATS.RGBA){return i.convertTo(t,e)}static random(e=i.CONVERTABLE_FORMATS.RGBA,s=!1,r=[0,255],n=[0,255],a=[0,255],o=[0,1]){const h=i.CONVERTABLE_FORMATS,l=t.random,_=[l(...r),l(...n),l(...a),s?l(...o,2):1];return e==h.HEX?i.convertTo(_,h.HEX):e==h.TEXT?i.convertTo(_,h.TEXT):e==h.HSV?i.convertTo(_,h.HSV):_}static#s(t){return t?[t[0],t[1],t[2],t[3]]:null}static#o(t){let e,i=t[0]/255,s=t[1]/255,r=t[2]/255,n=Math.min(i,s,r),a=Math.max(i,s,r),o=a-n;return a==n?e=0:(e=a==i?(s-r)/o:a==s?(r-i)/o+2:(i-s)/o+4,e=(360+60*e)%360),[e,a&&o/a*100,100*a]}static#n(t){let e,i,s,r=t[0],n=t[1]/100,a=t[2]/100,o=a*n,h=o*(1-Math.abs(r/60%2-1)),l=a-o;return 0<=r&&r<60?(e=o,i=h,s=0):60<=r&&r<120?(e=h,i=o,s=0):120<=r&&r<180?(e=0,i=o,s=h):180<=r&&r<240?(e=0,i=h,s=o):240<=r&&r<300?(e=h,i=0,s=o):(e=o,i=0,s=h),[Math.round(255*(e+l)),Math.round(255*(i+l)),Math.round(255*(s+l)),1]}static#a(t){let e=(0|t[0]).toString(16),i=(0|t[1]).toString(16),s=(0|t[2]).toString(16),r=t[3],n="#"+(e.length<2?"0"+e:e)+(i.length<2?"0"+i:i)+(s.length<2?"0"+s:s);if(1!=r){const t=Math.round(255*r).toString(16);n+=t.length<2?"0"+t:t}return n}static#r(t){"#"!=t[0]&&(t="#"+t);const e=[],i=t.length-1,s=4==i||8==i;if(i<6)for(let r=1;r<=i;r++){let n=t[r],a=parseInt(n+n,16);s&&r==i&&(a=Math.round(a/255*100)/100),e.push(a)}else for(let r=1;r<i;r+=2){let n=parseInt(t[r]+t[r+1],16);s&&r+1==i&&(n=Math.round(n/255*100)/100),e.push(n)}return e}static getFormat(t){const e=i.FORMATS;return t?Array.isArray(t)?4==t.length?e.RGBA:e.HSV:t instanceof i?e.COLOR:t instanceof C?e.GRADIENT:t instanceof g?e.PATTERN:"#"==t[0]?e.HEX:i.CSS_COLOR_TO_RGBA_CONVERTIONS[t]?e.TEXT:null:null}static uniquify(t){return t instanceof i?t.isChannel?t:t.duplicate():new i(t)}static rgbaAdd(e,i=0,s=0,r=0,n=0){const a=(e,i)=>t.clamp(e,0,i?1:255);return[a(e[0]+(i||0)),a(e[1]+(s||0)),a(e[2]+(r||0)),a(e[3]+(n||0),!0)]}static rgbaAddAll(e,i=0){const s=(e,i)=>t.clamp(e,0,i?1:255);return[s(e[0]+(i||0)),s(e[1]+(i||0)),s(e[2]+(i||0)),e[3]]}static rgbaSet(e,i,s,r,n){const a=(e,i)=>t.clamp(e,0,i?1:255);return[a(i??e[0]??0),a(s??e[1]??0),a(r??e[2]??0),a(n??e[3]??1,!0)]}static rgbaHsvAdd(e,s,r,n){const a=i.#o(e);return a[0]=(a[0]+(s??0))%360||0,a[1]=t.clamp(a[1]+(r??0),0,100)||0,a[2]=t.clamp(a[2]+(n??0),0,100)||0,i.rgbaSet(i.#n(a),null,null,null,e[3])}static formatRgba(t){return Array.isArray(t)?`rgba(${t[0]??255}, ${t[1]??255}, ${t[2]??255}, ${t[3]??1})`:null}static rgba(e=255,s=255,r=255,n=1){const a=t.round,o=i.DEFAULT_DECIMAL_ROUNDING_POINT;return[a(e,o),a(s,o),a(r,o),a(n,o)]}static getColorValue(t){return"string"==typeof t||t instanceof CanvasGradient||t instanceof CanvasPattern?t:t instanceof p?t.value:i.formatRgba(t)??t.color}static findFirstPos(t,e,s=!1,r=i.DEFAULT_TEMPERANCE,n=i.DEFAULT_SEARCH_START,a=[]){let o,h,l,_,u,c,E,d,T=a[0]??t.width,S=a[1]??t.height,A=t.ctx.getImageData(0,0,T,S).data,R=4*T,p=e.r??e[0],g=e.g??e[1],I=e.b??e[2],O=255*(e.a??e[3]),C=p-r,P=g-r,f=I-r,m=O-r,D=p+r,L=g+r,N=I+r,b=O+r,M=n==i.SEARCH_STARTS.TOP_LEFT,y=M?0:T-1,U=M?T:-1,F=M?1:-1,v=M?S:-1,B=M?1:-1;for(h=M?0:S-1;h!=v;h+=B)for(l=h*R,o=y;o!=U;o+=F)if(_=l+4*o,u=A[_],r){if(u>=C&&u<=D&&(c=A[_+1],E=A[_+2],c>=P&&c<=L&&E>=f&&E<=N&&(!s||d>=m&&d<=b)))return[o,h]}else if(u==p&&A[_+1]==g&&A[_+2]==I&&(!s||A[_+3]==O))return[o,h];return null}duplicate(t){const e=i.FORMATS,s=this._format;return s==e.GRADIENT||s==e.PATTERN?new i(this._color.duplicate(t)):new i(i.#s(this.#t))}toString(){let t=i.getColorValue(this._color);return(t instanceof CanvasGradient||t instanceof CanvasPattern)&&(t=this._color.toString()),t}[Symbol.toPrimitive](){return this.color}*[Symbol.iterator](){const t=this.#t;for(let e=0;e<4;e++)yield t[e]}get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"Color"}get color(){const t=i.FORMATS,e=this._format;return e==t.GRADIENT||e==t.PATTERN?this._color.value:i.formatRgba(this.#t)}get colorRaw(){return this._color}get isChannel(){return this._isChannel}get rgba(){return this.#t}get hsv(){return this.#e}get r(){return this.#t[0]}get g(){return this.#t[1]}get b(){return this.#t[2]}get a(){return this.#t[3]}get hue(){return this.#e[0]}get saturation(){return this.#e[1]}get brightness(){return this.#e[2]}set color(t){const e=t?._color||t,s=i.getFormat(e);s&&(this._color=e,this._format=s,this.#i())}set r(e){this.#t[0]=t.round(e,i.DEFAULT_DECIMAL_ROUNDING_POINT)}set g(e){this.#t[1]=t.round(e,i.DEFAULT_DECIMAL_ROUNDING_POINT)}set b(e){this.#t[2]=t.round(e,i.DEFAULT_DECIMAL_ROUNDING_POINT)}set a(e){this.#t[3]=t.round(e,i.DEFAULT_DECIMAL_ROUNDING_POINT)}set rgba(e){this.#t[0]=t.round(e[0],i.DEFAULT_DECIMAL_ROUNDING_POINT),this.#t[1]=t.round(e[1],i.DEFAULT_DECIMAL_ROUNDING_POINT),this.#t[2]=t.round(e[2],i.DEFAULT_DECIMAL_ROUNDING_POINT),this.#t[3]=t.round(e[3],i.DEFAULT_DECIMAL_ROUNDING_POINT)}set hue(t){t%=360,this.#e[0]!=t&&(this.#e[0]=t,this.#t=i.#n(this.#e))}set saturation(t){t=t>100?100:t,this.#e[1]!=t&&(this.#e[1]=t,this.#t=i.#n(this.#e))}set brightness(t){t=t>100?100:t,this.#e[2]!=t&&(this.#e[2]=t,this.#t=i.#n(this.#e))}}const s=Object.entries(i.CSS_COLOR_TO_RGBA_CONVERTIONS),r=s.length;for(let t=0;t<r;t++){const e=s[t];Object.defineProperty(i,e[0],{get:()=>e[1]})}class n{constructor(t){this._initColor=t,this._color=this._initColor}getInitColor(){return t.isFunction(this._initColor)?this._initColor(this):this._initColor||null}get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"_HasColor"}get colorObject(){return this._color}get colorRaw(){return this._color.colorRaw}get color(){return this._color?.color}get initColor(){return this._initColor}get rgba(){return this._color.rgba}get r(){return this._color.r}get g(){return this._color.g}get b(){return this._color.b}get a(){return this._color.a}get hsv(){return this._color.hsv}get hue(){return this._color.hue}get saturation(){return this._color.saturation}get brightness(){return this._color.brightness}set color(t){const e=this._color;if(!e||e?.colorRaw?.toString()!==t?.toString()){const s=t?.colorRaw||t;s?.positions==p.PLACEHOLDER&&((t=t.isChannel?s:s.duplicate()).initPositions=this),e instanceof i?e.color=t:this._color=i.uniquify(t)}}set r(t){this._color.r=t}set g(t){this._color.g=t}set b(t){this._color.b=t}set a(t){this._color.a=t}set hue(t){this._color.hue=t}set saturation(t){this._color.saturation=t}set brightness(t){this._color.brightness=t}set initColor(t){this._initColor=t}}class a{static D=["t","r","b","l","tr","br","bl","tl","i"].reduce((t,e,i)=>(t.places.push([t[e]=1<<i,t=>0==i?-t:1==i?1:2==i?t:3==i?-1:4==i?1-t:5==i?t+1:6==i?t-1:7==i?-t-1:8==i?0:void 0]),t),{places:[]});static DEFAULT_SOURCE=a.fontSource5x5;static get fontSource5x5(){const t=a.D;return{width:5,height:5,A:[[2,t.bl+t.br],[1,t.bl],[3,t.br],[0,t.r+t.b],[1,t.r],[2,t.r],[3,t.r],[4,t.b],[0,t.b],[4,t.b],[0],[4]],B:[[0,t.r+t.b],[,t.r],[,t.r],[,t.br],[0,t.b],[4,t.bl],[0,t.r+t.b],[,t.r],[,t.r],[,t.br],[0,t.b],[4,t.bl],[0,t.r],[,t.r],[,t.r],[]],C:[[1,t.r+t.bl],[,t.r],[,t.r],[],[0,t.b],[0,t.b],[0,t.br],[-1,t.r],[2,t.r],[,t.r],[]],D:[[0,t.r+t.b],[,t.r],[,t.r],[,t.br],[0,t.b],[4,t.b],[0,t.b],[4,t.b],[0,t.b],[4,t.bl],[0,t.r],[,t.r],[,t.r],[]],E:[[0,t.r+t.b],[,t.r],[,t.r],[,t.r],[],[0,t.b],[0,t.b+t.r],[,t.r],[,t.r],[,t.r],[0,t.b],[0,t.r],[,t.r],[,t.r],[,t.r],[]],F:[[0,t.r+t.b],[,t.r],[,t.r],[,t.r],[],[0,t.b],[0,t.b+t.r],[,t.r],[,t.r],[],[0,t.b],[0]],G:[[1,t.r+t.bl],[,t.r],[,t.r],[],[0,t.b],[0,t.b],[3,t.r],[4,t.b],[0,t.br],[4,t.b],[1,t.r],[,t.r],[,t.r],[]],H:[[0,t.r+t.b],[4,t.b],[0,t.b],[4,t.b],[0,t.b+t.r],[,t.r],[,t.r],[,t.r],[,t.b],[0,t.b],[4,t.b],[0],[4]],I:[[1,t.r],[,t.b+t.r],[],[2,t.b],[2,t.b],[2,t.b],[1,t.r],[,t.r],[]],J:[[1,t.r],[,t.r],[,t.b+t.r],[],[3,t.b],[3,t.b],[0,t.br],[3,t.bl],[1,t.r],[,t.r]],K:[[0,t.b],[3,t.bl],[0,t.b],[2,t.bl],[0,t.b+t.r],[,t.r+t.br],[0,t.b],[2,t.br],[0],[3,t.r]],L:[[0,t.b],[0,t.b],[0,t.b],[0,t.b],[0,t.r],[,t.r],[,t.r],[,t.r]],M:[[0,t.b+t.br],[4,t.b+t.bl],[0,t.b],[,t.br],[3,t.bl],[4,t.b],[0,t.b],[2],[4,t.b],[0,t.b],[4,t.b],[0],[4]],N:[[0,t.b+t.br],[4,t.b],[0,t.b],[,t.br],[4,t.b],[0,t.b],[2,t.br],[4,t.b],[0,t.b],[3,t.br],[4,t.b],[0],[4]],O:[[1,t.bl+t.r],[,t.r],[,t.br],[0,t.b],[4,t.b],[0,t.b],[4,t.b],[0,t.b+t.br],[4,t.b+t.bl],[1,t.r],[,t.r],[,t.r]],P:[[0,t.r+t.b],[,t.r],[,t.br],[0,t.b],[3,t.bl],[0,t.b+t.r],[,t.r],[],[0,t.b],[0]],Q:[[1,t.bl+t.r],[,t.r],[,t.br],[0,t.b],[4,t.b],[0,t.b],[4,t.b],[0,t.b+t.br],[3,t.br],[,t.bl],[1,t.r],[,t.r],[],[]],R:[[0,t.r+t.b],[,t.r],[,t.br],[0,t.b],[3,t.bl],[0,t.b+t.r],[,t.r+t.br],[],[0,t.b],[2,t.br],[0],[3]],S:[[1,t.r+t.bl],[,t.r],[,t.r],[],[0,t.br],[-1,t.r],[2,t.r],[,t.br],[-4,t.bl],[0,t.r+t.bl],[,t.r],[,t.r],[]],T:[[0,t.r],[,t.r],[,t.b+t.r],[,t.r],[],[2,t.b],[2,t.b],[2,t.b],[2]],U:[[0,t.r+t.b],[4,t.b],[0,t.b],[4,t.b],[0,t.b+t.r],[4,t.b],[0,t.br],[4,t.bl],[1,t.r],[,t.r],[,t.r]],V:[[0,t.r+t.b],[4,t.b],[0,t.b],[4,t.b],[0,t.br],[4,t.bl],[1,t.br],[3,t.bl],[2,t.r]],W:[[0,t.b+t.br],[4,t.b+t.bl],[0,t.b],[4,t.b],[0,t.b],[2,t.bl+t.br],[4,t.b],[0,t.b],[,t.bl],[3,t.br],[4,t.b],[0],[4]],X:[[0,t.br],[4,t.bl],[1,t.br],[3,t.bl],[2,t.br+t.bl],[1,t.bl],[3,t.br],[0],[4]],Y:[[0,t.br],[4,t.bl],[1,t.br],[3,t.bl],[2,t.b],[2,t.b],[2]],Z:[[0,t.r],[,t.r],[,t.r],[,t.r],[,t.bl],[3,t.bl],[2,t.bl],[1,t.bl],[0,t.r],[,t.r],[,t.r],[,t.r],[]],a:[[Infinity],[1,t.bl+t.r],[,t.br],[0,t.b],[3,t.b],[0,t.br],[3,t.bl+t.br],[1,t.r],[],[4]],b:[[0,t.b],[0,t.b],[0,t.b+t.r],[,t.r],[,t.br],[0,t.b],[3,t.bl],[0,t.r],[,t.r],[,t.r]],c:[[Infinity],[1,t.r+t.bl],[,t.r],[],[0,t.b],[0,t.br],[-1,t.r],[2,t.r],[]],d:[[3,t.b],[3,t.b],[1,t.bl+t.r],[,t.r],[,t.b],[0,t.br],[3,t.b],[1,t.r],[,t.r],[]],e:[[1,t.r+t.bl],[,t.br],[0,t.b],[3,t.bl],[0,t.b+t.r],[,t.r],[],[0,t.br],[3,t.bl],[1,t.r],[]],f:[[1,t.b+t.r],[],[1,t.b],[0,t.r],[,t.r+t.b],[],[1,t.b],[1]],g:[[1,t.bl+t.r],[,t.br],[0,t.br],[3,t.bl],[1,t.r],[,t.br],[0,t.br],[3,t.bl],[1,t.r],[]],h:[[0,t.b],[0,t.b],[0,t.b+t.r],[,t.r],[,t.br],[0,t.b],[3,t.b],[0],[3]],i:[[Infinity],[1,t.i],[1,t.b],[1,t.b],[1]],j:[[2,t.i],[2,t.b],[2,t.b],[0,t.br],[2,t.bl],[1]],k:[[0,t.b],[0,t.b],[2,t.bl],[0,t.b],[2,t.bl],[0,t.b+t.r],[,t.br],[0],[2]],l:[[0,t.b],[0,t.b],[0,t.b],[0,t.b],[0]],m:[[Infinity],[1,t.bl+t.br],[3,t.bl+t.br],[0,t.b],[2,t.b],[4,t.b],[0,t.b],[2,t.b],[4,t.b],[0],[2],[4]],n:[[Infinity],[0,t.b],[,t.bl+t.r],[,t.bl+t.br],[0,t.b],[3,t.b],[0,t.b],[3,t.b],[0],[3]],o:[[Infinity],[1,t.bl+t.r],[,t.br],[0,t.b],[3,t.b],[0,t.br],[3,t.bl],[1,t.r],[]],p:[[1,t.r+t.bl],[,t.br],[0,t.b],[3,t.bl],[0,t.b+t.r],[,t.r],[],[0,t.b],[0]],q:[[1,t.r+t.bl],[,t.br],[0,t.br],[3,t.b],[1,t.r],[,t.r],[,t.b],[3,t.b],[3]],r:[[Infinity],[0,t.b],[,t.bl+t.r],[],[0,t.b],[0,t.b],[0]],s:[[Infinity],[2,t.bl+t.br],[1,t.br],[3],[1,t.br],[2,t.r],[,t.b],[2,t.r],[]],t:[[2,t.b],[1,t.r],[,t.b+t.r],[],[2,t.b],[2,t.b],[2]],u:[[Infinity],[0,t.b],[2,t.b],[0,t.b],[2,t.b],[0,t.br],[2,t.bl+t.br],[1,t.r],[3]],v:[[Infinity],[1,t.b],[3,t.b],[1,t.b],[3,t.b],[1,t.br],[3,t.bl],[2,t.r]],w:[[Infinity],[0,t.b],[2,t.b],[4,t.b],[0,t.b],[2,t.b],[4,t.b],[0,t.br],[2,t.bl+t.br],[4,t.bl],[1],[3]],x:[[1,t.b],[3,t.b],[1,t.br],[3,t.bl],[2,t.br+t.bl],[1,t.b],[3,t.b],[1],[3]],y:[[Infinity],[1,t.b],[3,t.b],[1,t.br],[3,t.bl],[2,t.b],[2]],z:[[Infinity],[0,t.r],[,t.r],[,t.r],[,t.bl],[2,t.bl],[1,t.bl],[0,t.r],[,t.r],[,t.r],[]],"!":[[3,t.b],[3,t.b],[3,t.b],[3],[3,t.i]],"?":[[1,t.r+t.bl],[,t.r],[,t.br],[0],[4,t.bl],[3,t.bl],[2],[2,t.i]],"@":[[1,t.bl+t.r],[,t.r],[,t.br],[0,t.b],[2,t.bl+t.br],[4,t.b],[0,t.b],[1,t.br],[3,t.b],[4,t.b],[0,t.b+t.br],[2,t.r],[3,t.r],[4],[1,t.r],[,t.r],[,t.r]],"#":[[1,t.b],[3,t.b],[0,t.r],[1,t.b+t.r],[2,t.r],[3,t.b+t.r],[],[1,t.b],[3,t.b],[0,t.r],[1,t.b+t.r],[2,t.r],[3,t.b+t.r],[],[1],[3]],$:[[1,t.r+t.bl],[,t.r+t.b],[,t.r],[],[0,t.br],[2,t.b],[1,t.r],[2,t.r+t.b],[,t.br],[2,t.b],[4,t.bl],[0,t.r+t.bl],[,t.r],[,t.r],[]],"%":[[0,t.r+t.b],[1,t.b],[4,t.bl],[0,t.r],[],[3,t.bl],[2,t.bl],[1,t.bl],[3,t.r+t.b],[4,t.b],[0],[3,t.r],[]],"^":[[2,t.br+t.bl],[1],[3]],"&":[[0,t.r+t.br],[,t.r],[,t.r],[,t.bl],[1,t.br],[2,t.bl],[1,t.bl],[2,t.br],[0,t.br],[3,t.br],[,t.bl],[1,t.r],[2,t.r],[3],[]],"*":[[1,t.br],[,t.b],[,t.bl],[1,t.r],[,t.r],[],[1,t.tr],[,t.t],[,t.tl]],"(":[[3,t.bl],[2,t.b],[2,t.b],[2,t.br],[-3]],")":[[1,t.br],[-2,t.b],[2,t.b],[2,t.bl],[1]],"{":[[3,t.bl],[2,t.b],[1,t.r],[2,t.b],[2,t.br],[-3]],"}":[[1,t.br],[-2,t.b],[2,t.b+t.r],[],[2,t.bl],[1]],",":[[Infinity],[Infinity],[Infinity],[1,t.bl],[0]],".":[[Infinity],[Infinity],[Infinity],[Infinity],[0,t.i]],"+":[[Infinity],[2,t.b],[1,t.r],[2,t.b+t.r],[],[2]],_:[[Infinity],[Infinity],[Infinity],[Infinity],[0,t.r],[,t.r],[,t.r],[,t.r],[,t.r]],"-":[[Infinity],[Infinity],[1,t.r],[,t.r],[]],"=":[[Infinity],[1,t.r],[,t.r],[,t.r],[Infinity],[1,t.r],[,t.r],[,t.r]],";":[[2,t.r+t.b],[3,t.b],[2,t.r],[],[2,t.r+t.b],[3,t.b],[2,t.r],[,t.b],[3]],":":[[Infinity],[2,t.r+t.b],[3,t.b],[2,t.r],[],[2,t.r+t.b],[3,t.b],[2,t.r],[]],"[":[[2,t.b+t.r],[3],[2,t.b],[2,t.b],[2,t.b],[2,t.r],[3]],"]":[[1,t.r],[2,t.b],[2,t.b],[2,t.b],[2,t.b],[1,t.r],[2]],"'":[[0,t.b],[0]],"|":[[2,t.b],[2,t.b],[2,t.b],[2,t.b],[2]],"/":[[4,t.bl],[3,t.bl],[2,t.bl],[1,t.bl],[0]],"\\":[[0,t.br],[-1,t.br],[-2,t.br],[-3,t.br],[-4]],0:[[1,t.bl+t.r],[,t.br],[0,t.b],[3,t.b],[0,t.b],[,t.r],[],[,t.b],[0,t.b+t.br],[3,t.b+t.bl],[1,t.r],[,t.r]],1:[[2,t.b+t.bl],[1],[,t.b],[2,t.b],[2,t.b],[1,t.r],[,t.r],[]],2:[[1,t.r+t.bl],[,t.br],[0],[3,t.bl],[2,t.bl],[1,t.bl],[0,t.r],[,t.r],[,t.r],[,t.r]],3:[[1,t.r+t.bl],[,t.br],[0],[3,t.bl],[2,t.br],[0,t.br],[3,t.bl],[1,t.r],[,t.r]],4:[[3,t.b+t.bl],[2,t.bl],[,t.b],[1,t.bl],[3,t.b],[0,t.r],[,t.r],[,t.r],[,t.r+t.b],[,t.r],[3]],5:[[1,t.r+t.b],[,t.r],[,t.r],[],[1,t.b],[-1,t.r],[2,t.r],[,t.br],[-4,t.bl],[1,t.r+t.bl],[,t.r],[]],6:[[0,t.r+t.b],[,t.r],[,t.r],[,t.r],[0,t.b],[0,t.r+t.b],[,t.r],[,t.r],[,t.r+t.b],[0,t.b],[3,t.b],[0,t.r],[,t.r],[,t.r],[,t.r]],7:[[0,t.r],[,t.r],[,t.r],[,t.b],[3,t.bl],[1,t.r],[,t.bl+t.r],[],[1,t.bl],[0]],8:[[1,t.bl+t.r],[,t.br],[0,t.br],[3,t.bl],[1,t.bl+t.r],[,t.br],[0,t.b+t.br],[3,t.b+t.bl],[1,t.r],[,t.r]],9:[[1,t.r+t.bl],[,t.br],[0,t.br],[3,t.bl+t.b],[1,t.r],[],[,t.b],[3,t.b],[3]]}}}class o{static#h=0;static#l=3;static KEYS={A:"A",B:"B",C:"C",D:"D",E:"E",F:"F",G:"G",H:"H",I:"I",J:"J",K:"K",L:"L",M:"M",N:"N",O:"O",P:"P",Q:"Q",R:"R",S:"S",T:"T",U:"U",V:"V",W:"W",X:"X",Y:"Y",Z:"Z",DIGIT_0:"0",DIGIT_1:"1",DIGIT_2:"2",DIGIT_3:"3",DIGIT_4:"4",DIGIT_5:"5",DIGIT_6:"6",DIGIT_7:"7",DIGIT_8:"8",DIGIT_9:"9",SPACE:" ",ENTER:"ENTER",TAB:"TAB",BACKSPACE:"BACKSPACE",ESCAPE:"ESCAPE",SHIFT:"SHIFT",CONTROL:"CONTROL",ALT:"ALT",ALT_GRAPH:"ALTGRAPH",META:"META",CAPS_LOCK:"CAPSLOCK",CONTEXT_MENU:"CONTEXTMENU",ARROW_UP:"ARROWUP",ARROW_DOWN:"ARROWDOWN",ARROW_LEFT:"ARROWLEFT",ARROW_RIGHT:"ARROWRIGHT",HOME:"HOME",END:"END",PAGE_UP:"PAGEUP",PAGE_DOWN:"PAGEDOWN",INSERT:"INSERT",DELETE:"DELETE",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F11:"F11",F12:"F12",F13:"F13",F14:"F14",F15:"F15",F16:"F16",F17:"F17",F18:"F18",F19:"F19",F20:"F20",F21:"F21",F22:"F22",F23:"F23",F24:"F24",NUMPAD_0:"NUMPAD0",NUMPAD_1:"NUMPAD1",NUMPAD_2:"NUMPAD2",NUMPAD_3:"NUMPAD3",NUMPAD_4:"NUMPAD4",NUMPAD_5:"NUMPAD5",NUMPAD_6:"NUMPAD6",NUMPAD_7:"NUMPAD7",NUMPAD_8:"NUMPAD8",NUMPAD_9:"NUMPAD9",NUMPAD_ADD:"NUMPADADD",NUMPAD_SUBTRACT:"NUMPADSUBTRACT",NUMPAD_MULTIPLY:"NUMPADMULTIPLY",NUMPAD_DIVIDE:"NUMPADDIVIDE",NUMPAD_DECIMAL:"NUMPADDECIMAL",NUMPAD_ENTER:"NUMPADENTER",PAUSE:"PAUSE",PRINT_SCREEN:"PRINTSCREEN",SCROLL_LOCK:"SCROLLLOCK",NUM_LOCK:"NUMLOCK",LAUNCH_APPLICATION_1:"LAUNCHAPPLICATION1",LAUNCH_APPLICATION_2:"LAUNCHAPPLICATION2",BRACKET_LEFT:"BRACKETLEFT",BRACKET_RIGHT:"BRACKETRIGHT",SEMICOLON:"SEMICOLON",QUOTE:"QUOTE",COMMA:"COMMA",PERIOD:"PERIOD",SLASH:"SLASH",BACKSLASH:"BACKSLASH",EQUAL:"EQUAL",MINUS:"MINUS",BACKQUOTE:"BACKQUOTE",AUDIO_VOLUME_UP:"AUDIOVOLUMEUP",AUDIO_VOLUME_DOWN:"AUDIOVOLUMEDOWN",AUDIO_VOLUME_MUTE:"AUDIOVOLUMEMUTE",MEDIA_PLAY_PAUSE:"MEDIAPLAYPAUSE",MEDIA_NEXT_TRACK:"MEDIANEXTTRACK",MEDIA_PREVIOUS_TRACK:"MEDIAPREVIOUSTRACK",MEDIA_STOP:"MEDIASTOP",BROWSER_BACK:"BROWSERBACK",BROWSER_FORWARD:"BROWSERFORWARD",BROWSER_REFRESH:"BROWSERREFRESH",BROWSER_STOP:"BROWSERSTOP",BROWSER_SEARCH:"BROWSERSEARCH",BROWSER_FAVORITES:"BROWSERFAVORITES",BROWSER_HOME:"BROWSERHOME"};static KEY_GROUPS={NATIVE_ZOOM_KEYS:["-","+","="]};static LISTENER_TYPES={DOWN:0,UP:1};static TRIGGER_TYPES={DEFAULT_REPEATING:0,ONCE:1,SLOW_REPEATING:2,MEDIUM_REPEATING:4,FAST_REPEATING:16};static#_=o.TRIGGER_TYPES.SLOW_REPEATING|o.TRIGGER_TYPES.MEDIUM_REPEATING|o.TRIGGER_TYPES.FAST_REPEATING;static#u=[];static{o.#u[o.TRIGGER_TYPES.SLOW_REPEATING]=100,o.#u[o.TRIGGER_TYPES.MEDIUM_REPEATING]=1e3/30,o.#u[o.TRIGGER_TYPES.FAST_REPEATING]=1e3/60}#c=[];#E=null;constructor(){this._keysPressed=[],this._listeners=[]}addListener(t,e,i,s=o.TRIGGER_TYPES.DEFAULT_REPEATING){const r=[e,i,s,o.#h++];return this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(r),r[o.#l]}updateListener(e,i,s,r,n){const a=this._listeners[e][this._listeners[e].findIndex(t=>t[o.#l]==(i?.[o.#l]??i))];s&&(a[0]=s),r&&(a[1]=r),t.isDefined(n)&&(a[2]=n)}#d(e,i){const s=this._listeners[e],r=s?.length;if(r){const n=o.LISTENER_TYPES;for(let a=0;a<r;a++){const[r,h,l,_]=s[a];if(e===n.DOWN&&this.isDown(r)){this.#c[e]||(this.#c[e]=[]);const s=this.#c[e],n=this.#c[e]?.[l]?.[_]?.[1];l!==o.TRIGGER_TYPES.ONCE||n?l&o.#_&&!n?(s[l]||(s[l]=[]),s[l][_]=[r,t.noDelayInterval(o.#u[l],()=>h(this,i,this.keysPressed))]):l===o.TRIGGER_TYPES.DEFAULT_REPEATING&&h(this,i,this.keysPressed):(s[l]||(s[l]=[]),s[l][_]=[r,!0],h(this,i,this.keysPressed))}else e===n.UP&&r.includes(this.#E)&&!this.isDown(this.#E)&&h(this,i,this.#E)}}}removeListener(t,e){const i="*"===e;this._listeners[t]=i?[]:this._listeners[t].filter(t=>t[o.#l]!==(e?.[o.#l]??e)),i?this.#c[t]=[]:this.#c[t].forEach(t=>{t[e]&&delete t[e]})}removeAllListeners(){this._listeners=[],this.#c=[]}setDown(t){const e=t.key?.toUpperCase();e&&!this.isDown(e)&&this._keysPressed.push({key:e,keyCode:t.keyCode}),this.#d(o.LISTENER_TYPES.DOWN,t)}setUp(t){const e=t.key?.toUpperCase();if(e&&this.isDown(e)&&(this.#E=e,this._keysPressed=this._keysPressed.filter(t=>t.key!==e)),this.#c.length){const t=this.#c[o.LISTENER_TYPES.DOWN],e=Object.values(o.TRIGGER_TYPES).length;for(let i=1;i<1<<e;i*=2){const e=t[i];e?.length&&(i===o.TRIGGER_TYPES.ONCE?e.forEach(t=>{this.isDown(t[0])||(t[1]=!1)}):i&o.#_&&e.forEach(t=>{this.isDown(t[0])||(clearInterval(t[1]),t[1]=null)}))}}this.#d(o.LISTENER_TYPES.UP,t)}isDown(t){const e=Array.isArray(t),i=this.keysPressed;if(!e)return i.includes(t?.toUpperCase());{const e=t.length;for(let s=0;s<e;s++){const e=t[s]?.toUpperCase();if(i.includes(e))return!0}}return!1}hasKeysDown(){return Boolean(this._keysPressed.length)}clearPressed(){this._keysPressed=[]}*[Symbol.iterator](){const t=this._keysPressed,e=t.length;for(let i=0;i<e;i++)yield t[i]}get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"TypingDevice"}get keysPressedRaw(){return this._keysPressed}get keysPressed(){return this._keysPressed.map(t=>t.key)}get keyCodesPressed(){return this._keysPressed.map(t=>t.keyCode)}set keysPressed(t){this._keysPressed=t}}class h{static#h=0;static#l=3;static DEFAULT_MOUSE_DECELERATION=.8;static DEFAULT_MOUSE_MOVE_TRESHOLD=.1;static DEFAULT_MOUSE_ANGULAR_DECELERATION=.2;static LISTENER_TYPES={CLICK:0,DOWN:0,UP:1,MAIN_DOWN:0,MAIN_UP:1,MIDDLE_DOWN:2,MIDDLE_UP:3,RIGHT_DOWN:4,RIGHT_UP:5,EXTRA_FOWARD_DOWN:6,EXTRA_FOWARD_UP:7,EXTRA_BACK_DOWN:8,EXTRA_BACK_UP:9,MOVE:10,ENTER:11,LEAVE:12,EXIT:12};static BUTTON_TYPES={LEFT:0,MIDDLE:1,RIGHT:2,EXTRA_BACK:3,EXTRA_FOWARD:4};#T=null;#S=null;#A=[];constructor(t){this._ctx=t,this._valid=!1,this._x=null,this._y=null,this._lastPos=[0,0],this._rawX=null,this._rawY=null,this._dir=null,this._speed=null,this._clicked=!1,this._rightClicked=!1,this._scrollClicked=!1,this._extraForwardClicked=!1,this._extraBackClicked=!1,this._holdValue={},this._listeners=[],this._moveListenersOptimizationEnabled=!0}calcSpeed(e){const i=h.DEFAULT_MOUSE_DECELERATION;isFinite(this.#T)&&isFinite(this.#S)&&e?(this._speed=this._speed*i+t.getDist(this._x,this._y,this.#T,this.#S)/e*(1-i),this._speed<h.DEFAULT_MOUSE_MOVE_TRESHOLD&&(this._speed=0)):this._speed=0,this.#T=this._x,this.#S=this._y}calcAngle(){const e=this._x-this.#T,i=this._y-this.#S;if(isFinite(e)&&isFinite(i)&&(e||i)){let s=(360-t.toDeg(Math.atan2(i,e)))%360-this._dir;s+=360*(s<-180)-360*(s>180),this._dir=(this._dir+s*h.DEFAULT_MOUSE_ANGULAR_DECELERATION+360)%360}else this._dir=0}updateMouseClicks(t){const e="mousedown"==t.type||"touchstart"==t.type,i=h.LISTENER_TYPES,s=h.BUTTON_TYPES;t.button===s.LEFT?(this._clicked=e,this.checkListeners(e?i.MAIN_DOWN:i.MAIN_UP)):t.button===s.MIDDLE?(this._scrollClicked=e,this.checkListeners(e?i.MIDDLE_DOWN:i.MIDDLE_UP)):t.button===s.RIGHT?(this._rightClicked=e,this.checkListeners(e?i.RIGHT_DOWN:i.RIGHT_UP)):t.button===s.EXTRA_BACK?(this._extraBackClicked=e,this.checkListeners(e?i.EXTRA_BACK_DOWN:i.EXTRA_BACK_UP)):t.button===s.EXTRA_FOWARD&&(this._extraForwardClicked=e,this.checkListeners(e?i.EXTRA_FOWARD_DOWN:i.EXTRA_FOWARD_UP))}invalidate(){this._x=Infinity,this._y=Infinity,this._rawX=Infinity,this._rawY=Infinity}updatePos(t,e,i){this._valid=!0,this._rawX=t,this._rawY=e;const s=i[2];this._x=Math.round((t-i[0])/s),this._y=Math.round((e-i[1])/s),this._moveListenersOptimizationEnabled&&(this.checkListeners(h.LISTENER_TYPES.ENTER),this.checkListeners(h.LISTENER_TYPES.LEAVE)),this._lastPos[0]=this._x,this._lastPos[1]=this._y,this.checkListeners(h.LISTENER_TYPES.MOVE)}checkValid(){return Infinity==this._x||null==this._x||Infinity==this._y||null==this._y?this._valid=!1:this._valid?void 0:this._valid=!0}addListener(t,e,i,s=!1,r=!1){const n=s&&t.getBoundsAccurate,a=[r?n?t.getBoundsAccurate():t.getBounds():t,i,n,h.#h++];return this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(a),a[h.#l]}checkListeners(t){const e=this._listeners[t],i=e?.length;if(i){let s=h.LISTENER_TYPES,r=this.pos,n=!0;if(t>=s.ENTER){n=2,t==s.LEAVE&&(n=1);for(let t=0;t<i;t++){const i=e[t],s=i[0],a=i[1],o=i[2],l=s instanceof Path2D,_=Array.isArray(s)||l,u=!_&&(o?s.isWithinAccurate(r):s.isWithin(r))||_&&this.isWithin(r,s,l);if(this._moveListenersOptimizationEnabled)2*u+(!_&&(o?s.isWithinAccurate(this._lastPos):s.isWithin(this._lastPos))||_&&this.isWithin(this._lastPos,s,l))==n&&a(r,s,this);else{const t=this.#A[i[h.#l]];!t&&u?(this.#A[i[h.#l]]=!0,2==n&&a(r,s,this)):!u&&t&&(this.#A[i[h.#l]]=!1,1==n&&a(r,s,this))}}}else{n=t==s.MAIN_DOWN||t==s.RIGHT_DOWN||t==s.MIDDLE_DOWN||t==s.EXTRA_BACK_DOWN||t==s.EXTRA_FOWARD_DOWN?this._clicked:t!=s.MAIN_UP&&t!=s.RIGHT_UP&&t!=s.MIDDLE_UP&&t!=s.EXTRA_BACK_UP&&t!=s.EXTRA_FOWARD_UP||!this._clicked;for(let t=0;t<i;t++){const[i,s,a]=e[t],o=i instanceof Path2D,h=Array.isArray(i)||o;n&&(!h&&(a?i.isWithinAccurate(r):i.isWithin(r))||h&&this.isWithin(r,i,o))&&s(r,i,this)}}}}updateListener(e,i,s,r,n,a=!1){const o=this._listeners[e][this._listeners[e].findIndex(t=>t[h.#l]==(i?.[h.#l]??i))];s&&(o[0]=a?n&&s.getBoundsAccurate?s.getBoundsAccurate():s.getBounds():s),r&&(o[1]=r),t.isDefined(n)&&(o[2]=n)}removeListener(t,e){this._listeners[t]="*"==e?[]:this._listeners[t].filter(t=>t[h.#l]!==(e?.[h.#l]??e))}removeAllListeners(){this._listeners=[]}isWithin(t,e,i){const s=t[0],r=t[1];if(i){const i=this._viewPos;return this._ctx.isPointInPath(e,t[0]+i[0],t[1]+i[1])}return s>=e[0][0]&&s<=e[1][0]&&r>=e[0][1]&&r<=e[1][1]}get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"Mouse"}get ctx(){return this._ctx}get valid(){return this._valid}get x(){return this._x}get y(){return this._y}get pos(){return[this._x,this._y]}get rawX(){return this._rawX}get rawY(){return this._rawY}get rawPos(){return[this._rawX,this._rawY]}get deltaTimeLastX(){return this.#T}get deltaTimeLastY(){return this.#S}get lastX(){return this._lastPos[0]}get lastY(){return this._lastPos[0]}get lastPos(){return this._lastPos}get dir(){return this._dir}get speed(){return this._speed}get clicked(){return this._clicked}get scrollClicked(){return this._scrollClicked}get rightClicked(){return this._rightClicked}get extraBackClicked(){return this._extraBackClicked}get extraForwardClicked(){return this._extraForwardClicked}get holdValue(){return this._holdValue}get listeners(){return this._listeners}get moveListenersOptimizationEnabled(){return this._moveListenersOptimizationEnabled}set ctx(t){this._ctx=t}set valid(t){this._valid=t}set dir(t){this._dir=t}set speed(t){this._speed=t}set clicked(t){this._clicked=t}set scrollClicked(t){this._scrollClicked=t}set rightClicked(t){this._rightClicked=t}set extraBackClicked(t){this._extraBackClicked=t}set extraForwardClicked(t){this._extraForwardClicked=t}set holdValue(t){this._holdValue=t}}class l{static PROFILE_ID_GIVER=-1;static TEXT_PROFILE_ID_GIVER=-1;static COMPOSITE_OPERATIONS={UNDER:"destionation-over",OVER:"source-over",SOURCE_OVER:"source-over",SOURCE_IN:"source-in",SOURCE_OUT:"source-out",SOURCE_ATOP:"source-atop",DESTINATION_OVER:"destination-over",DESTINATION_IN:"destination-in",DESTINATION_OUT:"destination-out",DESTINATION_ATOP:"destination-atop",LIGHTER:"lighter",COPY:"copy",XOR:"xor",MULTIPLY:"multiply",SCREEN:"screen",OVERLAY:"overlay",DARKEN:"darken",LIGHTEN:"lighten",COLOR_DODGE:"color-dodge",COLOR_BURN:"color-burn",HARD_LIGHT:"hard-light",SOFT_LIGHT:"soft-light",DIFFERENCE:"difference",EXCLUSION:"exclusion",HUE:"hue",SATURATION:"saturation",COLOR:"color",LUMINOSITY:"luminosity"};static FILTERS={BLUR:t=>`blur(${t}px)`,BRIGHTNESS:t=>`brightness(${t})`,CONTRAST:t=>`contrast(${t})`,DROPSHADOW:t=>`drop-shadow(${t})`,GRAYSCALE:t=>`grayscale(${t})`,HUE_ROTATE:t=>`hue-rotate(${t}deg)`,INVERT:t=>`invert(${t})`,OPACITY:t=>`opacity(${t})`,SATURATE:t=>`saturate(${t})`,SEPIA:t=>`sepia(${t})`,URL:t=>`url(${t})`};static DEFAULT_COMPOSITE_OPERATION=l.COMPOSITE_OPERATIONS.SOURCE_OVER;static DEFAULT_FILTER="none";static DEFAULT_ALPHA=1;static PATH_TYPES={LINEAR:l.getLine,QUADRATIC:l.getQuadCurve,CUBIC_BEZIER:l.getBezierCurve,ARC:l.getArc,ARC_TO:l.getArcTo,ELLIPSE:l.getEllispe,RECT:l.getRect,POSITIONS_RECT:l.getPositionsRect,ROUND_RECT:l.getRoundRect,POSITIONS_ROUND_RECT:l.getPositionsRoundRect};static LINE_TYPES={LINEAR:l.getLine,QUADRATIC:l.getQuadCurve,CUBIC_BEZIER:l.getBezierCurve};static DRAW_METHODS={FILL:"FILL",STROKE:"STROKE"};static COLOR_TRANSFORMS={NONE:null,INVERT:1,GRAYSCALE:2,SEPIA:3,RANDOMIZE:4,STATIC:5,MULTIPLY:6,BGRA:7,TINT:8,FORCE_TINT:9};#R=[i.DEFAULT_COLOR_VALUE,l.DEFAULT_FILTER,l.DEFAULT_COMPOSITE_OPERATION,l.DEFAULT_ALPHA];#p=u.DEFAULT_PROFILE.getStyles();#g=_.DEFAULT_PROFILE.getStyles();constructor(t){this._ctx=t,this._batchedStrokes={},this._batchedFills={},this._bactchedStandalones=[],this._defaultProfile=u.DEFAULT_PROFILE.duplicate(this),this._profile1=this._defaultProfile.duplicate(),this._profile2=this._defaultProfile.duplicate(),this._profile3=this._defaultProfile.duplicate(),this._profile4=this._defaultProfile.duplicate(),this._profile5=this._defaultProfile.duplicate(),this._profiles=[],this._defaultTextProfile=_.DEFAULT_PROFILE.duplicate(this),this._textProfile1=this._defaultTextProfile.duplicate(),this._textProfile2=this._defaultTextProfile.duplicate(),this._textProfile3=this._defaultTextProfile.duplicate(),this._textProfile4=this._defaultTextProfile.duplicate(),this._textProfile5=this._defaultTextProfile.duplicate(),this._textProfiles=[]}static getLine(t,e){const i=new Path2D;return i.moveTo(t[0],t[1]),i.lineTo(e[0],e[1]),i}static getQuadCurve(t,e,i=null){Array.isArray(i)||(i=l.getDefaultQuadraticControlPos(t,e,i||void 0));const s=new Path2D;return s.moveTo(t[0],t[1]),s.quadraticCurveTo(i[0],i[1],e[0],e[1]),s}static getDefaultQuadraticControlPos(t,e,i=1){return[e[0]*i,t[1]*i]}static getBezierCurve(t,e,i=null,s=null){if(!s||!i){const r=l.getDefaultBezierControlPos(t,e,i||void 0);i=r[0],s??=r[1]}const r=new Path2D;return r.moveTo(t[0],t[1]),r.bezierCurveTo(i[0],i[1],s[0],s[1],e[0],e[1]),r}static getDefaultBezierControlPos(t,e,i=.75){const[s,r]=t,[n,a]=e;return[[s+(n-s)*(1-i),r+(a-r)*i],[n-(n-s)*(1-i),a-(a-r)*i]]}static getArc(e,i=5,s=0,r=t.CIRC){const n=new Path2D;return n.arc(e[0],e[1],i,s,r),n}static getArcTo(t,e,i,s){const r=new Path2D;return r.moveTo(t[0],t[1]),r.arcTo(e[0],e[1],i[0],i[1],s),r}static getEllispe(e,i,s,r=0,n=0,a=t.CIRC,o=!1){const h=new Path2D;return h.ellipse(e[0],e[1],i,s,r,n,a,o),h}static getRect(t,e,i){const s=new Path2D;return s.rect(t[0],t[1],e,i),s}static getPositionsRect(t,e){const i=new Path2D,s=t[0],r=t[1];return i.rect(s,r,e[0]-s,e[1]-r),i}static getRoundRect(t,e,i,s=5){const r=new Path2D;return r.roundRect(t[0],t[1],e,i,s),r}static getPositionsRoundRect(t,e,i=5){const s=new Path2D,r=t[0],n=t[1];return s.roundRect(r,n,e[0]-r,e[1]-n,i),s}static getFromSVGPath(t){return new Path2D(t)}createCustomStylesProfile(t=this._defaultProfile){const e=t.duplicate();return this._profiles.push(e),e}createCustomTextStylesProfile(t=this._defaultTextProfile){const e=t.duplicate();return this._textProfiles.push(e),e}batchStroke(t,e=i.DEFAULT_RGBA,s=[]){if((e[3]??e.a??1)>i.OPACITY_VISIBILITY_THRESHOLD){const i=this._batchedStrokes,r=s[0],n=s[1],a=s[2],o=e instanceof u?e.toString(void 0,r,n,a):this._defaultProfile.toString(e,r,n,a);i[o]||(i[o]=new Path2D),i[o].addPath(t)}}batchFill(t,e=i.DEFAULT_RGBA,s=[]){if((e[3]??e.a??1)>i.OPACITY_VISIBILITY_THRESHOLD){const i=this._batchedFills,r=s[0],n=s[1],a=s[2],o=e instanceof u?e.fillOptimizedToString(void 0,r,n,a):this._defaultProfile.fillOptimizedToString(e,r,n,a);i[o]||(i[o]=new Path2D),i[o].addPath(t)}}drawBatched(){const t=Object.entries(this._batchedStrokes),e=t.length,i=Object.entries(this._batchedFills),s=i.length,r=this._ctx,n=this._bactchedStandalones,a=n.length,o=C.SERIALIZATION_SEPARATOR,h=g.SERIALIZATION_SEPARATOR,_=l.DEFAULT_FILTER,c=l.DEFAULT_COMPOSITE_OPERATION,E=l.DEFAULT_ALPHA;for(let i=0;i<e;i++){let e=t[i],s=e[0],n=e[1],a=s.split(u.SERIALIZATION_SEPARATOR),l=a[0],_=a[5];l.includes(o)?l=C.getCanvasGradientFromString(r,l):l.includes(h)&&(l=g.LOADED_PATTERN_SOURCES[l.split(h)[0]].value);let c=[];if(_){let t=_.length,e=0;for(let i=0;i<=t;i++)if(","==_[i]||i==t){const t=+_.slice(e,i).trim();t&&c.push(t),e=i+1}}else c[0]=0;u.apply(this,l,a[1],a[2],a[3],a[4],c,a[6],a[7],a[8]),r.stroke(n)}u.apply(this,null,_,c,E);for(let t=0;t<s;t++){let e=i[t],s=e[0],n=e[1],a=s.split(u.SERIALIZATION_SEPARATOR),l=a[0];l.includes(o)?l=C.getCanvasGradientFromString(r,l):l.includes(h)&&(l=g.LOADED_PATTERN_SOURCES[l.split(h)[0]].value),u.apply(this,l,a[1],a[2],a[3]),r.fill(n)}if(u.apply(this,null,_,c,E),a){for(let t=0;t<a;t++)n[t]();this._bactchedStandalones=[]}this._batchedStrokes={},this._batchedFills={}}stroke(t,e=i.DEFAULT_RGBA,s=[]){if((e[3]??e.a??1)>i.OPACITY_VISIBILITY_THRESHOLD){const i=s[0],r=s[1],n=s[2];e instanceof u?e.apply(void 0,i,r,n):this._defaultProfile.apply(e,i,r,n),this._ctx.stroke(t),u.apply(this,null,l.DEFAULT_FILTER,l.DEFAULT_COMPOSITE_OPERATION,l.DEFAULT_ALPHA)}}fill(t,e=i.DEFAULT_RGBA,s=[]){if((e[3]??e.a??1)>i.OPACITY_VISIBILITY_THRESHOLD){const i=s[0],r=s[1],n=s[2];e instanceof u?e.apply(void 0,i,r,n):this._defaultProfile.apply(e,i,r,n),this._ctx.fill(t),u.apply(this,null,l.DEFAULT_FILTER,l.DEFAULT_COMPOSITE_OPERATION,l.DEFAULT_ALPHA)}}strokeText(t,e,s,r,n=void 0,a=R.DEFAULT_LINE_HEIGHT,o=[]){if(t){const h=i.getColorValue(s),c=this.#R,E=this._ctx;if(r instanceof _?r.apply():this._defaultTextProfile.apply(r),s&&c[0]!==h&&(c[0]=E.strokeStyle=E.fillStyle=h),o?.length&&u.apply(this,null,o[0],o[1],o[2]),t.includes("\n")){const i=t.split("\n"),s=i.length;for(let t=0;t<s;t++)E.strokeText(i[t],e[0],e[1]+t*a,n)}else E.strokeText(t,e[0],e[1],n);u.apply(this,null,l.DEFAULT_FILTER,l.DEFAULT_COMPOSITE_OPERATION,l.DEFAULT_ALPHA)}}fillText(t,e,s,r,n=void 0,a=R.DEFAULT_LINE_HEIGHT,o=[]){if(t){const h=i.getColorValue(s),c=this.#R,E=this._ctx;if(r instanceof _?r.apply():this._defaultTextProfile.apply(r),s&&c[0]!==h&&(c[0]=E.strokeStyle=E.fillStyle=h),o?.length&&u.apply(this,null,o[0],o[1],o[2]),t.includes("\n")){const i=t.split("\n"),s=i.length;for(let t=0;t<s;t++)E.fillText(i[t],e[0],e[1]+t*a,n)}else E.fillText(t,e[0],e[1],n);u.apply(this,null,l.DEFAULT_FILTER,l.DEFAULT_COMPOSITE_OPERATION,l.DEFAULT_ALPHA)}}drawImage(t,e,i,s,r=[]){if(r?.length&&u.apply(this,null,r[0],r[1],r[2]),s){const[[r,n],[a,o]]=s;this._ctx.drawImage(t,r,n,a-r,o-r,e[0],e[1],i[0],i[1])}else this._ctx.drawImage(t,e[0],e[1],i[0],i[1]);u.apply(this,null,l.DEFAULT_FILTER,l.DEFAULT_COMPOSITE_OPERATION,l.DEFAULT_ALPHA)}drawLateImage(t,e,i,s,r=[]){this._bactchedStandalones.push(()=>{if(r?.length&&u.apply(this,null,r[0],r[1],r[2]),s){const[[r,n],[a,o]]=s;this._ctx.drawImage(t,r,n,a-r,o-r,e[0],e[1],i[0],i[1])}else this._ctx.drawImage(t,e[0],e[1],i[0],i[1]);u.apply(this,null,l.DEFAULT_FILTER,l.DEFAULT_COMPOSITE_OPERATION,l.DEFAULT_ALPHA)})}replaceColor(t,e=i.DEFAULT_RGBA,s=i.DEFAULT_TEMPERANCE,r=null,n=1,a=!1){const o=()=>{const i=this._ctx,a=i.canvas,o=r?.[0]?.[0]??0,h=r?.[0]?.[1]??0,l=i.getImageData(o,h,r?.[1]?.[0]-o||a.width,r?.[1]?.[1]-h||a.height),_=l.data,u=_.length,c=t.r??t[0],E=t.g??t[1],d=t.b??t[2],T=e.r??e[0],S=e.g??e[1],A=e.b??e[2],R=255*(e.a??e[3]),p=4*(n>0?n:1);if(s){let t,e,i,r=s[0]??s,n=s[1]??s,a=s[2]??s,o=c-r,h=E-n,l=d-a,g=c+r,I=E+n,O=d+a;for(let s=0;s<u;s+=p)t=_[s],t>=o&&t<=g&&(e=_[s+1],i=_[s+2],e>=h&&e<=I&&i>=l&&i<=O&&(_[s]=T,_[s+1]=S,_[s+2]=A,_[s+3]=R))}else for(let t=0;t<u;t+=p)_[t]==c&&_[t+1]==E&&_[t+2]==d&&(_[t]=T,_[t+1]=S,_[t+2]=A,_[t+3]=R);i.putImageData(l,o,h)};a?o():this._bactchedStandalones.push(o)}transformArea(e=COLOR_TRANSFORMS.NONE,i,s=null,r=1,n=!1){if(e){const a=()=>{const n=this._ctx,a=n.canvas,o=s?.[0]?.[0]??0,h=s?.[0]?.[1]??0,_=n.getImageData(o,h,s?.[1]?.[0]-o||a.width,s?.[1]?.[1]-h||a.height),u=_.data,c=u.length,E=l.COLOR_TRANSFORMS,d=t.random,T=4*(r>0?r:1);if(e==E.INVERT){i??=1;for(let t=0;t<c;t+=T){const e=u[t],s=u[t+1],r=u[t+2];u[t]=255*i-e,u[t+1]=255*i-s,u[t+2]=255*i-r}}else if(e==E.GRAYSCALE){i??=1;for(let t=0;t<c;t+=T){const e=(u[t]+u[t+1]+u[t+2])/3;u[t]=e*i,u[t+1]=e*i,u[t+2]=e*i}}else if(e==E.SEPIA){i??=1;for(let t=0;t<c;t+=T){const e=u[t],s=u[t+1],r=u[t+2];u[t]=(.393*e+.769*s+.189*r)*i,u[t+1]=(.349*e+.686*s+.168*r)*i,u[t+2]=(.272*e+.534*s+.131*r)*i}}else if(e==E.RANDOMIZE){i||=[0,255];for(let t=0;t<c;t+=T)u[t]=d(i[0],i[1]),u[t+1]=d(i[0],i[1]),u[t+2]=d(i[0],i[1])}else if(e==E.STATIC){i||=[0,255];for(let t=0;t<c;t+=T)u[t]=u[t+1]=u[t+2]=d(i[0],i[1])}else if(e==E.MULTIPLY){i??=1;for(let t=0;t<c;t+=T)u[t]*=i,u[t+1]*=i,u[t+2]*=i}else if(e==E.BGRA){i??=1;for(let t=0;t<c;t+=T){const e=u[t],s=u[t+1],r=u[t+2];u[t]=r*i,u[t+1]=s*i,u[t+2]=e*i}}else if(e==E.TINT){i||=[255,255,255,1];for(let t=0;t<c;t+=T)u[t]+=i[0],u[t+1]+=i[1],u[t+2]+=i[2],u[t+3]+=i[3]}else if(e==E.FORCE_TINT){i||=[255,255,255,1];for(let t=0;t<c;t+=T)u[t]=i[0],u[t+1]=i[1],u[t+2]=i[2]}n.putImageData(_,o,h)};n?a():this._bactchedStandalones.push(a)}}static generate(t,e,i,s=100,r=null){t??=[0,0],e??=()=>0,i??=100,s??=100;const n=Math.sign(i),a=Math.abs(i)+.1;if(a>1&&s>1){const o=(a-.1)/s,h=t[0],l=t[1],_=r?r(t,e,i,s):new Path2D;_.moveTo(h,l+e(0));for(let t=0;t<=a;t+=o)_.lineTo(h+t*n,l+e(t*n));return _}return null}static getGenerationEndPos(e,i,s){return t.addPos(e,[s,t.round(i(s),T.POSITION_PRECISION)])}static composePath(t,e){const i=new Path2D,s=t.length,r=t[0];i.moveTo(r[0],r[1]);for(let r=1;r<s;r++){const s=t[r].pos||t[r];e?i.addPath(e(t[r-1].pos||t[r-1],s)):i.lineTo(s[0],s[1])}return i}static mergePaths(t){const e=t.length,i=t[0];for(let s=1;s<e;s++)i.addPath(t[s]);return i}static Y_FUNCTIONS={SINUS:(t=100,e=100)=>{t??=100,e??=100,e=2*Math.PI/Math.abs(e);const i=Math.sin,s=Math.abs(t)/2*Math.sign(t);return t=>s*i(e*t)},COSINUS:(t=100,e=100)=>{t??=100,e??=100,e=2*Math.PI/Math.abs(e);const i=Math.cos,s=Math.abs(t)/2*Math.sign(t);return t=>s*i(e*t)},LINEAR:(t=1)=>(t??=1,e=>t*e)};get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"Render"}get ctx(){return this._ctx}get batchedStrokes(){return this._batchedStrokes}get batchedFills(){return this._bactchedStandalones}get batchedStandalones(){return this._batchedImages}get defaultProfile(){return this._defaultProfile}get profile1(){return this._profile1}get profile2(){return this._profile2}get profile3(){return this._profile3}get profile4(){return this._profile4}get profile5(){return this._profile5}get profiles(){return this._profiles}get defaultTextProfile(){return this._defaultTextProfile}get textProfile1(){return this._textProfile1}get textProfile2(){return this._textProfile2}get textProfile3(){return this._textProfile3}get textProfile4(){return this._textProfile4}get textProfile5(){return this._textProfile5}get textProfiles(){return this._textProfiles}get currentCtxVisuals(){return this.#R}get currentCtxStyles(){return this.#p}get currentCtxTextStyles(){return this.#g}set ctx(t){this._ctx=t}set defaultProfile(t){this._defaultProfile=t}set profile1(t){this._profile1=t}set profile2(t){this._profile2=t}set profile3(t){this._profile3=t}set profile4(t){this._profile4=t}set profile5(t){this._profile5=t}set profiles(t){this._profiles=t}set defaultTextProfile(t){this._defaultTextProfile=t}set textProfile1(t){this._textProfile1=t}set textProfile2(t){this._textProfile2=t}set textProfile3(t){this._textProfile3=t}set textProfile4(t){this._textProfile4=t}set textProfile5(t){this._textProfile5=t}set textProfiles(t){this._textProfiles=t}set currentCtxVisuals(t){this.#R=t}set currentCtxStyles(t){this.#p=t}set currentCtxTextStyles(t){this.#g=t}}class _{static CAPS_VARIANTS={NORMAL:"normal",SMALL_CAPS:"small-caps",ALL_SMALL_CAPS:"all-small-caps",PETITE_CAPS:"petite-caps",ALL_PETITE_CAPS:"all-petite-caps",UNICASE:"unicase",TILTING_CAPS:"tilting-caps"};static DIRECTIONS={LEFT_TO_RIGHT:"ltr",RIGHT_TO_LEFT:"rtl",INHERIT:"inherit"};static STRETCHES={ULTRA_CONDENSED:"ultra-condensed",EXTRA_CONDENSED:"extra-condensed",CONDENSED:"condensed",SEMI_CONDENSED:"semi-condensed",NORMAL:"normal",SEMI_EXPANDED:"semi-expanded",EXPANDED:"expanded",EXTRA_EXPANDED:"extra-expanded",ULTRA_EXPANDED:"ultra-expanded"};static KERNINGS={AUTO:"auto",NORMAL:"normal",NONE:"none"};static ALIGNMENTS={LEFT:"left",RIGHT:"right",CENTER:"center",START:"start",END:"end"};static BASELINES={TOP:"top",BOTTOM:"bottom",HANGING:"hanging",MIDDLE:"middle",ALPHABETIC:"alphabetic",IDEOGRAPHIC:"ideographic"};static RENDERINGS={AUTO:"auto",FAST:"optimizeSpeed",LEGIBLE:"optimizeLegibility",PRECISE:"geometricPrecision"};static DEFAULT_FONT="32px Arial";static DEFAULT_LETTER_SPACING="2px";static DEFAULT_WORD_SPACING="4px";static DEFAULT_FONT_VARIANT_CAPS=_.CAPS_VARIANTS.NORMAL;static DEFAULT_DIRECTION=_.DIRECTIONS.LEFT_TO_RIGHT;static DEFAULT_FONT_STRETCH=_.STRETCHES.NORMAL;static DEFAULT_FONT_KERNING=_.KERNINGS.NORMAL;static DEFAULT_TEXT_ALIGN=_.ALIGNMENTS.CENTER;static DEFAULT_TEXT_BASELINE=_.BASELINES.MIDDLE;static DEFAULT_TEXT_RENDERING=_.RENDERINGS.FAST;static DEFAULT_PROFILE=new _(null,_.DEFAULT_FONT,_.DEFAULT_LETTER_SPACING,_.DEFAULT_WORD_SPACING,_.DEFAULT_FONT_VARIANT_CAPS,_.DEFAULT_DIRECTION,_.DEFAULT_FONT_STRETCH,_.DEFAULT_FONT_KERNING,_.DEFAULT_TEXT_ALIGN,_.DEFAULT_TEXT_BASELINE,_.DEFAULT_TEXT_RENDERING);static SUPPORTED_FONTS_FORMATS=["woff","woff2","ttf","otf"];static#I=1;#O=null;constructor(t,e,i,s,r,n,a,o,h,u,c){this._id=l.TEXT_PROFILE_ID_GIVER++,this._render=t,this.#O=t?.ctx,this._font=e??_.DEFAULT_FONT,this._letterSpacing=i??_.DEFAULT_LETTER_SPACING,this._wordSpacing=s??_.DEFAULT_WORD_SPACING,this._fontVariantCaps=r??_.DEFAULT_FONT_VARIANT_CAPS,this._direction=n??_.DEFAULT_DIRECTION,this._fontStretch=a??_.DEFAULT_FONT_STRETCH,this._fontKerning=o??_.DEFAULT_FONT_KERNING,this._textAlign=h??_.DEFAULT_TEXT_ALIGN,this._textBaseline=u??_.DEFAULT_TEXT_BASELINE,this._textRendering=c??_.DEFAULT_TEXT_RENDERING}duplicate(t=this._render,e=this._font,i=this._letterSpacing,s=this._wordSpacing,r=this._fontVariantCaps,n=this._direction,a=this._fontStretch,o=this._fontKerning,h=this._textAlign,l=this._textBaseline,u=this._textRendering){return new _(t,e,i,s,r,n,a,o,h,l,u)}getStyles(){return[this._font,this._letterSpacing,this._wordSpacing,this._fontVariantCaps,this._direction,this._fontStretch,this._fontKerning,this._textAlign,this._textBaseline,this._textRendering]}update(t,e,i,s,r,n,a,o,h,l){return t&&(this._font=t),e&&(this._letterSpacing="number"==typeof e?e+"px":e),i&&(this._wordSpacing="number"==typeof i?i+"px":i),s&&(this._fontVariantCaps=s),r&&(this._direction=r),n&&(this._fontStretch=n),a&&(this._fontKerning=a),o&&(this._textAlign=o),h&&(this._textBaseline=h),l&&(this._textRendering=l),this}apply(t=this._font,e=this._letterSpacing,i=this._wordSpacing,s=this._fontVariantCaps,r=this._direction,n=this._fontStretch,a=this._fontKerning,o=this._textAlign,h=this._textBaseline,l=this._textRendering){const _=this.#O,u=this._render.currentCtxTextStyles;t&&u[0]!==t&&(u[0]=_.font=t),e&&u[1]!==e&&(u[1]=_.letterSpacing=e),i&&u[2]!==i&&(u[2]=_.wordSpacing=i),s&&u[3]!==s&&(u[3]=_.fontVariantCaps=s),r&&u[4]!==r&&(u[4]=_.direction=r),n&&u[5]!==n&&(u[5]=_.fontStretch=n),a&&u[6]!==a&&(u[6]=_.fontKerning=a),o&&u[7]!==o&&(u[7]=_.textAlign=o),h&&u[8]!==h&&(u[8]=_.textBaseline=h),l&&u[9]!==l&&(u[9]=_.textRendering=l)}static apply(t,e,i,s,r,n,a,o,h,l,_){const u=[t.font,t.letterSpacing,t.wordSpacing,t.fontVariantCaps,t.direction,t.fontStretch,t.fontKerning,t.textAlign,t.textBaseline,t.textRendering];e&&u[0]!==e&&(u[0]=t.font=e),i&&u[1]!==i&&(u[1]=t.letterSpacing=i),s&&u[2]!==s&&(u[2]=t.wordSpacing=s),r&&u[3]!==r&&(u[3]=t.fontVariantCaps=r),n&&u[4]!==n&&(u[4]=t.direction=n),a&&u[5]!==a&&(u[5]=t.fontStretch=a),o&&u[6]!==o&&(u[6]=t.fontKerning=o),h&&u[7]!==h&&(u[7]=t.textAlign=h),l&&u[8]!==l&&(u[8]=t.textBaseline=l),_&&u[9]!==_&&(u[9]=t.textRendering=_)}static isFontFormatSupported(t){const e=(t?.name||t).toLowerCase();return _.SUPPORTED_FONTS_FORMATS.some(t=>e.endsWith("."+t))}static loadCustomFont(e,i=null,s={},r=null,n=t=>console.warn("Error loading font:",e,t)){if(_.isFontFormatSupported(e)||e instanceof ArrayBuffer||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof BigInt64Array||e instanceof BigUint64Array){const a=new FontFace(i||"customFont"+_.#I++,`url(${e})`,s);return a.load().then(e=>{document.fonts.add(e),t.isFunction(r)&&r(a,a.family)}).catch(e=>{t.isFunction(n)&&n(e)}),a}{const t=document.createElement("link");return t.rel="stylesheet",t.type="text/css",t.href=e,t.id="customFont"+_.#I++,document.querySelector("head").appendChild(t)}}static getFontStyleDeclaration(t,e,i=null,s=null,r=null,n=null){return n&&(e=`${e}/${n}`),[s,r,i,e,t=t.split(",").map(t=>(t=t.trim()).includes(" ")&&!t.match(/['"`]/g)?`'${t}'`:t).join(", ")].filter(Boolean).join(" ")}[Symbol.toPrimitive](){return this.toString()}*[Symbol.iterator](){const t=this.getStyles(),e=t.length;for(let i=0;i<e;i++)yield t[i]}get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"TextStyles"}get id(){return this.id}get render(){return this._render}get font(){return this._font}get letterSpacing(){return+this._letterSpacing.replace("px","")}get wordSpacing(){return+this._wordSpacing.replace("px","")}get fontVariantCaps(){return this._fontVariantCaps}get direction(){return this._direction}get fontStretch(){return this._fontStretch}get fontKerning(){return this._fontKerning}get textAlign(){return this._textAlign}get textBaseline(){return this._textBaseline}get textRendering(){return this._textRendering}set render(t){this._render=t,this.#O=t.ctx}set font(t){this._font=t}set letterSpacing(t){this._letterSpacing="number"==typeof t?t+"px":t}set wordSpacing(t){this._wordSpacing="number"==typeof t?t+"px":t}set fontVariantCaps(t){this._fontVariantCaps=t}set direction(t){this._direction=t}set fontStretch(t){this._fontStretch=t}set fontKerning(t){this._fontKerning=t}set textAlign(t){this._textAlign=t}set textBaseline(t){this._textBaseline=t}set textRendering(t){this._textRendering=t}}class u extends n{static JOIN_TYPES={MITER:"miter",BEVEL:"bevel",ROUND:"round"};static CAP_TYPES={BUTT:"butt",SQUARE:"square",ROUND:"round"};static DEFAULT_WIDTH=2;static DEFAULT_CAP=u.CAP_TYPES.ROUND;static DEFAULT_JOIN=u.JOIN_TYPES.MITER;static DEFAULT_DASH=[];static DEFAULT_DASH_OFFSET=0;static SERIALIZATION_SEPARATOR="%";static DEFAULT_PROFILE=new u(null,i.DEFAULT_RGBA,l.DEFAULT_FILTER,l.DEFAULT_COMPOSITE_OPERATION,l.DEFAULT_ALPHA,u.DEFAULT_WIDTH,u.DEFAULT_DASH,u.DEFAULT_DASH_OFFSET,u.DEFAULT_JOIN,u.DEFAULT_CAP);#O=null;constructor(t,e,i,s,r,n,a,o,h,_){super(e),t&&(this.color=this.getInitColor()),this._id=l.PROFILE_ID_GIVER++,this._render=t,this.#O=t?.ctx,this._filter=i??l.DEFAULT_FILTER,this._compositeOperation=s??l.DEFAULT_COMPOSITE_OPERATION,this._opacity=r??l.DEFAULT_ALPHA,this._lineWidth=n??u.DEFAULT_WIDTH,this._lineDash=a??u.DEFAULT_DASH,this._lineDashOffset=o??u.DEFAULT_DASH_OFFSET,this._lineJoin=h??u.DEFAULT_JOIN,this._lineCap=_??u.DEFAULT_CAP}duplicate(t=this._render,e=this._color,s=this._filter,r=this._compositeOperation,n=this._opacity,a=this._lineWidth,o=this._lineDash,h=this._lineDashOffset,l=this._lineJoin,_=this._lineCap){return new u(t,i.uniquify(e),s,r,n,a,o,h,l,_)}getStyles(){return[this._lineWidth,this._lineDash,this._lineDashOffset,this._lineJoin,this._lineCap]}toString(t=this._color,e=this._filter,s=this._compositeOperation,r=this._opacity,n=this._lineWidth,a=this._lineDash,o=this._lineDashOffset,h=this._lineJoin,l=this._lineCap){let _=u.SERIALIZATION_SEPARATOR,c=i.getColorValue(t);return(c instanceof CanvasGradient||c instanceof CanvasPattern)&&(c=t.toString()),c+_+e+_+s+_+r+_+n+_+a+_+o+_+h+_+l}fillOptimizedToString(t=this._color,e=this._filter,s=this._compositeOperation,r=this._opacity){let n=u.SERIALIZATION_SEPARATOR,a=i.getColorValue(t);return(a instanceof CanvasGradient||a instanceof CanvasPattern)&&(a=t.toString()),a+n+e+n+s+n+r}update(t,e,i,s,r,n,a,o,h){return t&&(this.color=t),e&&(this._filter=e),i&&(this._compositeOperation=i),null!=s&&(this._opacity=s),r&&(this._lineWidth=r),n&&(this._lineDash=n),a&&(this._lineDashOffset=a),o&&(this._lineJoin=o),h&&(this._lineCap=h),this}apply(t=this._color,e=this._filter,s=this._compositeOperation,r=this._opacity,n=this._lineWidth,a=this._lineDash,o=this._lineDashOffset,h=this._lineJoin,l=this._lineCap){const _=this.#O,u=i.getColorValue(t),c=this._render.currentCtxStyles,E=this._render.currentCtxVisuals;if(!t||E[0]===u&&_.strokeStyle===u||(E[0]=_.strokeStyle=_.fillStyle=u),e&&E[1]!==e&&(E[1]=_.filter=e),s&&E[2]!==s&&(E[2]=_.globalCompositeOperation=s),null!=r&&E[3]!==r&&(E[3]=_.globalAlpha=r),null!=n&&c[0]!==n&&(c[0]=_.lineWidth=n),a){const t=a.toString();c[1]!==t&&(c[1]=t,_.setLineDash(a))}null!==o&&c[2]!==o&&(c[2]=_.lineDashOffset=o),h&&c[3]!==h&&(c[3]=_.lineJoin=h),l&&c[4]!==l&&(c[4]=_.lineCap=l)}static apply(t,e,s,r,n,a,o,h,l,_){const u=t.ctx,c=e&&i.getColorValue(e),E=t.currentCtxStyles,d=t.currentCtxVisuals;if(!e||d[0]===c&&u.strokeStyle===c||(d[0]=u.strokeStyle=u.fillStyle=c),s&&d[1]!==s&&(d[1]=u.filter=s),r&&d[2]!==r&&(d[2]=u.globalCompositeOperation=r),null!=n&&d[3]!==n&&(d[3]=u.globalAlpha=n),null!=a&&E[0]!==a&&(E[0]=u.lineWidth=a),o){const t=o.toString();E[1]!==t&&(E[1]=t,u.setLineDash(o))}null!==h&&E[2]!==h&&(E[2]=u.lineDashOffset=h),l&&E[3]!==l&&(E[3]=u.lineJoin=l),_&&E[4]!==_&&(E[4]=u.lineCap=_)}[Symbol.toPrimitive](){return this.toString()}*[Symbol.iterator](){const t=this.getStyles(),e=t.length;for(let i=0;i<e;i++)yield t[i]}get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"RenderStyles"}get id(){return this.id}get render(){return this._render}get lineWidth(){return this._lineWidth}get lineCap(){return this._lineCap}get lineJoin(){return this._lineJoin}get lineDash(){return this._lineDash}get lineDashOffset(){return this._lineDashOffset}set render(t){this._render=t,this.#O=t.ctx}set lineWidth(t){return this._lineWidth=t}set lineCap(t){return this._lineCap=t}set lineJoin(t){return this._lineJoin=t}set lineDash(t){return this._lineDash=t}set lineDashOffset(t){return this._lineDashOffset=t}}const c=window?.requestAnimationFrame||window?.webkitRequestAnimationFrame||window?.mozRequestAnimationFrame||window?.msRequestAnimationFrame||function(t){window?.setTimeout(()=>t(performance.now()),1e3/60)};class E{static DOMParser=new DOMParser;static CANVAS_ID_GIVER=0;static ELEMENT_ID_GIVER=0;static DEFAULT_MAX_DELTATIME_MS=130;static DEFAULT_MAX_DELTATIME=E.DEFAULT_MAX_DELTATIME_MS/1e3;static DEFAULT_MAXDELAY_MULTIPLIER=.44;static DEFAULT_CANVAS_ACTIVE_AREA_PADDING=25;static DEFAULT_CVSDE_ATTR="_CVSDE";static DEFAULT_CVSFRAMEDE_ATTR="_CVSDE_F";static DEFAULT_CUSTOM_SVG_FILTER_ID_PREFIX="CDE_FE_";static DEFAULT_CUSTOM_SVG_FILTER_CONTAINER_ID=E.DEFAULT_CUSTOM_SVG_FILTER_ID_PREFIX+"CONTAINER";static CURSOR_STYLES={CUSTOM:(t,e=[0,0],i=E.CURSOR_STYLES.AUTO)=>`url("${t}") ${e.join(" ")}, ${i}`,AUTO:"auto",POINTER:"pointer",DEFAULT:"default",CROSSHAIR:"crosshair",MOVE:"move",TEXT:"text",WAIT:"wait",HELP:"help",NONE:"none",GRAB:"grab",GRABBING:"grabbing",ALL_SCROLL:"all-scroll",COL_RESIZE:"col-resize",ROW_RESIZE:"row-resize",N_RESIZE:"n-resize",E_RESIZE:"e-resize",S_RESIZE:"s-resize",W_RESIZE:"w-resize",NE_RESIZE:"ne-resize",NW_RESIZE:"nw-resize",SE_RESIZE:"se-resize",SW_RESIZE:"sw-resize",ZOOM_IN:"zoom-in",ZOOM_OUT:"zoom-out",NO_DROP:"no-drop",COPY:"copy",NOT_ALLOWED:"not-allowed",VERTICAL_TEXT:"vertical-text",CELL:"cell",CONTEXT_MENU:"context-menu",EXT_RESIZE:"ext-resize",DEFAULT_ARROW:"default",UNSET:"unset"};static LOADED_SVG_FILTERS={};static DEFAULT_CTX_SETTINGS={imageSmoothingEnabled:!1,font:_.DEFAULT_FONT,letterSpacing:_.DEFAULT_LETTER_SPACING,wordSpacing:_.DEFAULT_WORD_SPACING,fontVariantCaps:_.DEFAULT_FONT_VARIANT_CAPS,direction:_.DEFAULT_DIRECTION,fontSretch:_.DEFAULT_FONT_STRETCH,fontKerning:_.DEFAULT_FONT_KERNING,textAlign:_.DEFAULT_TEXT_ALIGN,textBaseline:_.DEFAULT_TEXT_BASELINE,textRendering:_.DEFAULT_TEXT_RENDERING,lineDashOffset:u.DEFAULT_DASH_OFFSET,lineJoin:u.DEFAULT_JOIN,lineCap:u.DEFAULT_CAP,lineWidth:u.DEFAULT_WIDTH,fillStyle:i.DEFAULT_COLOR,stokeStyle:i.DEFAULT_COLOR};static DEFAULT_CANVAS_WIDTH=800;static DEFAULT_CANVAS_HEIGHT=800;static DEFAULT_CANVAS_STYLES={position:"absolute",top:"0",left:"0",width:"100%",height:"100%","background-color":"transparent",border:"none",outline:"none","pointer-events":"none !important","z-index":0,padding:"0 !important",margin:"0","-webkit-transform":"translate3d(0, 0, 0)","-moz-transform":"translate3d(0, 0, 0)","-ms-transform":"translate3d(0, 0, 0)",transform:"translate3d(0, 0, 0)","touch-action":"none","-webkit-user-select":"none","user-select":"none"};static STATIC_MODE=0;static STATIC="static";static STATES={STOPPED:0,LOOPING:1,REQUESTED_STOP:2};static#C=[];static#P=[];static DEFAULT_MOUSE_MOVE_THROTTLE_DELAY=10;static ACTIVATION_MARGIN_DISABLED=0;static MOBILE_SCROLLING_STATES={DISABLED:0,IF_CANVAS_STOPPED:1,ALWAYS:2};static#f=new Map;static#m=new IntersectionObserver(e=>{const i=e.length;for(let s=0;s<i;s++){const i=e[s],r=E.getFromHTMLCanvas(i.target);t.isFunction(r._onIntersectionChangeCB)&&r._onIntersectionChangeCB(i.intersectionRatio>0,r,i)}});#D=0;#L=0;#N=0;#b=null;#M=null;#y=null;#U=[];#F=null;#v=null;#B=[window.scrollX,window.screenY];#x=null;#w=[];#G=E.MOBILE_SCROLLING_STATES.IF_CANVAS_STOPPED;constructor(t,e,i=null,s,r=E.DEFAULT_CTX_SETTINGS,n=!1){if(this._id=E.CANVAS_ID_GIVER++,!t)throw new Error("The cvs (canvas) parameter is undefined");if(this._cvs=t,this.isOffscreenCanvas||(this._frame=s??t?.parentElement,this._cvs.setAttribute(E.DEFAULT_CVSDE_ATTR,!0),this._frame.setAttribute(E.DEFAULT_CVSFRAMEDE_ATTR,!0),this.onVisibilityChangeCB=null,this._onResizeCB=null,this._onScrollCB=null,this.onIntersectionChangeCB=null,E.#m.observe(this._cvs),E.#f.set(this._cvs,this)),this._ctx=this._cvs.getContext("2d",{willReadFrequently:n??!1}),this._settings=this.updateSettings(r||E.DEFAULT_CTX_SETTINGS),this._els={refs:[],defs:[]},this._state=0,this._loopingCB=e,this.fpsLimit=i,this._speedModifier=1,this.#M=this.#V(i),this._deltaTime=null,this._fixedTimeStamp=null,this._windowListeners=this.#H(),this._viewPos=[0,0],this._zoom=1,this.isOffscreenCanvas)this.#v=[this._cvs.width,this._cvs.height];else{const t=this._frame?.getBoundingClientRect()??{width:E.DEFAULT_CANVAS_WIDTH,height:E.DEFAULT_CANVAS_HEIGHT};this.setSize(t.width,t.height),this.#Y(),this._offset=this.updateOffset()}this._typingDevice=new o,this._mouse=new h(this._ctx),this._render=new l(this._ctx),this._anims=[],this._mouseMoveThrottlingDelay=E.DEFAULT_MOUSE_MOVE_THROTTLE_DELAY}static create(t=null,e,i=null,s,r=E.DEFAULT_CTX_SETTINGS,n=!1){const a=document.createElement("canvas");return(t||document.documentElement).appendChild(a),new E(a,e,i,s,r,n)}static preventNativeZoom(e){const i=t.isFunction(e);document.addEventListener("wheel",t=>{(t.ctrlKey||t.metaKey)&&(t.preventDefault(),i&&e(Math.sign(t.deltaY),!0))},{passive:!1}),document.addEventListener("keydown",t=>{const s=t.key;o.KEY_GROUPS.NATIVE_ZOOM_KEYS.includes(s)&&(t.ctrlKey||t.metaKey)&&(t.preventDefault(),i&&e("-"===s?1:-1,!1))})}#Y(){const t=document.createElement("style");t.appendChild(document.createTextNode(`[${E.DEFAULT_CVSFRAMEDE_ATTR}]{position:relative !important;outline: none;}canvas[${E.DEFAULT_CVSDE_ATTR}]{${Object.entries(E.DEFAULT_CANVAS_STYLES).reduce((t,e)=>t+`${e[0]}:${e[1]};`,"")}}`)),this._cvs.appendChild(t),this._frame.setAttribute("tabindex",0),this._cvs.setAttribute("draggable","false")}#H(){const e=e=>{const s=this._render,r=this._ctx,[n,a,o,h,l]=s.currentCtxStyles,[c,d,T,S,A,R,p,g,I,O]=s.currentCtxTextStyles,[C,P,f,m]=s.currentCtxVisuals;this.setSize(),r.strokeStyle=r.fillStyle=i.getColorValue(C),s.currentCtxStyles[0]=r.lineWidth,"string"==typeof a&&(s.currentCtxStyles[1]=a.split(",")),s.currentCtxStyles[2]=r.lineDashOffset,s.currentCtxStyles[3]=r.lineJoin,s.currentCtxStyles[4]=r.lineCap,u.apply(s,null,P,f,m,n,"string"==typeof a?a.split(","):a,o,h,l),_.apply(r,c,d,T,S,A,R,p,g,I,O),this.moveViewAt(this._viewPos),this.hasBeenStarted&&(this._fpsLimit>=25||this._state==E.STATES.STOPPED)&&this.drawSingleFrame(),t.isFunction(this._onResizeCB)&&this._onResizeCB(this.size,this,e)},s=t=>{this._typingDevice.clearPressed(),this._onVisibilityChangeCB(!document.hidden,this,t)},r=e=>{const i=window.scrollX,s=window.scrollY,r=this._mouse.x,n=this._mouse.y;this.updateOffset(),null!=r&&null!=n&&(this._mouse.updatePos(this._mouse.x+(i-this.#B[0]),this._mouse.y+(s-this.#B[1]),[0,0]),this.#k()),this.#B[0]=i,this.#B[1]=s,t.isFunction(this._onScrollCB)&&this._onScrollCB([i,s],this,e)},n=t=>{const e=E.#C,i=e?.length;if(i)for(let s=0;s<i;s++)e[s](t,this);E.#C=null},a=()=>{this._typingDevice.clearPressed()};return this.isOffscreenCanvas||(window.addEventListener("resize",e),window.addEventListener("visibilitychange",s),window.addEventListener("scroll",r),window.addEventListener("blur",a)),window.addEventListener("load",n),this.isOffscreenCanvas?{removeOnloadListener:()=>window.removeEventListener("load",n)}:{removeOnreziseListener:()=>window.removeEventListener("resize",e),removeOnvisibilitychangeListener:()=>window.removeEventListener("visibilitychange",s),removeOnscrollListener:()=>window.removeEventListener("scroll",r),removeOnBlurListener:()=>window.removeEventListener("blur",a),removeOnloadListener:()=>window.removeEventListener("load",n)}}static getFromHTMLCanvas(t){return E.#f.get(t)}setCursorStyle(t=E.CURSOR_STYLES.DEFAULT){const e=this._frame;e.style.cursor!==t&&(e.style.cursor=t)}static addOnLoadCallback(e){t.isFunction(e)&&E.#C&&E.#C.push(e)}static addOnFirstInteractCallback(e){t.isFunction(e)&&E.#P&&E.#P.push(e)}static loadSVGFilter(t,e){let i=document.getElementById(E.DEFAULT_CUSTOM_SVG_FILTER_CONTAINER_ID),s=(new DOMParser).parseFromString(t,"text/html").body.firstChild,r=s.querySelector("filter"),n=document.createElement("div");return e?r.id=e:e=r.id,n.id=E.DEFAULT_CUSTOM_SVG_FILTER_ID_PREFIX+e,n.appendChild(s),i||(i=document.createElement("div"),i.id=E.DEFAULT_CUSTOM_SVG_FILTER_CONTAINER_ID,document.head.appendChild(i)),i.appendChild(n),E.LOADED_SVG_FILTERS[e]=[...r.children],e}static getSVGFilter(t){return E.LOADED_SVG_FILTERS[t]}static removeSVGFilter(t){t=E.DEFAULT_CUSTOM_SVG_FILTER_ID_PREFIX+t,document.getElementById(t).remove(),delete E.LOADED_SVG_FILTERS[t]}updateOffset(){const{width:t,height:e,x:i,y:s}=this._cvs.getBoundingClientRect(),r=this._zoom;return this._offset=[Math.round(i+t-this.width)+this._viewPos[0],Math.round(s+e-this.height)+this._viewPos[1],r]}#z(t,e){this.#b=t;const i=(t-this.#D)*this._speedModifier,s=this._fpsLimit;if(2!=this._state)if(s){const r=t-this.#L;r>=s&&(this._fixedTimeStamp=(this.#y+=i)-this.#N,e||this.#W(t),this.#D=t,this.#L=t-r%s)}else this._fixedTimeStamp=(this.#y+=i)-this.#N,e||this.#W(t),this.#D=t;1==this._state?c(this.#z.bind(this)):this._state=0}drawSingleFrame(t=null){let e=this._mouse,i=this._loopingCB,s=null!=t,r=s?this.#K(t):this._deltaTime;if(e._moveListenersOptimizationEnabled||(e.checkListeners(h.LISTENER_TYPES.ENTER),e.checkListeners(h.LISTENER_TYPES.LEAVE)),this.clear(),this.draw(),this._render.drawBatched(),i&&this._loopingCB(r),s){const e=this._anims,i=e.length;if(this.#y=this._fixedTimeStamp=t,i)for(let t=0;t<i;t++)e[t].getFrame(this.#y,r)}}#W(t){const e=this.#K(t),i=this._mouse,s=this._loopingCB;i.calcSpeed(e),i._moveListenersOptimizationEnabled||(i.checkListeners(h.LISTENER_TYPES.ENTER),i.checkListeners(h.LISTENER_TYPES.LEAVE)),this.clear(),this.draw(),this._render.drawBatched(),s&&this._loopingCB(e);const r=this._anims,n=r.length;if(n)for(let t=0;t<n;t++)r[t].getFrame(this.timeStamp,e)}startLoop(){if(1!=this._state){if(2==this._state)return this._state=1;this._state=1,this.#D&&(this.#N+=(performance.now()-this.#D)*this._speedModifier),this.#z(this.#y||0,!0)}}start(){this.startLoop()}stopLoop(){this._state&&(this._state=2)}stop(){this.stopLoop()}#K(t=0){const e=(t-this.#D)/1e3,i=this.#M/1e3;return this._deltaTime=e>i?i:e}#V(t){return t?t<7?(1.05*(14-t))**3*E.DEFAULT_MAXDELAY_MULTIPLIER:Math.max((360-t)*E.DEFAULT_MAXDELAY_MULTIPLIER,50):E.DEFAULT_MAX_DELTATIME_MS}updateCachedAllEls(){const t=[];t.push(...this.refs),this._els.refs.forEach(e=>t.push(...e.asSource)),t.push(...this._els.defs),this.#U=t,this.#F=t.length}draw(){const t=this.#U,e=this.#F,i=this._render,s=this._deltaTime*this._speedModifier,r=this.timeStamp;for(let n=0;n<e;n++){const e=t[n],a=e.activationMargin;a&&(!0===a||!e.initialized||this.isWithin(e.pos,a))&&e.draw&&e.draw(i,r,s)}}clear(t=0,e=0,i=this.width,s=this.height){this._viewPos[0]||this._viewPos[1]||1!==this._zoom?(this.save(),this.ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(t,e,i,s),this.restore()):this._ctx.clearRect(t,e,i,s)}initializeStatic(){this.fpsLimit=0,this.draw(),this.drawStatic();const e=this.getObjs(A),i=e.length;for(let s=0;s<i;s++){const i=e[s];if(null===i.setupCB)i.setupCB=t=>t.draw(this.render,this.timeStamp*this._speedModifier,this._deltaTime);else if(t.isFunction(i.setupCB)){const t=i.setupCB;i.setupCB=(e,i)=>{e.draw(this.render,this.timeStamp*this._speedModifier,this._deltaTime),t(e,i)}}}}drawStatic(){this.draw(),this._render.drawBatched(),t.isFunction(this._loopingCB)&&this._loopingCB()}cleanDrawStatic(){this.clear(),this.drawStatic()}resetReferences(){this.refs.filter(t=>t.fragile).forEach(t=>t.reset())}#X(){this.updateOffset(),null!=this._mouse.x&&null!=this._mouse.y&&(this._mouse.updatePos(this._mouse.rawX,this._mouse.rawY,this._offset),this.#k())}resetTransformations(t){t&&(this._zoom=1,this._viewPos=[0,0]),this.ctx.setTransform(this._zoom,0,0,this._zoom,this._viewPos[0],this._viewPos[1]),this.#X()}setTransformations(t=this._zoom,e=this._viewPos){this.ctx.setTransform(t,0,0,t,e[0],e[1])}moveViewAt(t){this._viewPos[0]=t[0],this._viewPos[1]=t[1],this.setTransformations(),this.#X()}moveViewBy(t){this._viewPos[0]+=t[0],this._viewPos[1]+=t[1],this.setTransformations(),this.#X()}moveViewTo(e,i=null,s=null,r=null){i??=1e3,s??=d.easeInOutQuad,r??=this._viewPos;let[n,a]=e,[o,h]=r,l=o,_=h;t.isDefined(n)||(n=o??0),t.isDefined(a)||(a=h??0);const u=n-o,c=a-h;if(u||c)return this.playAnim(new d(t=>{const e=o+u*t,i=h+c*t,s=e-l,r=i-_;this._viewPos[0]+=s,this._viewPos[1]+=r,l=e,_=i,this.setTransformations(),this.#X()},i,s))}zoomAtPos(t,e){const i=this._zoom,s=this._viewPos,[r,n]=t;this._zoom=e,s[0]=r-(r-s[0])/i*e,s[1]=n-(n-s[1])/i*e,this.#X(),this.setTransformations()}centerViewAt(t){this.moveViewAt([-t[0]+this.width/2,-t[1]+this.height/2])}centerViewTo(t,e=null,i=null){this.moveViewTo([-t[0]+this.width/2,-t[1]+this.height/2],e,i)}playAnim(e){const i=e.endCB;return e.endCB=()=>{this._anims=this._anims.filter(t=>t.id!==e.id),t.isFunction(i)&&i()},this._anims.push(e),e}setSize(t,e,i){const{width:s,height:r}=this._frame.getBoundingClientRect(),n=t??s,a=e??r;this._cvs.width===n&&this._cvs.width===a||(this._cvs.width=n??s,this._cvs.height=a??r,i&&(this._frame.style.width=this.width+"px",this._frame.style.height=this.height+"px"),this.updateSettings(),this.updateOffset()),this.#v=[this._cvs.width,this._cvs.height]}updateSettings(t){const e=t||this._settings;return e?(Object.entries(e).forEach(t=>this._ctx[t[0]]=t[1]),this._settings=e):null}add(e,i=!1){const s=e&&(e.length??1);for(let r=0;r<s;r++){const s=e[r]??e;s._parent=this,t.isFunction(s.initialize)&&s.initialize(),i||this._els[s.asSource?"refs":"defs"].push(s)}return this.updateCachedAllEls(),e}remove(t){"*"==t?this._els={refs:[],defs:[]}:(this._els.defs=this._els.defs.filter(e=>e.id!==t),this._els.refs=this._els.refs.filter(e=>e.id!==t)),this.updateCachedAllEls()}removeAllObjects(){this.remove("*")}get(t){const e=this.#U,i=this.#F;for(let s=0;s<i;s++){const i=e[s];if(i.id==t)return i}return null}getObjs(t){return this.allEls.filter(e=>e instanceof t)}save(){this._ctx.save()}restore(){this._ctx.restore()}static#Z(t){if("keydown"!==t.type||"keydown"==t.type&&1==t.key.length){const e=E.#P,i=e?.length;if(i)for(let s=0;s<i;s++)e[s](t);E.#P=null}}#k(e,i){const s=this.refs,r=s.length;for(let t=0;t<r;t++){const e=s[t];e.ratioPosCB||!1===e.ratioPosCB||(e.ratioPos=this._mouse.pos)}this._mouse.checkValid(),t.isFunction(e)&&e(this._mouse,i)}setMouseMove(e,i){if(this.isOffscreenCanvas)return!1;{let s=0;this.#x=e;const r=t=>{const i=this.#b;i-s>Math.abs(this._mouseMoveThrottlingDelay*this._speedModifier)&&(s=i,this._mouse.updatePos(t.x,t.y,this._offset),this._mouse.calcAngle(),this.#k(e,t))},n=i=>{const r=i.touches,n=Math.abs(this.#b);n-s>Math.abs(this._mouseMoveThrottlingDelay*this._speedModifier)&&1==r.length&&(s=n,i.x=t.round(r[0].clientX,1),i.y=t.round(r[0].clientY,1),this._mouse.updatePos(i.x,i.y,this._offset),this._mouse.calcAngle(),this.#k(e,i))},a=i?document:this._frame;return a.addEventListener("mousemove",r),a.addEventListener("touchmove",n),()=>{a.removeEventListener("mousemove",r),a.removeEventListener("touchmove",n)}}}setMouseLeave(t,e){if(this.isOffscreenCanvas)return!1;{const i=e=>{this._mouse.invalidate(),this.#k(t,e)},s=e?document:this._frame;return s.addEventListener("mouseleave",i),()=>s.removeEventListener("mouseleave",i)}}#q(e,i,s){this._mouse.updateMouseClicks(i),t.isFunction(e)&&e(this._mouse,i),!s&&E.#P&&E.#Z(i)}setMouseDown(e,i){if(this.isOffscreenCanvas)return!1;{let s=!1;const r=i=>{s=!0;const r=i.touches;if(1==r.length){const s=this.#G;i.cancelable&&(!s||1==s&&this.looping)&&i.preventDefault(),i.x=t.round(r[0].clientX,1),i.y=t.round(r[0].clientY,1),i.button=0,this._mouse.updatePos(i.x,i.y,this._offset),this._mouse.calcAngle(),this.#k(this.#x,i),this.#q(e,i,!0)}},n=t=>{s||this.#q(e,t),s=!1},a=i?document:this._frame;return a.addEventListener("touchstart",r),a.addEventListener("mousedown",n),()=>{a.removeEventListener("touchstart",r),a.removeEventListener("mousedown",n)}}}setMouseUp(e,i){if(this.isOffscreenCanvas)return!1;{let s=!1;const r=i=>{s=!0;const r=i.changedTouches;i.touches.length||(i.x=t.round(r[0].clientX,1),i.y=t.round(r[0].clientY,1),i.button=0,this.#q(e,i),this.#k(e,i),setTimeout(()=>this._mouse.invalidate(),50))},n=t=>{s||this.#q(e,t),s=!1},a=i?document:this._frame;return a.addEventListener("touchend",r),a.addEventListener("mouseup",n),()=>{a.removeEventListener("touchend",r),a.removeEventListener("mouseup",n)}}}setKeyDown(e,i){if(this.isOffscreenCanvas)return!1;{const s=i=>{this._typingDevice.setDown(i),t.isFunction(e)&&e(this._typingDevice,i)},r=t=>{E.#P&&E.#Z(t)},n=i?document:this._frame;return n.addEventListener("keydown",s),document.addEventListener("keydown",r),()=>n.removeEventListener("keydown",s)}}setKeyUp(e,i){if(this.isOffscreenCanvas)return!1;{const s=i=>{this._typingDevice.setUp(i),t.isFunction(e)&&e(this._typingDevice,i)},r=i?document:this._frame;return r.addEventListener("keyup",s),()=>r.removeEventListener("keyup",s)}}getCenter(){return[this.width/2,this.height/2]}isWithin(t,e=0){const i=this._viewPos,s=this._zoom,r=i[0],n=i[1];return t[0]>=-r/s-e&&t[0]<=(this.#v[0]-r)/s+e&&t[1]>=-n/s-e&&t[1]<=(this.#v[1]-n)/s+e}pct(t,e=!0){return e?this.width*t:this.height*t}getResponsivePos(t,e=this.size){return[t[0]*e[0],t[1]*e[1]]}enableAccurateMouseMoveListenersMode(){this.mouseMoveListenersOptimizationEnabled=!1}disableAccurateMouseMoveListenersMode(){this.mouseMoveListenersOptimizationEnabled=!0}disableMouseMoveThrottling(){this._mouseMoveThrottlingDelay=0}disableViewportIntersectionOptimizations(){this.onIntersectionChangeCB=void 0}enableDefaultViewportIntersectionOptimizations(){this.onIntersectionChangeCB=null}[Symbol.toPrimitive](){return this.id}*[Symbol.iterator](){const t=this.allEls,e=t.length;for(let i=0;i<e;i++)yield t[i]}get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"Canvas"}get id(){return this._id}get cvs(){return this._cvs}get frame(){return this._frame}get ctx(){return this._ctx}get width(){return this.#v?.[0]}get height(){return this.#v?.[1]}get size(){return this.#v}get settings(){return this._settings}get loopingCB(){return this._loopingCB}get looping(){return this._state==E.STATES.LOOPING}get stopped(){return this._state==E.STATES.STOPPED}get state(){return this._state}get deltaTime(){return this._deltaTime}get windowListeners(){return this._windowListeners}get timeStamp(){return this._fixedTimeStamp||this.#y}get timeStampNotFixed(){return this.#y}get timeStampRaw(){return this.#b}get els(){return this._els}get mouse(){return this._mouse}get typingDevice(){return this._typingDevice}get keyboard(){return this._typingDevice}get offset(){return this._offset}get defs(){return this._els.defs}get refs(){return this._els.refs}get allDefsAndRefs(){return this.defs.concat(this.refs)}get allEls(){return this.allDefsAndRefs.flatMap(t=>t.dots||t)}get fpsLimitRaw(){return this._fpsLimit}get fpsLimit(){const t=!isFinite(this._fpsLimit);return null==this._fpsLimit||t?t?"static":null:1/(this._fpsLimit/1e3)}get onVisibilityChangeCB(){return this._onVisibilityChangeCB}get onIntersectionChangeCB(){return this._onIntersectionChangeCB}get onResizeCB(){return this._onResizeCB}get onScrollCB(){return this._onScrollCB}get maxTime(){return this.#M}get viewPos(){return this._viewPos}get zoom(){return this._zoom}get render(){return this._render}get speedModifier(){return this._speedModifier}get anims(){return this._anims}get mouseMoveListenersOptimizationEnabled(){return this._mouse._moveListenersOptimizationEnabled}get isOffscreenCanvas(){return this._cvs instanceof OffscreenCanvas}get mouseMoveThrottlingDelay(){return this._mouseMoveThrottlingDelay}get dimensions(){return[[0,0],this.size]}get hasBeenStarted(){return Boolean(this.timeStamp)}get mobileScrollingState(){return this.#G}set id(t){this._id=t}set loopingCB(t){this._loopingCB=t}set width(t){this.setSize(t,null)}set height(t){this.setSize(null,t)}set offset(t){this._offset=t}set fpsLimit(e){this._fpsLimit=t.isDefined(e)&&isFinite(e)?1e3/Math.max(e,0):null,this.#M=this.#V(e)}set onVisibilityChangeCB(e){this.#w[0]=this._state,this._onVisibilityChangeCB=(i,s,r)=>{i||(this.#w[0]=this._state),1==this.#w[0]&&(i?(this.startLoop(),this.resetReferences()):this.stopLoop()),t.isFunction(e)&&e(i,s,r)}}set onIntersectionChangeCB(e){void 0===e?this._onIntersectionChangeCB=null:(this.#w[1]=this._state,this._onIntersectionChangeCB=(i,s,r)=>{i||(this.#w[1]=this._state),this.#w[1]==E.STATES.LOOPING&&(i?(this.startLoop(),this.resetReferences()):this.stopLoop()),t.isFunction(e)&&e(i,s,r)})}set onResizeCB(t){this._onResizeCB=t}set onScrollCB(t){this._onScrollCB=t}set speedModifier(t){this._speedModifier=t}set mouseMoveListenersOptimizationEnabled(t){this._mouse._moveListenersOptimizationEnabled=t}set mouseMoveThrottlingDelay(t){this._mouseMoveThrottlingDelay=t}set mobileScrollingState(t){this.#G=t}}class d{static#j=0;static DEFAULT_DURATION=1e3;constructor(t,e,i,s){this._id=d.#j++,this._animation=t,this._duration=e??d.DEFAULT_DURATION,this._easing=i||d.linear,this._endCB=s,this._startTime=null,this._progress=0,this._playCount=0,this._isReversed=!1}getFrame(t,e){const i=this._duration<0,s=i?-this._duration:this._duration,r=this._startTime,n=this._isReversed;if(!this._playCount||i)if(r)if(e>=0&&t<r+s){let i=t-r,a=this._easing(Math.abs(i)/s);this._progress=n?1-a:a,this._animation(this._progress,this._playCount,e,this.progress),n&&i>0&&(this._isReversed=!1,this._playCount++)}else if(e<0&&t>r-s){let i=r-t,a=this._easing(Math.abs(i)/s);!n&&i>0&&(this._isReversed=!0,this._playCount++),this._easing(Math.abs(r-(t+1e3*e))/s)>1?(this._startTime=null,this._animation(0,this._playCount++,e,0)):(this._progress=this._isReversed?1-a:a,this._animation(this._progress,this._playCount,e,this.progress))}else i?this._isReversed?(this._startTime=null,this._playCount++):this.reset(!0,e):this.end(e);else this._startTime=t}end(e){this._animation(1,this._playCount++,e,1),t.isFunction(this._endCB)&&this._endCB(this)}reset(t,e){t?this._animation(1,this._playCount++,e,1):this._playCount=0,this._progress=0,this._startTime=null}[Symbol.toPrimitive](){return this.id}get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"Anim"}get id(){return this._id}get animation(){return this._animation}get duration(){return this._duration}get easing(){return this._easing}get endCB(){return this._endCB}get startTime(){return this._startTime}get progress(){return t.clamp(this._progress,0,1)}get progressRaw(){return this._progress}get playCount(){return this._playCount}set startTime(t){this._startTime=t}set animation(t){this._animation=t}set duration(t){this._duration=t}set easing(t){this._easing=t}set endCB(t){this._endCB=t}static easeInSine=t=>1-Math.cos(t*Math.PI/2);static easeOutSine=t=>Math.sin(t*Math.PI/2);static easeInOutSine=t=>-(Math.cos(Math.PI*t)-1)/2;static easeInCubic=t=>t*t*t;static easeOutCubic=t=>1-Math.pow(1-t,3);static easeInOutCubic=t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;static easeInQuint=t=>t*t*t*t*t;static easeOutQuint=t=>1-Math.pow(1-t,5);static easeInOutQuint=t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2;static easeInCirc=t=>1-Math.sqrt(1-Math.pow(t,2));static easeOutCirc=t=>Math.sqrt(1-Math.pow(t-1,2));static easeInOutCirc=t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2;static easeInElastic=t=>0==t?0:1==t?1:-Math.pow(2,10*t-10)*Math.sin((10*t-10.75)*(2*Math.PI/3));static easeOutElastic=t=>0==t?0:1==t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*(2*Math.PI/3))+1;static easeInOutElastic=t=>0==t?0:1==t?1:t<.5?-Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*(2*Math.PI)/4.5)/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*(2*Math.PI)/4.5)/2+1;static easeInQuad=t=>t*t;static easeOutQuad=t=>1-(1-t)*(1-t);static easeInOutQuad=t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2;static easeInQuart=t=>t*t*t*t;static easeOutQuart=t=>1-Math.pow(1-t,4);static easeInOutQuart=t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2;static easeInExpo=t=>0==t?0:Math.pow(2,10*t-10);static easeOutExpo=t=>1==t?1:1-Math.pow(2,-10*t);static easeInOutExpo=t=>0==t?0:1==t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2;static easeInBack=t=>2.70158*t*t*t-1.70158*t*t;static easeOutBack=t=>1+2.70158*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2);static easeInOutBack=t=>t<.5?Math.pow(2*t,2)*(7.189819*t-2.5949095)/2:(Math.pow(2*t-2,2)*(3.5949095*(2*t-2)+2.5949095)+2)/2;static easeInBounce=t=>1-d.easeOutBounce(1-t);static easeOutBounce=t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375;static easeInOutBounce=t=>t<.5?(1-d.easeOutBounce(1-2*t))/2:(1+d.easeOutBounce(2*t-1))/2;static linear=t=>t}class T extends n{static DEFAULT_POS=[0,0];static DEFAULT_ACTIVATION_MARGIN=E.DEFAULT_CANVAS_ACTIVE_AREA_PADDING;static ACTIVATION_MARGIN_DISABLED=E.ACTIVATION_MARGIN_DISABLED;static ABSOLUTE_ANCHOR=[0,0];static POSITION_PRECISION=6;#Q=[0,0];#$=null;constructor(t,e,i,s,r,n){super(e),this._id=E.ELEMENT_ID_GIVER++,this._initPos=t||[0,0],this._pos=[0,0],this._setupCB=i??null,this._loopCB=s,this._setupResults=null,this._anchorPos=r,this._activationMargin=n??E.DEFAULT_CANVAS_ACTIVE_AREA_PADDING,this._parent=null,this._rotation=0,this._scale=[1,1],this._anims={backlog:[],currents:[]},this._visualEffects=null,this._initialized=!1}initialize(){if(this._pos=this.getInitPos()||T.DEFAULT_POS,this.color=this.getInitColor(),this.setAnchoredPos(),t.isFunction(this._setupCB)){const t=this._setupCB(this,this.parent);void 0!==t&&(this._setupResults=t)}}draw(t,e){this.setAnchoredPos();const i=this._loopCB;i&&this.initialized&&i(this,e);let s=this._anims.currents;this._anims.backlog[0]&&(s=[...s,this._anims.backlog[0]]);const r=s.length;if(r)for(let i=0;i<r;i++)s[i].getFrame(t,e)}getInitColor(){return t.isFunction(this._initColor)?this._initColor(this.render??this.parent.render,this):this._initColor||null}getInitPos(){return t.isFunction(this._initPos)?t.unlinkArr2(this._initPos(this._parent instanceof E?this:this._parent,this)):t.unlinkArr2(this.adjustPos(this._initPos))}setAnchoredPos(){const t=this.hasAnchorPosChanged;t&&(this.relativeX+=t[0]-this.#Q[0],this.relativeY+=t[1]-this.#Q[1],this.#Q=t)}moveAt(e){const[i,s]=e;t.isDefined(i)&&isFinite(i)&&(this.x=i),t.isDefined(s)&&isFinite(s)&&(this.y=s)}moveBy(e){const[i,s]=e;t.isDefined(i)&&isFinite(i)&&(this.x+=i),t.isDefined(s)&&isFinite(s)&&(this.y+=s)}moveTo(t,e,i,s,r,n){e??=1e3,i??=d.easeInOutQuad,s??=this.pos_,r??=!0,n??=!0;const[a,o]=s,[h,l]=this.adjustPos(t),_=h-a,u=l-o;return this.playAnim(new d(t=>{this.x=a+_*t,this.y=o+u*t},e,i),r,n)}rotateBy(t){this.rotation=(this._rotation+t)%360}rotateAt(t){this.rotation=t%360}rotateTo(t,e=1e3,i=d.easeInOutQuad,s=!1,r=!1){const n=this._rotation,a=t-this._rotation;return this.playAnim(new d(t=>this.rotateAt(n+a*t),e,i),s,r)}scaleBy(e){let[i,s]=e;t.isDefined(i)||(i=this._scale[0]),t.isDefined(s)||(s=this._scale[1]),this.scale[0]*=i,this.scale[1]*=s}scaleAt(t){this.scale=t}scaleTo(e,i=1e3,s=d.easeInOutQuad,r=this.pos,n=!1,a=!1){const o=t.unlinkArr2(this._scale),h=e[0]-o[0],l=e[1]-o[1];return this.playAnim(new d(t=>this.scaleAt([o[0]+h*t,o[1]+l*t],r),i,s),n,a)}follow(e,i,s,r){let[n,a]=this._pos,o=r.length-1;this.playAnim(new d(e=>{let i=null;e<0&&(e=0);for(let t=o;t>=0;t--){let s=r[t];if(s[0]<=e){i=s;break}}const[h,l]=i[1](e,e-i[0],this,n,a);this.moveAt([n+h,a+l]),t.isFunction(s)&&s(e,this)},e,i))}addForce(e,i,s=1e3,r=d.easeInOutQuad,n=!0,a=!0){let o=t.toRad(i),h=this.x,l=this.y,_=t.getAcceptableDiff(e*Math.cos(o),t.DEFAULT_ACCEPTABLE_DIFFERENCE),u=t.getAcceptableDiff(e*Math.sin(o),t.DEFAULT_ACCEPTABLE_DIFFERENCE);return this.playAnim(new d(t=>{this.x=h+_*t,this.y=l-u*t},s,r),n,a)}playAnim(e,i,s){i&&this.currentBacklogAnim&&s&&(this.currentBacklogAnim.end(),this._anims.backlog=t.addAt(this._anims.backlog,e,0));const r=e.endCB;return e.endCB=()=>{i?this._anims.backlog.shift():this._anims.currents=this._anims.currents.filter(t=>t.id!==e.id),t.isFunction(r)&&r()},this._anims[i?"backlog":"currents"].push(e),e}clearAnims(){this._anims.backlog=[],this._anims.currents=[]}adjustPos(e){let[i,s]=e;return t.isDefined(i)||(i=this.x??0),t.isDefined(s)||(s=this.y??0),[i,s]}remove(){this._parent.remove(this._id)}isWithin(t,e){return t[0]>=e[0][0]&&t[0]<=e[1][0]&&t[1]>=e[0][1]&&t[1]<=e[1][1]}getCenter(e){return t.getPositionsCenter(e)}getCorners(e,i=0,s=null,r=null,n=this.getCenter(e)){const a=t.rotatePos,o=t.scalePos;return e[2]=[e[1][0],e[0][1]],e[3]=[e[0][0],e[1][1]],r&&(e[0]=o(e[0],r,n),e[1]=o(e[1],r,n),e[2]=o(e[2],r,n),e[3]=o(e[3],r,n)),s&&(e[0]=a(e[0],s,n),e[1]=a(e[1],s,n),e[2]=a(e[2],s,n),e[3]=a(e[3],s,n)),i??=0,i&&(i="number"==typeof i?[i,i,i,i]:[i[0],i[1]??i[0],i[2]??i[0],i[3]??i[1]],e[0][0]-=i[3],e[0][1]-=i[0],e[2][0]+=i[1],e[2][1]-=i[0],e[1][0]+=i[1],e[1][1]+=i[2],e[3][0]-=i[3],e[3][1]+=i[2]),e}getBounds(t,e,i,s,r=this.getCenter(t)){let n=Infinity,a=Infinity,o=-Infinity,h=-Infinity;const l=(t=this.getCorners(t,0,i,s,r)).length;for(let e=0;e<l;e++){let[i,s]=t[e];i<n&&(n=i),i>o&&(o=i),s<a&&(a=s),s>h&&(h=s)}return e??=0,[[n-(e="number"==typeof e?[e,e,e,e]:[e[0],e[1]??e[0],e[2]??e[0],e[3]??e[1]])[3],a-e[0]],[o+e[1],h+e[2]]]}disable(){this.#$=this._activationMargin,this._activationMargin=E.ACTIVATION_MARGIN_DISABLED}enable(){this.#$&&(this._activationMargin=this.#$,this.#$=null)}get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"_BaseObj"}get id(){return this._id}get x(){return this._pos[0]}get y(){return this._pos[1]}get pos(){return this._pos}get pos_(){return t.unlinkArr2(this._pos)}get relativeX(){return this.x-this.anchorPos[0]}get relativeY(){return this.y-this.anchorPos[1]}get relativePos(){return[this.relativeX,this.relativeY]}get stringPos(){return this.x+","+this.y}get initPos(){return this._initPos}get currentBacklogAnim(){return this._anims.backlog[0]}get anims(){return this._anims}get setupCB(){return this._setupCB}get loopCB(){return this._loopCB}get loopingCB(){return this._loopCB}get setupResults(){return this._setupResults}get initialized(){return this._initialized}get activationMargin(){return this._activationMargin}get anchorPosRaw(){return this._anchorPos}get anchorPos(){if(Array.isArray(this._anchorPos))return this._anchorPos;if(!this._anchorPos)return this.parent instanceof E?[0,0]:this.parent?.pos_;if(this._anchorPos instanceof T)return this._anchorPos.pos_;if(t.isFunction(this._anchorPos)){const e=this._anchorPos(this,this.parent);return t.unlinkArr2(e?.pos_||e||[0,0])}}get lastAnchorPos(){return this.#Q}get hasAnchorPosChanged(){const e=this.anchorPos;return!t.posEquals(this.#Q,e)&&e}get parent(){return this._parent}get rotation(){return this._rotation}get scale(){return this._scale}get visualEffects(){return this._visualEffects??[]}get visualEffects_(){const e=this._visualEffects;return e?t.unlinkArr3(e):[]}get filter(){return this._visualEffects?.[0]??l.DEFAULT_FILTER}get compositeOperation(){return this._visualEffects?.[1]??l.DEFAULT_COMPOSITE_OPERATION}get opacity(){return this._visualEffects?.[2]??l.DEFAULT_ALPHA}get safeColorObject(){return this.initialized&&this._color}get lastActivationMargin(){return this.#$}get enabled(){return!this.#$}get disabled(){return Boolean(this.#$)}set x(e){this._pos[0]=t.round(e,T.POSITION_PRECISION)}set y(e){this._pos[1]=t.round(e,T.POSITION_PRECISION)}set pos(t){this.x=t[0],this.y=t[1]}set relativeX(t){this.x=this.anchorPos[0]+t}set relativeY(t){this.y=this.anchorPos[1]+t}set relativePos(e){this.relativeX=t.round(e[0],T.POSITION_PRECISION),this.relativeY=t.round(e[1],T.POSITION_PRECISION)}set initPos(t){this._initPos=t}set setupCB(t){this._setupCB=t}set loopCB(t){this._loopCB=t}set loopingCB(t){this._loopCB=t}set setupResults(t){this._setupResults=t}set initialized(t){this._initialized=t}set activationMargin(t){this._activationMargin=t}set anchorPos(t){this.anchorPosRaw=t}set anchorPosRaw(t){this._anchorPos=t}set lastAnchorPos(t){this.#Q=t}set rotation(t){this._rotation=t%360}set scale(e){let[i,s]=e;t.isDefined(i)||(i=this._scale[0]),t.isDefined(s)||(s=this._scale[1]),this._scale[0]=i,this._scale[1]=s}set visualEffects(e){this._visualEffects=e?.length?t.unlinkArr3(e):null}set filter(t){const e=this._visualEffects;e?e[0]=t:this._visualEffects=[t]}set compositeOperation(t){const e=this._visualEffects;e?e[1]=t:this._visualEffects=[,t]}set opacity(t){const e=this._visualEffects;e?e[2]=t:this._visualEffects=[,,t]}}class S extends T{static LOADED_IR_BUFFERS=[];static SUPPORTED_AUDIO_FORMATS=["mp3","wav","ogg","aac","m4a","opus","flac"];static SOURCE_TYPES={FILE_PATH:"string",DYNAMIC:"[object Object]",MICROPHONE:"MICROPHONE",SCREEN_AUDIO:"SCREEN_AUDIO",VIDEO:HTMLVideoElement,AUDIO:HTMLAudioElement};static MINIMAL_FFT=1;static MAXIMAL_FFT=32768;static DEFAULT_SAMPLE_COUNT=64;static DEFAULT_BINCB=(t,e,i,s)=>{const r=100*e;return t.batchFill(l.getRect(i,2,r),s._color,s.visualEffects),i[0]+=5,[i]};static DEFAULT_BINCB_TRANSFORMABLE=(t,e,i,s)=>{const r=100*e;return t.fill(l.getRect(i,2,r),s._color,s.visualEffects),i[0]+=5,[i]};static BIN_CALLBACKS={DEFAULT:S.DEFAULT_BINCB,CIRCLE:S.CIRCLE(),BARS:S.BARS(),TOP_WAVE:S.TOP_WAVE()};static MICROPHONE_CHANNELS={MONO:1,STEREO:2};static DEFAULT_MICROPHONE_DELAY=1;static DEFAULT_MICROPHONE_AUTO_GAIN_CONTROL=!1;static DEFAULT_MICROPHONE_ECHO_CANCELLATION=!1;static DEFAULT_MICROPHONE_NOISE_SUPPRESSION=!1;static DEFAULT_MICROPHONE_CHANNEL_COUNT=S.MICROPHONE_CHANNELS.STEREO;static DEFAULT_MICROPHONE_SAMPLE_RATE=48e3;static DEFAULT_MICROPHONE_SAMPLE_SIZE=16;static DEFAULT_MICROPHONE_SETTINGS=S.loadMicrophone();static DEFAULT_SCREEN_AUDIO_SETTINGS=S.loadScreenAudio();static MAX_NORMALISED_DATA_VALUE=255/128;static MAX_DELAY_TIME=179;static ERROR_TYPES={NO_PERMISSION:0,DEVICE_IN_USE:1,SOURCE_DISCONNECTED:2,FILE_NOT_FOUND:3,NOT_AVAILABLE:4,NOT_SUPPORTED:5};static BIQUAD_FILTER_TYPES={DEFAULT:"allpass",ALLPASS:"allpass",BANDPASS:"bandpass",HIGHPASS:"highpass",HIGHSHELF:"highshelf",LOWPASS:"lowpass",LOWSHELF:"lowshelf",NOTCH:"notch",PEAKING:"peaking"};static IS_MICROPHONE_SUPPORTED=()=>!!navigator?.mediaDevices?.getUserMedia;static IS_SCREEN_ADUIO_SUPPORTED=()=>!!navigator?.mediaDevices?.getDisplayMedia;static DEFAULT_MEDIA_ERROR_CALLBACK=(t,e)=>console.warn("Error while loading media:",S.getErrorFromCode(t),"("+e+")");#J=null;#tt=null;#et=null;constructor(t,e,i,s,r,n,a,o,h,l,_,u){super(e,i,h,l,_,u),this._source=t??"",this._binCB=s??S.DEFAULT_BINCB,this._sampleCount=r??S.DEFAULT_SAMPLE_COUNT,this._disableAudio=n??!1,this._offsetPourcent=a??0,this._errorCB=o||S.DEFAULT_MEDIA_ERROR_CALLBACK,this._transformable=0,this._audioCtx=new AudioContext,E.addOnFirstInteractCallback(()=>this._audioCtx.resume()),this._audioAnalyser=this._audioCtx.createAnalyser(),this._gainNode=this._audioCtx.createGain(),this._biquadFilterNode=this._audioCtx.createBiquadFilter(),this._biquadFilterNode.type=S.BIQUAD_FILTER_TYPES.DEFAULT,this._convolverNode=this._audioCtx.createConvolver(),this._waveShaperNode=this._audioCtx.createWaveShaper(),this._dynamicsCompressorNode=this._audioCtx.createDynamicsCompressor(),this._pannerNode=this._audioCtx.createPanner(),this._delayNode=this._audioCtx.createDelay(S.MAX_DELAY_TIME),this.#et=this._audioAnalyser.fftSize=Math.max(32,2**Math.round(Math.log2(2*this._sampleCount))),this.#J=this._audioAnalyser.frequencyBinCount,this.#tt=new Uint8Array(this.#J)}initialize(){this.initializeSource(),this._pos=this.getInitPos()||T.DEFAULT_POS,this.setAnchoredPos(),super.initialize()}draw(e,i,s){if(this.initialized){const i=e.ctx,s=1!==this._scale[0]||1!==this._scale[1],r=this._rotation||s,n=this.#tt;let a,o;if(this._transformable&&r){const e=this._pos[0],r=this._pos[1],n=this.parent;a=n.viewPos,o=n.zoom,i.translate(e,r),this._rotation&&i.rotate(t.toRad(this._rotation)),s&&i.scale(this._scale[0],this._scale[1]),i.translate(-e,-r)}this._audioAnalyser.getByteFrequencyData(n);let h=this.pos_,l=null,_=this._sampleCount,u=this._offsetPourcent%1*(this.#et/2),c=Math.round(.49+_)-u,E=-u,d=0|u;for(;E<c;E++,d=(d+1)%_){const t=n[d],i=this._binCB(e,t/128,h,this,l,d,_,t),s=i?.[0],r=i?.[1];s&&(h=s),r&&(l=r)}this._transformable&&r&&i.setTransform(o,0,0,o,a[0],a[1])}super.draw(i,s)}#it(){const t=this._rotation||1!=this._scale[0]||1!=this._scale[1];t&&this._transformable<2?this._transformable=2:!t&&this._transformable&&this._transformable--}isWithin(t,e,i,s){return super.isWithin(t,this.getBounds(e,i,s),e)}#st(t=2,e=100,i=5){const s=this._pos,r=this._sampleCount*(t*i)/2;return[[s[0],s[1]],[s[0]+r,s[1]+2*e]]}getCenter(){return super.getCenter(this.#st())}getBounds(t,e=this._rotation,i=this._scale){const s=this.#st();return super.getBounds(s,t,e,i,this._pos)}initializeSource(e=this._source){S.initializeDataSource(e,(i,s)=>{this._source=i,s?(i.oninactive=i=>{t.isFunction(this._errorCB)&&this._errorCB(S.ERROR_TYPES.SOURCE_DISCONNECTED,e,i)},this._source=this._audioCtx.createMediaStreamSource(i),this._source.connect(this._gainNode)):this._audioCtx.createMediaElementSource(i).connect(this._gainNode),this._gainNode.connect(this._biquadFilterNode),this._biquadFilterNode.connect(this._waveShaperNode),this._waveShaperNode.connect(this._dynamicsCompressorNode),this._dynamicsCompressorNode.connect(this._pannerNode),this._pannerNode.connect(this._delayNode),this._delayNode.connect(this._audioAnalyser),this._disableAudio||this._audioAnalyser.connect(this._audioCtx.destination),this._initialized=!0,t.isFunction(this._setupCB)&&(this._setupResults=this._setupCB(this,this._parent,this._source))},this._errorCB)}static initializeDataSource(e,i,s){const r=S.SOURCE_TYPES;typeof e==r.FILE_PATH?S.isAudioFormatSupported(e)?S.#rt(S.loadAudio(e),i,s):A.isVideoFormatSupported(e)?S.#rt(A.loadVideo(e),i,s):t.isFunction(s)&&s(S.ERROR_TYPES.NOT_SUPPORTED,e):e.toString()==r.DYNAMIC?e.type==r.MICROPHONE?S.#nt(e.settings,i,s):e.type==r.SCREEN_AUDIO&&S.#at(e.settings,i,s):e instanceof r.VIDEO||e instanceof r.AUDIO?S.#rt(e,i,s):e instanceof MediaStream&&(e.getAudioTracks().length&&t.isFunction(i)?i(e,!0):t.isFunction(s)&&s(S.ERROR_TYPES.NO_AUDIO_TRACK,e))}static#rt(e,i,s){const r=()=>{t.isFunction(i)&&i(e)};e.onerror=i=>{t.isFunction(s)&&s(S.ERROR_TYPES.FILE_NOT_FOUND,e,i)},e.readyState?r():e.onloadeddata=r}static#nt(e=!0,i,s){S.IS_MICROPHONE_SUPPORTED()?navigator.mediaDevices.getUserMedia({audio:e}).then(r=>{r.getAudioTracks().length&&t.isFunction(i)?i(r,!0):t.isFunction(s)&&s(S.ERROR_TYPES.NO_AUDIO_TRACK,e)}).catch(i=>{t.isFunction(s)&&s(S.ERROR_TYPES.NO_PERMISSION,e,i)}):t.isFunction(s)&&s(S.ERROR_TYPES.NOT_AVAILABLE,e)}static#at(e=!0,i,s){S.IS_MICROPHONE_SUPPORTED()?navigator.mediaDevices.getDisplayMedia({audio:e}).then(r=>{r.getAudioTracks().length&&t.isFunction(i)?i(r,!0):t.isFunction(s)&&s(S.ERROR_TYPES.NO_AUDIO_TRACK,e)}).catch(i=>{t.isFunction(s)&&s(S.ERROR_TYPES.NO_PERMISSION,e,i)}):t.isFunction(s)&&s(S.ERROR_TYPES.NOT_AVAILABLE,e)}static loadAudio(t,e=!0,i=!0){const s=new Audio(t);return s.preload="auto",s.loop=e,i&&(s.autoplay=i,A.playMedia(s)),s}static loadMicrophone(t,e,i,s,r,n,a){return t??=S.DEFAULT_MICROPHONE_AUTO_GAIN_CONTROL,e??=S.DEFAULT_MICROPHONE_ECHO_CANCELLATION,i??=S.DEFAULT_MICROPHONE_NOISE_SUPPRESSION,s??=!0,r??=S.DEFAULT_MICROPHONE_DELAY,n??=S.DEFAULT_MICROPHONE_SAMPLE_RATE,a??=S.DEFAULT_MICROPHONE_SAMPLE_SIZE,{type:S.SOURCE_TYPES.MICROPHONE,settings:{autoGainControl:t,channelCount:s?2:1,echoCancellation:e,latency:r,noiseSuppression:i,sampleRate:n,sampleSize:a}}}static loadScreenAudio(t,e,i,s,r,n,a){return t??=S.DEFAULT_MICROPHONE_AUTO_GAIN_CONTROL,e??=S.DEFAULT_MICROPHONE_ECHO_CANCELLATION,i??=S.DEFAULT_MICROPHONE_NOISE_SUPPRESSION,s??=!0,r??=S.DEFAULT_MICROPHONE_DELAY,n??=S.DEFAULT_MICROPHONE_SAMPLE_RATE,a??=S.DEFAULT_MICROPHONE_SAMPLE_SIZE,{type:S.SOURCE_TYPES.SCREEN_AUDIO,settings:{autoGainControl:t,channelCount:s?2:1,echoCancellation:e,latency:r,noiseSuppression:i,sampleRate:n,sampleSize:a}}}static getDistortionCurve(e,i=44100){if(!e)return null;let s=new Float32Array(i),r=0,n=Math.PI,a=Math.abs,o=t.TO_DEGREES;for(;r<i;r++){const t=2*r/i-1;s[r]=(3+e)*t*20*o/(n+e*a(t))}return s}connectConvolver(){this._biquadFilterNode.disconnect(0),this._biquadFilterNode.connect(this._convolverNode),this._convolverNode.connect(this._dynamicsCompressorNode)}disconnectConvolver(){this._biquadFilterNode.disconnect(0),this._biquadFilterNode.connect(this._dynamicsCompressorNode)}loadImpulseResponse(e,i=t=>{this.setReverb(t),this.connectConvolver()}){fetch(e).then(t=>t.arrayBuffer()).then(t=>this._audioCtx.decodeAudioData(t)).then(e=>{S.LOADED_IR_BUFFERS.push(e),t.isFunction(i)&&i(e)})}setVolume(t=1){this._gainNode.gain.value=t}setBiquadFilterType(t=S.BIQUAD_FILTER_TYPES.DEFAULT){this._biquadFilterNode.type=t}setDistortionCurve(t=null){this._waveShaperNode.curve="number"==typeof t?S.getDistortionCurve(t):t}setOriginPos(t=0,e=0,i=0,s=0){const r=this._audioCtx.currentTime;null!=t&&this._pannerNode.positionX.setValueAtTime(t,r+s),null!=e&&this._pannerNode.positionY.setValueAtTime(e,r+s),null!=i&&this._pannerNode.positionZ.setValueAtTime(i,r+s)}setDelay(t=0){this._delayNode.delayTime.value=t>S.MAX_DELAY_TIME?S.MAX_DELAY_TIME:t}setReverb(t=null){t?this._convolverNode.buffer=t:this.disconnectConvolver()}resetAudioModifiers(){this.setVolume(),this.setBiquadFilterType(),this.setDistortionCurve(),this.setOriginPos(),this.setDelay(),this.setReverb()}static isAudioFormatSupported(t){const e=(t?.name||t).toLowerCase();return S.SUPPORTED_AUDIO_FORMATS.some(t=>e.endsWith("."+t))}static getSupportedHTMLAcceptValue(){return"."+S.SUPPORTED_AUDIO_FORMATS.join(", .")}static getErrorFromCode(t){return Object.keys(S.ERROR_TYPES)[t]}duplicate(e=this._source,i=this.pos_,s=this._color,r=this._binCB,n=this._sampleCount,a=this._disableAudio,o=this._offsetPourcent,h=this._errorCB,l=this._setupCB,_=this._loopCB,u=this._anchorPos,c=this._activationMargin){const E=s,d=E.colorRaw,T=new S(e instanceof MediaStreamAudioSourceNode?e.mediaStream.clone():e.cloneNode(),i,(t,e)=>d instanceof C||d instanceof g?d.duplicate(Array.isArray(d.initPositions)?null:e):E.duplicate(),r,n,a,o,h,l,_,u,c);return T._scale=t.unlinkArr2(this._scale),T._rotation=this._rotation,T._visualEffects=this.visualEffects_,this.initialized?T:null}static BARS(t,e,i,s,r){return t??=100,e??=0,i??=1,s??=2,t/=S.MAX_NORMALISED_DATA_VALUE,e/=S.MAX_NORMALISED_DATA_VALUE,r?(r,n,a,o)=>{const h=e+t*n;return r.fill(l.getRect(a,s,h),o._color,o.visualEffects),a[0]+=i,[a]}:(r,n,a,o)=>{const h=e+t*n;return r.batchFill(l.getRect(a,s,h),o._color,o.visualEffects),a[0]+=i,[a]}}static CIRCLE(t,e,i,s){return t??=100,e??=0,s??=2,t/=S.MAX_NORMALISED_DATA_VALUE,e/=S.MAX_NORMALISED_DATA_VALUE,i?(i,r,n,a,o,h)=>{h%s==0&&i.stroke(l.getArc(n,e+t*r),a._color,a.visualEffects)}:(i,r,n,a,o,h)=>{h%s==0&&i.batchStroke(l.getArc(n,e+t*r),a._color,a.visualEffects)}}static TOP_WAVE(t,e,i,s,r){return t??=100,e??=0,i??=1,r??=2,t/=S.MAX_NORMALISED_DATA_VALUE,e/=S.MAX_NORMALISED_DATA_VALUE,s?(s,n,a,o,h,l,_)=>{const u=e+t*n;return l?l%r==0&&h.lineTo(a[0],a[1]+u):(h=new Path2D).moveTo(a[0],a[1]+u),l==_-1&&s.stroke(h,o._color,o.visualEffects),a[0]+=i,[a,h]}:(s,n,a,o,h,l,_)=>{const u=e+t*n;return l?l%r==0&&h.lineTo(a[0],a[1]+u):(h=new Path2D).moveTo(a[0],a[1]+u),l==_-1&&s.batchStroke(h,o._color,o.visualEffects),a[0]+=i,[a,h]}}static CLOUD(t,e,i,s,r,n){return t??=100,e??=0,i??=2,r??=2,n??=.1,t/=S.MAX_NORMALISED_DATA_VALUE,e/=S.MAX_NORMALISED_DATA_VALUE,s?(s,a,o,h,_,u)=>{const c=e+t*a,E=n*u;return u%r||s.fill(l.getArc([o[0]+c*Math.cos(E),o[1]+c*Math.sin(E)],i),h._color,h.visualEffects),[o]}:(s,a,o,h,_,u)=>{const c=e+t*a,E=n*u;return u%r||s.batchFill(l.getArc([o[0]+c*Math.cos(E),o[1]+c*Math.sin(E)],i),h._color,h.visualEffects),[o]}}[Symbol.toPrimitive](){return this.id}*[Symbol.iterator](){const t=this.#tt,e=t.length;for(let i=0;i<e;i++)yield t[i]}get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"AudioDisplay"}get source(){return this._source}get binCB(){return this._binCB}get sampleCount(){return this._sampleCount}get disableAudio(){return this._disableAudio}get offsetPourcent(){return this._offsetPourcent}get errorCB(){return this._errorCB}get audioCtx(){return this._audioCtx}get audioAnalyser(){return this._audioAnalyser}get gainNode(){return this._gainNode}get biquadFilterNode(){return this._biquadFilterNode}get convolverNode(){return this._convolverNode}get waveShaperNode(){return this._waveShaperNode}get dynamicsCompressorNode(){return this._dynamicsCompressorNode}get pannerNode(){return this._pannerNode}get delayNode(){return this._delayNode}get data(){return this.#tt}get fft(){return this.#et}get bufferLength(){return this.#J}get transformableRaw(){return this._transformable}get transformable(){return Boolean(this._transformable)}get top(){return this.#st()[0][1]}get bottom(){return this.#st()[1][1]}get height(){const t=this.#st();return t[1][1]-t[0][1]}get left(){return this.#st()[0][0]}get right(){return this.#st()[1][0]}get width(){const t=this.#st();return t[1][0]-t[0][0]}get video(){return this._source}get image(){return this._source}get paused(){return this._source?.paused}get isPaused(){return this.paused}get playbackRate(){return this._source?.playbackRate}get speed(){return this.playbackRate}get currentTime(){return this._source?.currentTime}get loop(){return this._source?.loop}get isLooping(){return this.loop}set paused(t){try{t?this._source.pause():A.playMedia(this._source)}catch(t){}}set isPaused(t){this.paused=t}set playbackRate(t){this._source.playbackRate=t}set speed(t){this.playbackRate=t}set currentTime(t){this._source.currentTime=t}set loop(t){this._source.loop=t}set isLooping(t){this.loop=t}set binCB(t){this._binCB=t}set sampleCount(t){this._sampleCount=t,this.#et=this._audioAnalyser.fftSize=Math.max(32,2**Math.round(Math.log2(2*this._sampleCount))),this.#J=this._audioAnalyser.frequencyBinCount,this.#tt=new Uint8Array(this.#J)}set disableAudio(t){this._disableAudio=t,t?this._audioAnalyser.disconnect(this._audioCtx.destination):this._audioAnalyser.connect(this._audioCtx.destination)}set offsetPourcent(t){this._offsetPourcent=t}set errorCB(t){this._errorCB=t}set transformable(t){this._transformable=+t}set rotation(t){super.rotation=t,this.#it()}set scale(t){super.scale=t,this.#it()}}class A extends T{static SUPPORTED_IMAGE_FORMATS=["jpg","jpeg","png","gif","svg","webp","bmp","tiff","ico","heif","heic"];static SUPPORTED_VIDEO_FORMATS=["mp4","webm","ogv","mov","avi","mkv","flv","wmv","3gp","m4v"];static DEFAULT_WIDTH=128;static DEFAULT_HEIGHT=128;static SOURCE_TYPES={FILE_PATH:"string",DYNAMIC:"[object Object]",CAMERA:"CAMERA",CAPTURE:"CAPTURE",IMAGE:HTMLImageElement,SVG:SVGImageElement,BITMAP_PROMISE:Promise,BITMAP:ImageBitmap,VIDEO:HTMLVideoElement,CANVAS:HTMLCanvasElement,OFFSCREEN_CANVAS:OffscreenCanvas};static DYNAMIC_SOURCE_TYPES={VIDEO:HTMLVideoElement,CANVAS:HTMLCanvasElement,OFFSCREEN_CANVAS:OffscreenCanvas};static RESOLUTIONS={SD:[640,480],HD:[1280,720],FULL_HD:[1920,1080],"4K":[3840,2160],FOURK:[3840,2160],MAX:[3840,2160]};static CAMERA_FACING_MODES={USER:"user",ENVIRONMENT:"environment"};static DEFAULT_FACING_MODE=A.CAMERA_FACING_MODES.USER;static DEFAULT_CAMERA_RESOLUTION=A.RESOLUTIONS.HD;static DEFAULT_CAMERA_FRAME_RATE=30;static DEFAULT_CAMERA_SETTINGS=A.loadCamera();static DEFAULT_CAMERAS={CAMERA_SD:A.loadCamera(A.RESOLUTIONS.SD),CAMERA_HD:A.loadCamera(A.RESOLUTIONS.HD),CAMERA_FULL_HD:A.loadCamera(A.RESOLUTIONS.FULL_HD),CAMERA_4K:A.loadCamera(A.RESOLUTIONS.FOURK),CAMERA:A.DEFAULT_CAMERA_SETTINGS};static CAPTURE_MEDIA_SOURCES={SCREEN:"screen",WINDOW:"window",TAB:"tab"};static CAPTURE_CURSOR={ALWAYS:"always",MOTION:"motion",NONE:"none"};static DEFAULT_CAPTURE_RESOLUTION=A.RESOLUTIONS.HD;static DEFAULT_CAPTURE_MEDIA_SOURCE="screen";static DEFAULT_CAPTURE_FRAME_RATE=30;static DEFAULT_CAPTURE_CURSOR="always";static DEFAULT_CAPTURE_SETTINGS=A.loadCapture();static DEFAULT_CAPTURES={CAPTURE_SD:A.loadCapture(A.RESOLUTIONS.SD),CAPTURE_HD:A.loadCamera(A.RESOLUTIONS.HD),CAPTURE_FULL_HD:A.loadCamera(A.RESOLUTIONS.FULL_HD),CAPTURE_4k:A.loadCamera(A.RESOLUTIONS.FOURK),CAPTURE:A.DEFAULT_CAPTURE_SETTINGS};static ERROR_TYPES={NO_PERMISSION:0,DEVICE_IN_USE:1,SOURCE_DISCONNECTED:2,FILE_NOT_FOUND:3,NOT_AVAILABLE:4,NOT_SUPPORTED:5};static IS_CAMERA_SUPPORTED=()=>!!navigator?.mediaDevices?.getUserMedia;static IS_SCREEN_RECORD_SUPPORTED=()=>!!navigator?.mediaDevices?.getDisplayMedia;static DEFAULT_MEDIA_ERROR_CALLBACK=(t,e)=>console.warn("Error while loading media:",A.getErrorFromCode(t),"("+e+")");#ot=null;constructor(t,e,i,s,r,n,a,o){super(e,null,r,n,a,o),this._source=t,this._size=i||[],this._errorCB=s||A.DEFAULT_MEDIA_ERROR_CALLBACK,this._sourceCroppingPositions=null}initialize(){A.initializeDataSource(this._source,(e,i)=>{this._source=e,this.#ot=i,this.size=this._size,this._initialized=!0,t.isFunction(this._setupCB)&&(this._setupResults=this._setupCB(this,this._parent,this._source))},this._errorCB),this._pos=this.getInitPos()||T.DEFAULT_POS,this.setAnchoredPos()}draw(e,i,s){if(this.initialized){const i=this._source;if(i instanceof HTMLVideoElement&&!i.src&&!i.srcObject?.active)return;const s=e.ctx,r=1!==this._scale[0]||1!==this._scale[1],n=this._rotation||r;let a,o;if(n){const e=this.centerX,i=this.centerY,n=this.parent;a=n.viewPos,o=n.zoom,s.translate(e,i),this._rotation&&s.rotate(t.toRad(this._rotation)),r&&s.scale(this._scale[0],this._scale[1]),s.translate(-e,-i)}i instanceof HTMLCanvasElement?e.drawLateImage(i,this._pos,this._size,this._sourceCroppingPositions,this.visualEffects):e.drawImage(i,this._pos,this._size,this._sourceCroppingPositions,this.visualEffects),n&&s.setTransform(o,0,0,o,a[0],a[1])}super.draw(i,s)}static initializeDataSource(e,i,s){const r=A.SOURCE_TYPES;if(typeof e==r.FILE_PATH)A.isImageFormatSupported(e)?A.loadImage(e,s).onload=t=>A.#ht(t.target,i):A.isVideoFormatSupported(e)?A.#lt(A.loadVideo(e),i,s):t.isFunction(s)&&s(A.ERROR_TYPES.NOT_SUPPORTED,e);else if(e instanceof r.IMAGE||e instanceof r.SVG){const t=e.getAttribute("fakeload");e.complete&&e.src&&!t?A.#ht(e,i):e.onload=()=>{t&&e.removeAttribute("fakeload"),A.#ht(e,i)}}else e.toString()==r.DYNAMIC?e.type==r.CAMERA?A.#_t(e.settings,i,s):e.type==r.CAPTURE&&A.#ut(e.settings,i,s):e instanceof r.VIDEO?A.#lt(e,i,s):e instanceof r.CANVAS||e instanceof r.BITMAP||e instanceof r.OFFSCREEN_CANVAS?A.#ht(e,i):e instanceof MediaStream?A.#ct(e,i,s):e instanceof r.BITMAP_PROMISE&&e.then(t=>A.#ht(t,i))}static#ht(e,i,s=e.width||A.DEFAULT_WIDTH,r=e.height||A.DEFAULT_HEIGHT){t.isFunction(i)&&i(e,[s,r])}static#lt(e,i,s){const r=()=>this.#ht(e,i,e.videoWidth,e.videoHeight);e.onerror=i=>{t.isFunction(s)&&s(A.ERROR_TYPES.FILE_NOT_FOUND,e,i)},e.readyState?r():e.onloadeddata=r}static#ct(e,i,s){const r=document.createElement("video");r.srcObject=e,r.autoplay=!0,r.setAttribute("permaLoad","1"),e.oninactive=i=>{t.isFunction(s)&&s(A.ERROR_TYPES.SOURCE_DISCONNECTED,e,i)},r.oncanplay=()=>this.#ht(r,i,r.videoWidth,r.videoHeight)}static#_t(e=!0,i,s){A.IS_CAMERA_SUPPORTED()?navigator.mediaDevices.getUserMedia({video:e}).then(t=>A.#ct(t,i,s)).catch(i=>{t.isFunction(s)&&s(i.toString().includes("NotReadableError")?A.ERROR_TYPES.DEVICE_IN_USE:A.ERROR_TYPES.NO_PERMISSION,e,i)}):t.isFunction(s)&&s(A.ERROR_TYPES.NOT_AVAILABLE,e)}static#ut(e=!0,i,s){A.IS_SCREEN_RECORD_SUPPORTED()?navigator.mediaDevices.getDisplayMedia({video:e}).then(t=>A.#ct(t,i,s)).catch(i=>{t.isFunction(s)&&s(A.ERROR_TYPES.NO_PERMISSION,e,i)}):t.isFunction(s)&&s(A.ERROR_TYPES.NOT_AVAILABLE,e)}static loadImage(e,i=null,s=!1){const r=new Image;return r.src=e,t.isFunction(i)&&(r.onerror=t=>i(A.ERROR_TYPES.FILE_NOT_FOUND,e,t)),s&&r.setAttribute("fakeload","1"),r}static loadVideo(t,e=!0,i=!0){const s=document.createElement("video");return s.src=t instanceof File?URL.createObjectURL(t):t,s.preload="auto",s.loop=e,i&&(s.mute=!0,s.autoplay=i,A.playMedia(s)),s}static loadCamera(t=null,e=null,i=null){return t??=A.DEFAULT_CAMERA_RESOLUTION,{type:A.SOURCE_TYPES.CAMERA,settings:{width:{ideal:t?.[0]},height:{ideal:t?.[1]},facingMode:e??A.DEFAULT_FACING_MODE,frameRate:i??A.DEFAULT_CAMERA_FRAME_RATE}}}static loadCapture(t=null,e=null,i=null,s=null){return t??=A.DEFAULT_CAPTURE_RESOLUTION,{type:A.SOURCE_TYPES.CAPTURE,settings:{mediaSource:s??A.DEFAULT_CAPTURE_MEDIA_SOURCE,frameRate:i??A.DEFAULT_CAPTURE_FRAME_RATE,cursor:e??A.DEFAULT_CAPTURE_CURSOR,width:{ideal:t?.[0]},height:{ideal:t?.[1]}}}}static getErrorFromCode(t){return Object.keys(A.ERROR_TYPES)[t]}playVideo(){A.playMedia(this._source)}pauseVideo(){const t=this._source;t instanceof HTMLVideoElement&&t.pause()}static playMedia(e,i){(e instanceof HTMLVideoElement||e instanceof HTMLAudioElement)&&e.play().catch(()=>E.addOnFirstInteractCallback(()=>e.play().catch(s=>{t.isFunction(i)&&i(A.ERROR_TYPES.NOT_AVAILABLE,e,s)})))}static getNaturalSize(t){return[t?.displayWidth||t?.videoWidth||t?.width,t?.displayHeight||t?.videoHeight||t?.height]}duplicate(e=this._source,i=this.pos_,s=this.size_,r=this._setupCB,n=this._loopCB,a=this._anchorPos,o=this._activationMargin){const h=new A(e instanceof MediaStreamAudioSourceNode?e.mediaStream.clone():e.cloneNode(),i,s,r,n,a,o);return h._scale=t.unlinkArr2(this._scale),h._rotation=this._rotation,h._visualEffects=this.visualEffects_,this.initialized?h:null}isWithin(t,e,i,s){return super.isWithin(t,this.getBounds(e,i,s),e)}isWithinAccurate(t,e,i,s){const r=this.cvs.viewPos;return this.ctx.isPointInPath(this.getBoundsAccurate(e,i,s),t[0]+r[0],t[1]+r[1])}#st(){const t=this._size,e=this._pos;return[e,[e[0]+t[0],e[1]+t[1]]]}getBoundsAccurate(t,e=this._rotation,i=this._scale){const s=new Path2D,r=this.#st(),n=super.getCorners(r,t,e,i,super.getCenter(r));return s.moveTo(n[0][0],n[0][1]),s.lineTo(n[2][0],n[2][1]),s.lineTo(n[1][0],n[1][1]),s.lineTo(n[3][0],n[3][1]),s.lineTo(n[0][0],n[0][1]),s}getCenter(){return super.getCenter(this.#st())}getBounds(t,e=this._rotation,i=this._scale){const s=this.#st();return super.getBounds(s,t,e,i,super.getCenter(s))}remove(){this._source instanceof HTMLVideoElement&&(this._source.pause(),this._source.remove()),this._parent.remove(this._id)}aspectRatioWidthResize(t){const e=this._size[1]/this._size[0],i=0|("string"==typeof t?+t.replace("%","").trim()/100*this.#ot[0]:null==t?this.#ot[0]:t);this._size[0]=i,this._size[1]=i*e}aspectRatioHeightResize(t){const e=this._size[0]/this._size[1],i=0|("string"==typeof t?+t.replace("%","").trim()/100*this.#ot[1]:null==t?this.#ot[1]:t);this._size[1]=i,this._size[0]=i*e}static isFormatSupported(t){return A.isImageFormatSupported(t)||A.isVideoFormatSupported(t)}static isImageFormatSupported(t){const e=(t?.name||t).toLowerCase();return A.SUPPORTED_IMAGE_FORMATS.some(t=>e.endsWith("."+t))}static isVideoFormatSupported(t){const e=(t?.name||t).toLowerCase();return A.SUPPORTED_VIDEO_FORMATS.some(t=>e.endsWith("."+t))}static getSupportedHTMLAcceptValue(){const t=", .";return"."+A.SUPPORTED_IMAGE_FORMATS.join(t)+t+A.SUPPORTED_VIDEO_FORMATS.join(t)}[Symbol.toPrimitive](){return this.id}get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"ImageDisplay"}get ctx(){return this._parent._ctx}get size(){return this._size||[0,0]}get size_(){return this._size?t.unlinkArr2(this._size):[0,0]}get width(){return this._size[0]}get height(){return this._size[1]}get top(){return this._pos[1]}get bottom(){return this._pos[1]+this.height}get left(){return this._pos[0]}get right(){return this._pos[0]+this.width}get trueSize(){const t=this.size;return[Math.abs(t[0]*this._scale[0]),Math.abs(t[1]*this._scale[1])]}get naturalSize(){return this.#ot||A.getNaturalSize(this._source)}get centerX(){return this._pos[0]+this._size[0]/2}get centerY(){return this._pos[1]+this._size[1]/2}get centerPos(){return[this.centerX,this.centerY]}get source(){return this._source}get sourceCroppingPositions(){return this._sourceCroppingPositions}get errorCB(){return this._errorCB}get paused(){return this._source?.paused}get playbackRate(){return this._source?.playbackRate}get speed(){return this.playbackRate}get currentTime(){return this._source?.currentTime}get isLooping(){return this.loop}get isDynamic(){return this._source instanceof A.DYNAMIC_SOURCE_TYPES.CANVAS||this._source instanceof A.DYNAMIC_SOURCE_TYPES.OFFSCREEN_CANVAS||this._source instanceof A.DYNAMIC_SOURCE_TYPES.VIDEO}set source(t){const e=this._size;A.initializeDataSource(t,(t,i)=>{this._source=t,this.#ot=i,this.size=e},this._errorCB)}set errorCB(t){this._errorCB=t}set naturalSize(t){this.#ot=t}set size(t){return this.width=t[0],this.height=t[1],this._size}set width(t){this._size[0]=0|("string"==typeof t?+t.replace("%","").trim()/100*this.#ot[0]:null==t?this.#ot[0]:t)}set height(t){this._size[1]=0|("string"==typeof t?+t.replace("%","").trim()/100*this.#ot[1]:null==t?this.#ot[1]:t)}set paused(t){try{t?this._source.pause():A.playMedia(this._source)}catch(t){}}set playbackRate(t){this._source.playbackRate=t}set speed(t){this.playbackRate=t}set currentTime(t){this._source.currentTime=t}set isLooping(t){this.loop=t}set sourceCroppingPositions(t){if(t){const e=t[0],i=t[1],s=this.#ot;this._sourceCroppingPositions=[["string"==typeof e[0]?+e[0].replace("%","").trim()/100*s[0]:null==e[0]?0:e[0],"string"==typeof e[1]?+e[1].replace("%","").trim()/100*s[1]:null==e[1]?0:e[1]],["string"==typeof i[0]?+i[0].replace("%","").trim()/100*s[0]:null==i[0]?s[0]:i[0],"string"==typeof i[1]?+i[1].replace("%","").trim()/100*s[1]:null==i[1]?s[1]:i[1]]]}else this._sourceCroppingPositions=null}}class R extends T{static MEASUREMENT_CTX=new OffscreenCanvas(1,1).getContext("2d");static DEFAULT_LINE_HEIGHT_PADDING=10;#Et=null;constructor(t,e,i,s,r,n,a,o,h,_){super(e,i,a,o,h,_),this._text=t??"",this._textStyles=s,this._drawMethod=r?.toUpperCase()??l.DRAW_METHODS.FILL,this._maxWidth=n??void 0,this._lineHeight=null,this._size=null}initialize(){this._textStyles=t.isFunction(this._textStyles)?this._textStyles(this.render,this):this._textStyles??this.render.defaultTextProfile,this.#dt(),this.initialized=!0,super.initialize()}#dt(t=R.DEFAULT_LINE_HEIGHT_PADDING){this._size=this.getSize(),this.#Et=this.getTextValue().split("\n").length,this.#Et-1&&(this._size[1]-=t),this._lineHeight=this.trueSize[1]/this.#Et}draw(e,s,r){if(this.initialized&&(this.a??1)>i.OPACITY_VISIBILITY_THRESHOLD){const i=e.ctx,s=1!=this._scale[0]||1!=this._scale[1],r=this._rotation||s,n=this.getTextValue();let a,o;if(r){const e=this._pos[0],r=this._pos[1],n=this.parent;a=n.viewPos,o=n.zoom,i.translate(e,r),this._rotation&&i.rotate(t.toRad(this._rotation)),s&&i.scale(this._scale[0],this._scale[1]),i.translate(-e,-r)}"FILL"==this._drawMethod?e.fillText(n,this._pos,this._color,this._textStyles,this._maxWidth,this._lineHeight,this.visualEffects):e.strokeText(n,this._pos,this._color,this._textStyles,this._maxWidth,this._lineHeight,this.visualEffects),r&&i.setTransform(o,0,0,o,a[0],a[1])}super.draw(s,r)}getSize(t=this._textStyles,e=this.getTextValue(),i){return R.getSize(t,e,i,this._maxWidth)}static getSize(e,i,s=R.DEFAULT_LINE_HEIGHT_PADDING,r,n=[1,1]){_.apply(R.MEASUREMENT_CTX,...e.getStyles());const a=i.replace(/./g,1).split("\n"),o=a.length,h=o>1?a.reduce((t,e)=>t.length<e.length?e:t):i,{width:l,actualBoundingBoxAscent:u,actualBoundingBoxDescent:c}=R.MEASUREMENT_CTX.measureText(h);return[t.round(r||l,4)*n[0],(u+c)*o*n[1]+o*s]}#Tt(t=R.DEFAULT_LINE_HEIGHT_PADDING){const e=R.MEASUREMENT_CTX,i=this._maxWidth,s=this.getTextValue().split("\n"),r=s.length,n=new Array(r);_.apply(e,...this._textStyles.getStyles());for(let a=0;a<r;a++){const r=e.measureText("1".repeat(s[a].length)),o=r.width;n[a]=[i&&o>i?i:o,r.actualBoundingBoxAscent+r.actualBoundingBoxDescent+t]}return n}getTextValue(){return(t.isFunction(this._text)?this._text(this._parent,this):this._text).trim()}duplicate(e=this._text,i=this.pos_,s=this._color,r=this._textStyles,n=this._drawMethod,a=this._maxWidth,o=this._setupCB,h=this._loopCB,l=this._anchorPos,_=this._activationMargin){const u=s,c=u.colorRaw,E=new R(e,i,(t,e)=>c instanceof C||c instanceof g?c.duplicate(Array.isArray(c.initPositions)?null:e):u.duplicate(),r,n,a,o,h,l,_);return E._scale=t.unlinkArr2(this._scale),E._rotation=this._rotation,E._visualEffects=this.visualEffects_,this.initialized?E:null}isWithin(t,e,i,s){return super.isWithin(t,this.getBounds(e,i,s),e)}isWithinAccurate(t,e,i,s){const r=this.cvs.viewPos;return this.ctx.isPointInPath(this.getBoundsAccurate(e,i,s),t[0]+r[0],t[1]+r[1])}#st(){const t=this._size,e=this._pos,i=R.DEFAULT_LINE_HEIGHT_PADDING/2+this._lineHeight/2;return[[e[0]-t[0]/2,e[1]-i/2-3],[e[0]+t[0]/2,e[1]+t[1]-i]]}getBoundsAccurate(e,i=this._rotation,s=this._scale,r=R.DEFAULT_LINE_HEIGHT_PADDING,n=this.render.currentCtxStyles[0]){const a=new Path2D,o=this.#Tt(),h=o.length,l=this._pos[1]-(r/4+this._lineHeight/4)-n,_=this._pos[0]-n/2;if(e)for(let t=0;t<h;t++)o[t][0]+=e;let u=o[0][1]-(h-1?r/h:r/4),c=o[0][0]/2,E=o[h-1][0],d=_+c,T=[[_-c,l],[d,l]];for(let t=1;t<h;t++){const e=l+u*t;T.push([d,e],[d=_+o[t][0]/2,e])}T.push([d,l+u*h-r/2]),T.push([d-E,l+u*h-r/2]),T.push([d-=E,l+u*(h-1)]);for(let t=h-1;t>0;t--)T.push([_-o[t-1][0]/2,l+u*t],[_-o[t-1][0]/2,l+u*(t-1)]);for(let e=0;e<T.length;e++){let r=T[e];1==s[0]&&1==s[1]||(r=t.scalePos(r,s,this._pos)),i&&(r=t.rotatePos(r,i,this._pos)),e?a.lineTo(r[0],r[1]):a.moveTo(r[0],r[1])}return a}getCenter(){return super.getCenter(this.#st())}getBounds(t,e=this._rotation,i=this._scale){return super.getBounds(this.#st(),t,e,i,this._pos)}static loadCustomFont(t,e=null,i={},s=null,r=e=>console.warn("Error loading font:",t,e)){_.loadCustomFont(t,e,i,s,r)}[Symbol.toPrimitive](){return this.id}*[Symbol.iterator](){const t=this.getTextValue(),e=t.length;for(let i=0;i<e;i++)yield t[i]}get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"TextDisplay"}get ctx(){return this._parent.ctx}get render(){return this._parent.render}get text(){return this._text+""}get textStyles(){return this._textStyles}get drawMethod(){return this._drawMethod}get maxWidth(){return this._maxWidth}get size(){return this._size}get lineHeight(){return this._lineHeight}get trueSize(){return[Math.abs(this._size[0]*this._scale[0]),Math.abs(this._size[1]*this._scale[1])]}get render(){return this._parent.render}get lineCount(){return this.#Et}get width(){return this.trueSize[0]}get height(){return this.trueSize[1]}get top(){return this._pos[1]-this.lineHeight/2}get bottom(){return this._pos[1]+this.lineHeight*this.lineCount-this.lineHeight/2}get left(){return this._pos[0]-this._size[0]/2}get right(){return this._pos[0]+this._size[0]/2}set text(t){const e=this._scale[1];this._text=""+t||"",this._scale[1]=1,this.#dt(),this._scale[1]=e}set textStyles(t){this._textStyles=t??this.render.defaultTextProfile,this.#dt()}set drawMethod(t){this._drawMethod=t.toUpperCase()}set maxWidth(t){this._maxWidth=t??void 0,this.#dt()}set lineHeight(t){this._lineHeight=t}}class p{static PLACEHOLDER="PLACEHOLDER";static PLACEHOLDER_COLOR="transparent";constructor(t,e){this._initPositions=t,this._positions=t,this._rotation=e??0,this._lastChangeValue=null,this._value=null}get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"_DynamicColor"}get initPositions(){return this._initPositions}get positions(){return this._positions}get rotation(){return this._rotation}get isDynamic(){return null!=this._initPositions?.pos}get value(){return this.isDynamic&&this.update(),this._value}set initPositions(t){this._initPositions=t}set positions(t){this._positions=t,this.isDynamic||this.update(!0)}set rotation(e){this._rotation=t.round(e,2)%360,this.isDynamic||this.update(!0)}}class g extends p{static#St=0;static#At=new OffscreenCanvas(1,1).getContext("2d");static#Rt=new DOMMatrixReadOnly;static LOADED_PATTERN_SOURCES=[];static PLACEHOLDER_COLOR="transparent";static REPETITION_MODES={REPEAT:"repeat",REPEAT_X:"repeat-x",REPEAT_Y:"repeat-y",NO_REPEAT:"no-repeat"};static DEFAULT_REPETITION_MODE=g.REPETITION_MODES.NO_REPEAT;static DEFAULT_FRAME_RATE=1/30;static SERIALIZATION_SEPARATOR="!";static FORCE_UPDATE_LEVELS={DISABLED:null,RESPECT_FRAME_RATE:!0,OVERRIDE:2};static DEFAULT_FORCE_UPDATE_LEVEL=g.FORCE_UPDATE_LEVELS.DISABLED;#pt=null;#gt=!1;constructor(e,i,s,r,n,a,o,h,l,_,u){super(s,o),this._id=g.#St++,this._render=e,this._source=i,this._sourceCroppingPositions=r,this._keepAspectRatio=n??!1,this._forcedUpdates=a??g.DEFAULT_FORCE_UPDATE_LEVEL;const c=_??g.DEFAULT_FRAME_RATE;this._frameRate=c%1?c:1/Math.max(c,0),this._errorCB=h||A.DEFAULT_MEDIA_ERROR_CALLBACK,this._readyCB=l,this._repeatMode=u??g.DEFAULT_REPETITION_MODE,g.LOADED_PATTERN_SOURCES[this._id]=this,A.initializeDataSource(i,e=>{this._source=e,this.sourceCroppingPositions=this._sourceCroppingPositions||null,this.#gt=!0,t.isFunction(this._readyCB)&&this._readyCB(this),this.update(g.FORCE_UPDATE_LEVELS.OVERRIDE)},this._errorCB)}getAutomaticPositions(t=this._initPositions){return t instanceof O?this.#It(t)?t.getBounds(0,0,0):this._positions:t instanceof P?this.#Ot(t)?t.getBounds(0,0,0):this._positions:t instanceof R?this.#Ct(t)?t.getBounds(0,0,0):this._positions:t instanceof S?t.getBounds(0,0,0):this._positions}#It(t){const e=t.dotsPositions+t.radius;return e!==this._lastChangeValue&&(this._lastChangeValue=e,!0)}#Ot(t){const e=t.stringPos+t.radius;return e!==this._lastChangeValue&&(this._lastChangeValue=e,!0)}#Ct(t){const e=t.trueSize+t.pos;return e!==this._lastChangeValue&&(this._lastChangeValue=e,!0)}update(e=this._forcedUpdates){if(this.#gt){const i=this._source,s=this._render.ctx,r=i instanceof HTMLCanvasElement,n=g.FORCE_UPDATE_LEVELS,a=r||e==n.RESPECT_FRAME_RATE?performance.now()/1e3:i.currentTime;if(null!=a&&e!=n.OVERRIDE){if(this.#pt>a&&(this.#pt=a),!(a-this.#pt>=this._frameRate))return;this.#pt=a}const o=this.getAutomaticPositions();if(e!=n.OVERRIDE&&(!i.currentTime||i.paused)&&Array.isArray(this._positions)&&t.positionsEquals(o,this._positions)&&this._value)return;this._positions=o,r?this._render._bactchedStandalones.push(()=>this._value=this.#Pt(s,i)):this._value=this.#Pt(s,i)}}#Pt(t,e){let i,s;const r=g.#Rt,n=this._sourceCroppingPositions;if(n){const t=g.#At,r=t.canvas,a=n[0][0],o=n[0][1];i=r.width=Math.abs(n[1][0]-a),s=r.height=Math.abs(n[1][1]-o),t.clearRect(0,0,i,s),t.drawImage(e,a,o,i,s,0,0,i,s),e=r}else[i,s]=A.getNaturalSize(e);const a=t.createPattern(e,this._repeatMode),o=this._positions;if(o){const t=o[0],e=o[1],n=e[0]-t[0],h=e[1]-t[1],l=n/i,_=h/s,u=this._rotation;if(this._keepAspectRatio){const e=l>_,o=e?l:_,c=i*o/2,E=s*o/2;u?a.setTransform(r.translate(t[0]-(e?0:c-n/2)+c,t[1]-(e?E-h/2:0)+E).rotate(u).translate(-c,-E).scale(o,o)):a.setTransform(r.translate(t[0]-(e?0:c-n/2),t[1]-(e?E-h/2:0)).scale(o,o))}else{const e=i*l/2,n=s*_/2;u?a.setTransform(r.translate(t[0]+e,t[1]+n).rotate(u).translate(-e,-n).scale(l,_)):a.setTransform(r.translate(t[0],t[1]).scale(l,_))}}return a}toString(){return this._id+g.SERIALIZATION_SEPARATOR}playVideo(){A.playMedia(this._source)}pauseVideo(){try{this._source.pause()}catch(t){}}duplicate(e=this._positions,i=this._render,s=this._source,r=this._sourceCroppingPositions,n=this._keepAspectRatio,a=this._forcedUpdates,o=this._rotation,h=this._errorCB,l=this._frameRate,_=this._repeatMode){return!(s instanceof HTMLElement)||s.getAttribute("permaLoad")||s instanceof HTMLCanvasElement||(s=s.cloneNode()).setAttribute("fakeload","1"),new g(i,s,t.unlinkPositions(e),t.unlinkPositions(r),n,a,o,h,null,l,_)}static loadImage(t,e=null,i=!1){return A.loadImage(t,e,i)}static loadVideo(t,e=!0,i=!0){return A.loadVideo(t,e,i)}static loadCamera(t=null,e=null,i=this._frameRate){return A.loadCamera(t,e,i)}static loadCapture(t=null,e=null,i=this.frameRate,s=null){return A.loadCapture(t,e,i,s)}[Symbol.toPrimitive](){return this.value}get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"Pattern"}get id(){return this._id}get render(){return this._render}get source(){return this._source}get sourceCroppingPositions(){return this._sourceCroppingPositions}get keepAspectRatio(){return this._keepAspectRatio}get forcedUpdates(){return this._forcedUpdates}get repeatMode(){return this._repeatMode}get frameRate(){return 1/this._frameRate}get value(){const t=this._source;return t instanceof HTMLVideoElement&&!t.src&&!t.srcObject?.active?g.PLACEHOLDER_COLOR:((this._forcedUpdates||t instanceof HTMLVideoElement||t instanceof HTMLCanvasElement)&&this.update(),this._value??g.PLACEHOLDER_COLOR)}get naturalSize(){return A.getNaturalSize(this._source)}get video(){return this._source}get image(){return this._source}get paused(){return this._source?.paused}get isPaused(){return this.paused}get playbackRate(){return this._source?.playbackRate}get speed(){return this.playbackRate}get currentTime(){return this._source?.currentTime}get loop(){return this._source?.loop}get isLooping(){return this.loop}set paused(t){try{t?this._source.pause():A.playMedia(this._source)}catch(t){}}set isPaused(t){this.paused=t}set playbackRate(t){this._source.playbackRate=t}set speed(t){this.playbackRate=t}set currentTime(t){this._source.currentTime=t}set loop(t){this._source.loop=t}set isLooping(t){this.loop=t}set source(t){A.initializeDataSource(t,t=>{this._source=t,this.update(2)})}set sourceCroppingPositions(t){if(t){const e=t[0],i=t[1],s=this.naturalSize;this._sourceCroppingPositions=[["string"==typeof e[0]?+e[0].replace("%","").trim()/100*s[0]:null==e[0]?0:e[0],"string"==typeof e[1]?+e[1].replace("%","").trim()/100*s[1]:null==e[1]?0:e[1]],["string"==typeof i[0]?+i[0].replace("%","").trim()/100*s[0]:null==i[0]?s[0]:i[0],"string"==typeof i[1]?+i[1].replace("%","").trim()/100*s[1]:null==i[1]?s[1]:i[1]]],this.update(2)}else this._sourceCroppingPositions=null}set keepAspectRatio(t){this._keepAspectRatio=t,this.update(2)}set forcedUpdates(t){this._forcedUpdates=t,this.update(2)}set repeatMode(t){this._repeatMode=t,this.update(2)}set frameRate(t){this._frameRate=1/Math.max(t,0)}set rotation(e){this._rotation=t.round(e,2)%360,this.update(2)}}class I extends T{static DEFAULT_RADIUS=5;static RADIUS_PRECISION=4;constructor(t,e,i,s,r,n,a){super(t,i,s,r,n,a),this._initRadius=e,this._radius=this._initRadius}initialize(){this._radius=this.getInitRadius()??I.DEFAULT_RADIUS,super.initialize()}getInitRadius(){return t.isFunction(this._initRadius)?this._initRadius(this._parent instanceof E?this:this._parent,this):this._initRadius??null}isWithin(t,e){return super.isWithin(t,e)}getCenter(t){return super.getCenter(t)}getBounds(t,e,i,s,r){return super.getBounds(t,e,i,s,r)}get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"_Obj"}get radius(){return this._radius}get initRadius(){return this._initRadius}set radius(e){this._radius=t.round(e<0?0:e,I.RADIUS_PRECISION)}set initRadius(t){this._initRadius=t}}class O extends I{static DEFAULT_LIMIT=100;static DEFAULT_RATIO_POS=[Infinity,Infinity];constructor(t,e,s,r,n,a,o,h,l,_,u,c){super(t,s??I.DEFAULT_RADIUS,r||i.DEFAULT_COLOR,h,l,_,u),this._limit=n||O.DEFAULT_LIMIT,this._initDots=e,this._dots=[],this._ratioPos=[...O.DEFAULT_RATIO_POS],this._drawEffectCB=a,this._ratioPosCB=o,this._fragile=c||!1}initialize(){this._pos=this.getInitPos(),this.setAnchoredPos(),Array.isArray(this._initDots)||this._initDots instanceof P?this.add(this._initDots):t.isFunction(this._initDots)?this.add(this._initDots(this,this._parent)):"string"==typeof this._initDots&&this.add(this.createFromString(this._initDots)),this.setRadius(this.getInitRadius(),!0),this.setColor(this.getInitColor(),!0),this._visualEffects&&this.setVisualEffects(this._visualEffects,!0),this.initialized=!0,t.isFunction(this._setupCB)&&(this._setupResults=this._setupCB(this,this?.parent))}draw(e,i,s){super.draw(i,s),t.isFunction(this._ratioPosCB)&&(this._ratioPos=this._ratioPosCB(this))}add(t){this._dots.push(...[t].flat().filter(t=>t).map(t=>(null==t.initColor&&(t.initColor=this.colorRaw),null==t.initRadius&&(t.initRadius=this._radius),t.activationMargin==E.DEFAULT_CANVAS_ACTIVE_AREA_PADDING&&(t.activationMargin=this._activationMargin),null==t.visualEffect&&(t.visualEffect=this.visualEffects_),t._parent=this,t.initialize(),t))),this._parent.updateCachedAllEls()}remove(t=null){t?this._dots=this._dots.filter(e=>e.id!=(t?.id??t)):this._parent.remove(this._id),this._parent.updateCachedAllEls()}static generate(e,i,s,r,n,a){e??=()=>0,i??=[0,0],s??=100,r??=1,n??=[-50,50];let o=[],h=null,l=t.isFunction(a);for(let _=0;_<=s;_+=t.getValueFromRange(r)){const s=new P([i[0]+_,i[1]+t.getValueFromRange(n)+e(_)]);(h||s)&&l&&a(s,h),o.push(s),h=s}return o}createFromString(t,e=[0,0],i=[25,25],s="o"){const r=[];return t.split("\n").filter(t=>t).forEach((t,n)=>{let[a,o]=e;o+=n*i[1],[...t].forEach(t=>{t==s&&r.push(new P([a+i[0]/2,o+i[1]/2])),a+=i[0]})}),r}setRadius(t=this._radius,e){this._radius=t;const i=this._dots.length;for(let s=0;s<i;s++){const i=this._dots[s];e&&null==i.initRadius?(i.radius=t,i.initRadius=t):e||(i.radius=t,i.initRadius||(i.initRadius=t))}}setColor(t=this._color,e){this.color=t;const i=this._dots.length;for(let s=0;s<i;s++){const i=this._dots[s];e&&!i.initColor?(i.color=t,i.initColor=t):e||(i.color=t,i.initColor||(i.initColor=t))}}setVisualEffects(t=this._visualEffects,e){this._visualEffects=t;const i=this._dots.length;for(let s=0;s<i;s++){const i=this._dots[s];e&&!i.visualEffect?i.visualEffects=t:e||(i.visualEffects=t)}}setActivationMargin(t=this._activationMargin,e){this._activationMargin=t;const i=this._dots.length;for(let s=0;s<i;s++){const i=this._dots[s];e&&i.activationMargin===T.DEFAULT_ACTIVATION_MARGIN?i.activationMargin=t:e||(i.activationMargin=t)}}addForce(e,i,s=1e3,r=d.easeInOutQuad,n=!0,a=!0){const o=t.toRad(i),h=this.x,l=this.y,_=t.getAcceptableDiff(e*Math.cos(o),t.DEFAULT_ACCEPTABLE_DIFFERENCE),u=t.getAcceptableDiff(e*Math.sin(o),t.DEFAULT_ACCEPTABLE_DIFFERENCE);return this.playAnim(new d(t=>{this.moveAt([h+_*t,l-u*t])},s,r),n,a)}rotateBy(e,i=this.getCenter()){const[s,r]=i;this._dots.forEach(i=>{const n=i.x-s,a=i.y-r,o=Math.cos(t.toRad(e)),h=Math.sin(t.toRad(e));i.x=n*o-a*h+s,i.y=n*h+a*o+r}),this._rotation=(this._rotation+e)%360}rotateAt(t,e=this.getCenter()){this.rotateBy(360-(this._rotation-t),e)}rotateTo(t,e=1e3,i=d.easeInOutQuad,s=this.getCenter(),r=!0,n=!0){const a=this._rotation,o=t-this._rotation;return this.playAnim(new d(t=>{this.rotateAt(a+o*t,s)},e,i),r,n)}scaleBy(t,e=this.getCenter()){const[i,s]=t,[r,n]=e,a=this._dots,o=a.length;for(let t=0;t<o;t++){const e=a[t];e.x=(e.x-r)*i+r,e.y=(e.y-n)*s+n}this._scale=[this._scale[0]*i,this._scale[1]*s]}scaleAt(t,e=this.getCenter()){const i=t[0]/this._scale[0],s=t[1]/this._scale[1];this.scaleBy([i||1,s||1],e)}scaleTo(t,e=1e3,i=d.easeInOutQuad,s=this.getCenter(),r=!0,n=!0){const a=this._scale,o=t[0]-this._scale[0],h=t[1]-this._scale[1];return this.playAnim(new d(t=>{this.scaleAt([a[0]+o*t,a[1]+h*t],s)},e,i),r,n)}isWithin(t,e){return super.isWithin(t,this.getBounds(e),e)}isWithinAccurate(t){if(this._dots.length>2){const e=this.cvs.viewPos;return this.ctx.isPointInPath(this.getBoundsAccurate(),t[0]+e[0],t[1]+e[1])}return!1}#st(){const e=t.getMinMax(this._dots,"x"),i=t.getMinMax(this._dots,"y");return[[e[0],i[0]],[e[1],i[1]]]}getBoundsAccurate(){const t=this._dots,e=t.length,i=new Path2D,s=t[0].pos;i.moveTo(s[0],s[1]);for(let s=1;s<e;s++){const e=t[s].pos;i.lineTo(e[0],e[1])}return i.closePath(),i}getCenter(){return super.getCenter(this.#st())}getBounds(t=this._radius,e,i,s){const r=this.#st();return super.getBounds(r,t,e,i,s)}clear(){this._dots=[],this._parent.updateCachedAllEls()}reset(){this._initDots&&(this.clear(),this.initialize())}enableDotsPathCaching(){const t=this._dots,e=t.length;for(let i=0;i<e;i++)t[i].updateCachedPath()}disableDotsPathCaching(){const t=this._dots,e=t.length;for(let i=0;i<e;i++)t[i].disablePathCaching()}disable(){const t=this._dots,e=t.length;for(let i=0;i<e;i++)t[i].disable()}enable(){const t=this._dots,e=t.length;for(let i=0;i<e;i++)t[i].enable()}duplicate(e=this.pos_,i=this._dots.map(t=>t.duplicate()),s=this._radius,r=this._color,n=this._limit,a=this._drawEffectCB,o=this._ratioPosCB,h=this._setupCB,l=this._loopCB,_=this._anchorPos,u=this._activationMargin,c=this._fragile){const E=r,d=E.colorRaw,T=new O(e,i,s,(t,e)=>d instanceof C||d instanceof g?d.duplicate(Array.isArray(d.initPositions)?null:e):E.duplicate(),n,a,o,h,l,_,u,c);return T._scale=t.unlinkArr2(this._scale),T._rotation=this._rotation,T._visualEffects=this.visualEffects_,this.initialized?T:null}[Symbol.toPrimitive](){return this.id}*[Symbol.iterator](){const t=this._dots,e=t.length;for(let i=0;i<e;i++)yield t[i]}get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"Shape"}get cvs(){return this._parent}get ctx(){return this.cvs.ctx}get render(){return this.cvs.render}get dots(){return this._dots}get limit(){return this._limit}get initDots(){return this._initDots}get drawEffectCB(){return this._drawEffectCB}get ratioPos(){return this._ratioPos}get ratioPosCB(){return this._ratioPosCB}get lastDotsPos(){return this._lastDotsPos}get dotsPositions(){let t="",e=this.dots.length;for(let i=0;i<e;i++)t+=this.dots[i].stringPos;return t}get firstDot(){return this._dots[0]}get secondDot(){return this._dots[1]}get thirdDot(){return this._dots[2]}get lastDot(){return t.getLast(this._dots,0)}get asSource(){return this._dots}get top(){return t.getMinMax(this._dots,"y")[0]}get bottom(){return t.getMinMax(this._dots,"y")[1]}get height(){const e=t.getMinMax(this._dots,"y");return e[1]-e[0]}get left(){return t.getMinMax(this._dots,"x")[0]}get right(){return t.getMinMax(this._dots,"x")[1]}get width(){const e=t.getMinMax(this._dots,"x");return e[1]-e[0]}set dots(t){this._ratioPos=t}set ratioPos(t){this._ratioPos=t}set drawEffectCB(t){this._drawEffectCB=t}set ratioPosCB(t){this._ratioPosCB=t}set lastDotsPos(t){this._lastDotsPos=t}set limit(t){this._limit=t}}class C extends p{static TYPES={LINEAR:"Linear",RADIAL:"Radial",CONIC:"Conic"};static DEFAULT_TYPE=C.TYPES.LINEAR;static SERIALIZATION_SEPARATOR="*";static SERIALIZATION_COLOR_STOPS_SEPARATOR="$";#ft=null;#mt=null;constructor(t,e,s,r,n){super(e,n),this._ctx=t.ctx??t,this._type=r||C.DEFAULT_TYPE,this._colorStops=s.map(([t,e])=>[t,i.uniquify(e)]),this.update()}getAutomaticPositions(e=this._initPositions){if(e instanceof O){if(this.#Dt()||this.#It(e)){const i=t.getMinMax(e.dots,"x"),s=t.getMinMax(e.dots,"y"),r=i[0],n=s[0],a=i[1],o=s[1],h=r+(a-r)/2,l=n+(o-n)/2;return this._type==C.TYPES.LINEAR?this.#Lt(r-h,n-l,a-h,o-l,h,l):this._type==C.TYPES.RADIAL?this.#Nt(h,l,Math.max(a-r,o-n)):e.getCenter()}return this._positions}if(e instanceof P){if(this.#Dt()||this.#Ot(e)){const t=e.pos[0],i=e.pos[1];return this._type==C.TYPES.LINEAR?this.#Lt(e.left-t,e.top-i,e.right-t,e.bottom-i,t,i):this._type==C.TYPES.RADIAL?this.#Nt(t,i,e.radius):e.pos_}return this._positions}if(e instanceof R){if(this.#Dt()||this.#Ct(e)){const[t,i]=e.trueSize,[s,r]=e.pos,n=s-t/2,a=s+t/2,o=r-i/2,h=r+i/2;return this._type==C.TYPES.LINEAR?this.#Lt(n-s,o-r,a-s,h-r,s,r):this._type==C.TYPES.RADIAL?this.#Nt(s,r,Math.max(a-n,h-o)):e.pos_}return this._positions}if(e instanceof S)return e.getBounds();if(this._type==C.TYPES.LINEAR){const[[t,i],[s,r]]=e,n=t+(s-t)/2,a=i+(r-i)/2;return this.#Lt(t-n,i-a,s-n,r-a,n,a)}return this._positions}#Lt(e,i,s,r,n,a){const o=Math.cos(t.toRad(this._rotation)),h=Math.sin(t.toRad(this._rotation)),l=t.round;return[[l(e*o-i*h+n),l(e*h+i*o+a)],[l(s*o-r*h+n),l(s*h+r*o+a)]]}#Nt(t,e,i){return[[t,e,i],[t,e,.25*i]]}#Dt(){return(this.#ft!==this._rotation||this.#mt!==this._type)&&(this.#ft=this._rotation,this.#mt=this._type,!0)}#It(t){const e=t.dotsPositions;return e!==this._lastChangeValue&&(this._lastChangeValue=e,!0)}#Ot(t){const e=t.stringPos;return e!==this._lastChangeValue&&(this._lastChangeValue=e,!0)}#Ct(t){const e=t.trueSize+t.pos;return e!==this._lastChangeValue&&(this._lastChangeValue=e,!0)}update(e){if(this._initPositions!=p.PLACEHOLDER){const i=this.getAutomaticPositions();if(!e&&Array.isArray(this._positions)&&t.positionsEquals(i,this._positions))return;return this._value=C.getCanvasGradient(this._ctx,this._positions=i,this._colorStops,this._type,this._rotation)}}duplicate(e=this._positions,i=this._ctx,s=this._colorStops,r=this._type,n=this._rotation){return new C(i,t.unlinkPositions(e),[...s],r,n)}toString(){const t=C.SERIALIZATION_SEPARATOR;return this._positions+t+this._colorStops.flat().join(C.SERIALIZATION_COLOR_STOPS_SEPARATOR)+t+this._type+t+this._rotation}static getCanvasGradient(e,s,r,n,a){const o=n==C.TYPES.CONIC?e.createConicGradient(t.toRad(a),s[0],s[1]):e[`create${n}Gradient`](...s[0],...s[1]),h=r.length;for(let t=0;t<h;t++)o.addColorStop(r[t][0],i.getColorValue(r[t][1]));return o}static getCanvasGradientFromString(t,e){let[i,s,r,n]=e.split(C.SERIALIZATION_SEPARATOR),a=i.split(","),o=s.split(C.SERIALIZATION_COLOR_STOPS_SEPARATOR),h=o.length;i=2==a.length?[+a[0],+a[1]]:[[+a[0],+a[1]],[+a[2],+a[3]]],s=[];for(let t=0;t<h;t+=2)s.push([+o[t],o[t+1]]);return C.getCanvasGradient(t,i,s,r,+n)}[Symbol.toPrimitive](){return this.toString()}*[Symbol.iterator](){const t=this._colorStops,e=t.length;for(let i=0;i<e;i++)yield t[i]}get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"Gradient"}get ctx(){return this._ctx}get type(){return this._type}get colorStops(){return this._colorStops}set colorStops(t){this._colorStops=t.map(([t,e])=>[t,i.uniquify(e)]),this.isDynamic||this.update()}set type(t){this._type=t,this.isDynamic||this.update()}}Symbol.toPrimitive,Symbol.toStringTag,Symbol.toPrimitive,Symbol.toStringTag;class P extends I{constructor(t,e,i,s,r,n,a=!1){super(t,e,i,s,null,r,n),this._connections=[],this._cachedPath=!a}draw(e,s,r){if(this.initialized){const s=this.drawEffectCB;if(s){const t=this.getDistance(),i=this.getRatio(t),r=i<1,n=this._parent;s(e,this,r?i:1,n.setupResults,n.parent.mouse,t,n,r,i)}if(this._radius&&(this.a??1)>i.OPACITY_VISIBILITY_THRESHOLD){const i=e.ctx,s=this._scale[0],r=this._scale[1],n=1!==s||1!==r;if(n||this._visualEffects?.[0]?.indexOf("#")+1||this._rotation){let a,o;if(n){const e=this._pos[0],n=this._pos[1],h=this.cvs;a=h.viewPos,o=h.zoom,i.translate(e,n),this._rotation&&i.rotate(t.toRad(this._rotation)),i.scale(s,r),i.translate(-e,-n)}e.fill(this._cachedPath||l.getArc(this._pos,this._radius),this._color,this.visualEffects),n&&i.setTransform(o,0,0,o,a[0],a[1])}else e.batchFill(this._cachedPath||l.getArc(this._pos,this._radius),this._color,this.visualEffects)}}else this.initialized=!0,this._cachedPath&&this.updateCachedPath();super.draw(s,r)}getDistance(e=this.ratioPos){const i=this._pos;return t.getDist(e[0],e[1],i[0],i[1])}getRatio(t){return t/this.limit}addConnection(t){t instanceof P&&this._connections.push(t)}removeConnection(t){this._connections=this._connections.filter(e=>"number"==typeof t?e.id!==t:e.id!==t.id)}remove(){this._parent.remove(this._id)}getLinearIntersectPoints(e=this._connections[0],i=e.radius??5,s=this,r=this.radius??5){const n=e.pos??e,a=n[0],o=n[1],h=s.pos??s,l=h[0],_=h[1],u=t.getLinearFn_coords(l,_,a,o),c=u[0],E=u[1],d=u[2],T=i**2,S=r**2,A=2*(1+c**2),R=-(2*c*(E-_)-2*l),p=Math.sqrt(R**2-A/2*4*((E-_)**2+l**2-S)),g=-(2*c*(E-o)-2*a),I=Math.sqrt(g**2-A/2*4*((E-o)**2+a**2-T)),O=(R+p)/A,C=(R-p)/A,P=(g+I)/A,f=(g-I)/A,m=d(O),D=d(C),L=d(P),N=d(f);return t.getDist(O,m,f,N)<t.getDist(C,D,P,L)?[[[O,m],[C,D]],[[f,N],[P,L]]]:[[[C,D],[O,m]],[[P,L],[f,N]]]}updateCachedPath(){this._cachedPath=l.getArc(this._pos,this._radius)}disablePathCaching(){this._cachedPath=null}duplicate(e=this.getInitPos(),i=this._radius,s=this._color,r=this._setupCB,n=this._anchorPos,a=this._activationMargin,o=!this._cachedPath){const h=s,l=h?.colorRaw,_=new P(e,i,(l instanceof C||l instanceof g)&&null!=l._initPositions.id&&null!=this._parent.id&&l._initPositions.id==this._parent.id?null:(t,e)=>l instanceof C||l instanceof g?l.duplicate(Array.isArray(l.initPositions)?null:e):h.duplicate(),r,n,a,o);return _._scale=t.unlinkArr2(this._scale),_._rotation=this._rotation,_._visualEffects=this.visualEffects_,_}isWithin(t,e,i,s){return super.isWithin(t,this.getBounds(e,i,s))}isWithinAccurate(t,e,i,s){const r=this.cvs.viewPos;return this.ctx.isPointInPath(this.getBoundsAccurate(e,i,s),t[0]+r[0],t[1]+r[1])}#st(){const t=this._pos,e=this._radius;return[[t[0]-e,t[1]-e],[t[0]+e,t[1]+e]]}getBoundsAccurate(e,i=this._rotation,s=this._scale){const r=this._radius;return e??=0,e="number"==typeof e?[e,e]:[e[0],e[1]??e[0]],l.getEllispe(this._pos,r*s[0]+e[0],r*s[1]+e[1],t.toRad(i))}getCenter(){return this._pos}getBounds(t,e=this._rotation,i=this._scale){const s=this.#st();return super.getBounds(s,t,i[0]==i[1]||1==i[0]&&1==i[1]?0:e,i,super.getCenter(s))}[Symbol.toPrimitive](){return this.id}*[Symbol.iterator](){const t=this._connections,e=t.length;for(let i=0;i<e;i++)yield t[i]}get[Symbol.toStringTag](){return this.instanceOf}get instanceOf(){return"Dot"}get ctx(){return this.cvs.ctx}get cvs(){return this._parent.parent||this._parent}get render(){return this.cvs.render}get limit(){return this._parent.limit}get drawEffectCB(){return this._parent?.drawEffectCB}get mouse(){return this.cvs.mouse}get ratioPos(){return this._parent.ratioPos}get connections(){return this._connections}get parentSetupResults(){return this._parent?.setupResults}get top(){return this.y-this._radius*this._scale[1]}get bottom(){return this.y+this._radius*this._scale[1]}get right(){return this.x+this._radius*this._scale[0]}get left(){return this.x-this._radius*this._scale[0]}get width(){return 2*this._radius*this._scale[0]}get height(){return 2*this._radius*this._scale[1]}get x(){return super.x}get y(){return super.y}get pos(){return this._pos}get relativeX(){return super.relativeX}get relativeY(){return super.relativeY}get relativePos(){return super.relativePos}get radius(){return this._radius}get cachedPath(){return this._cachedPath}set x(e){e=t.round(e,T.POSITION_PRECISION),this._pos[0]!=e&&(this._pos[0]=e,this._cachedPath&&this.updateCachedPath())}set y(e){e=t.round(e,T.POSITION_PRECISION),this._pos[1]!=e&&(this._pos[1]=e,this._cachedPath&&this.updateCachedPath())}set pos(e){t.posEquals(e,this._pos)||(this.x=e[0],this.y=e[1],this._cachedPath&&this.updateCachedPath())}set relativeX(t){this.x=this.anchorPos[0]+t}set relativeY(t){this.y=this.anchorPos[1]+t}set relativePos(e){this.relativeX=t.round(e[0],T.POSITION_PRECISION),this.relativeY=t.round(e[1],T.POSITION_PRECISION)}set radius(e){e=t.round(e<0?0:e,I.RADIUS_PRECISION),this._radius!=e&&(this._radius=e,this._cachedPath&&this.updateCachedPath())}set limit(t){this._parent.limit=t}set connections(t){return this._connections=t}set cachedPath(t){this._cachedPath=t}}const f={MATERIALS:{AIR:0,SAND:1,WATER:2,STONE:4,GRAVEL:8,INVERTED_WATER:16,CONTAMINANT:32,LAVA:64,ELECTRICITY:128,COPPER:256},MATERIAL_GROUPS:{TRANSPIERCEABLE:null,LIQUIDS:null,CONTAMINABLE:null,MELTABLE:null,HAS_VISUAL_EFFECTS:null,DOWN_MAIN_CONTAINED_SKIPABLE:null,FOWARD_LOOP_CONTAINED_SKIPABLE:null},MATERIAL_NAMES:[],MATERIAL_STATES:{EMPTY:0,COPPER:{LIT:1,ORIGIN:2,DISABLED:4}},MATERIAL_STATES_GROUPS:{COPPER:{ACTIVATED:null,SOURCEABLE:null}},D:{b:1,r:2,l:4,br:8,bl:16,t:32,tr:64,tl:128},SIDE_PRIORITIES:{RANDOM:0,LEFT:1,RIGHT:2,MAP_DEPENDANT:3},SIDE_PRIORITY_NAMES:[],DEFAULT_BACK_STEP_SAVING_COUNT:500,EXPORT_STATES:{RAW:0,COMPACTED:1},EXPORT_SEPARATOR:"x",BRUSH_TYPES:{PIXEL:1,VERTICAL_CROSS:2,LINE3:4,ROW3:8,BIG_DOT:16,X3:32,X5:64,X15:128,X25:256,X55:512,X99:1024},BRUSH_TYPE_NAMES:[],BRUSH_GROUPS:{},BRUSHES_X_VALUES:[],WORKER_RELATIVE_PATH:new URL("./RemotePhysicsUnit.min.js",document?.currentScript?.src||"err://-1").href,WORKER_MESSAGE_TYPES:{INIT:0,STEP:1,START_LOOP:4,STOP_LOOP:8,SIDE_PRIORITY:16,MAP_SIZE:32,PIXELS:64},WORKER_MESSAGE_GROUPS:{GIVES_PIXELS_TO_MAIN:null,GIVES_PIXELS_TO_WORKER:null},PHYSICS_UNIT_TYPE:{LOCAL:0,WORKER:1},INITIALIZED_STATES:{NOT_INITIALIZED:0,READY:1,INITIALIZED:2},FILE_SERVED_WARN:"Web workers are disabled when serving with file:// protocol.\n  Serve this page over http(s):// to enable them.",STANDALONE_KEYBIND_WARN:"The keybind pressed is not linked to any function.",NOT_INITIALIZED_LOAD_WARN:"Tried loading with 'load()' while simulation is not yet initialized.\n Use the 'readyCB' callback to load a save on launch.",NOT_INITIALIZED_MAP_SIZE_WARN:"Tried updating map size with 'updateMapSize()' while simulation is not yet initialized.\n Use the 'readyCB' callback to update map size on launch.",NOT_INITIALIZED_PIXEL_SIZE_WARN:"Tried updating pixel size with 'updateMapPixelSize()' while simulation is not yet initialized.\n Use the 'readyCB' callback to update pixel size on launch.",NOT_INITIALIZED_PHYSICS_TYPE_WARN:"Tried updating physics unit type with 'updatePhysicsUnitType()' while simulation is not yet initialized.\n Use the 'readyCB' callback to update physics unit type on launch.",DEFAULT_WORLD_START_SETTINGS:{autoStart:!0,usesWebWorkers:!0,aimedFPS:60,zoom:null,cameraCenterPos:void 0,mapWidth:null,mapHeight:null,mapPixelSize:null},DEFAULT_USER_SETTINGS:{autoSimulationSizing:null,dragAndZoomCanvasEnabled:!0,minZoomThreshold:.1,maxZoomThreshold:Infinity,zoomInIncrement:.25,zoomOutIncrement:-.2,warningsDisabled:!1,showBorder:!0,showGrid:!0,smoothDrawingEnabled:!0,visualEffectsEnabled:!0},DEFAULT_COLOR_SETTINGS:{grid:[240,248,255,.2],border:[240,248,255,1],AIR:[0,0,0,0],SAND:[235,235,158,1],WATER:[0,15,242,.7],STONE:[100,100,100,1],GRAVEL:[188,188,188,1],INVERTED_WATER:[55,75,180,.75],CONTAMINANT:[30,95,65,.75],LAVA:[255,132,0,.88],ELECTRICITY:[255,235,0,.9],COPPER:[121,65,52,1]},DEFAULT_MAP_RESOLUTIONS:{HIGH:2,MEDIUM:10,SMALL:18,DEFAULT:10}};null===f.DEFAULT_USER_SETTINGS.autoSimulationSizing&&(f.DEFAULT_USER_SETTINGS.autoSimulationSizing=f.DEFAULT_MAP_RESOLUTIONS.DEFAULT),f.MATERIAL_GROUPS={TRANSPIERCEABLE:f.MATERIALS.WATER|f.MATERIALS.INVERTED_WATER|f.MATERIALS.AIR|f.MATERIALS.CONTAMINANT,LIQUIDS:f.MATERIALS.WATER|f.MATERIALS.INVERTED_WATER|f.MATERIALS.CONTAMINANT,CONTAMINABLE:f.MATERIALS.WATER|f.MATERIALS.INVERTED_WATER,MELTABLE:f.MATERIALS.SAND|f.MATERIALS.GRAVEL,HAS_VISUAL_EFFECTS:f.MATERIALS.ELECTRICITY|f.MATERIALS.COPPER,DOWN_MAIN_CONTAINED_SKIPABLE:f.MATERIALS.SAND|f.MATERIALS.WATER|f.MATERIALS.GRAVEL|f.MATERIALS.CONTAMINANT|f.MATERIALS.LAVA|f.MATERIALS.ELECTRICITY,FORWARDS_LOOP_CONTAINED_SKIPABLE:f.MATERIALS.INVERTED_WATER},f.MATERIAL_STATES_GROUPS={COPPER:{ACTIVATED:f.MATERIAL_STATES.COPPER.LIT|f.MATERIAL_STATES.COPPER.ORIGIN,SOURCEABLE:f.MATERIAL_STATES.COPPER.LIT|f.MATERIAL_STATES.COPPER.DISABLED}},f.WORKER_MESSAGE_GROUPS={GIVES_PIXELS_TO_MAIN:f.WORKER_MESSAGE_TYPES.STEP|f.WORKER_MESSAGE_TYPES.PIXELS,GIVES_PIXELS_TO_WORKER:f.WORKER_MESSAGE_TYPES.STEP|f.WORKER_MESSAGE_TYPES.PIXELS|f.WORKER_MESSAGE_TYPES.START_LOOP},f.BRUSH_GROUPS={SMALL_OPTIMIZED:f.BRUSH_TYPES.PIXEL|f.BRUSH_TYPES.VERTICAL_CROSS|f.BRUSH_TYPES.LINE3|f.BRUSH_TYPES.ROW3,X:f.BRUSH_TYPES.X3|f.BRUSH_TYPES.X5|f.BRUSH_TYPES.X15|f.BRUSH_TYPES.X25|f.BRUSH_TYPES.X55|f.BRUSH_TYPES.X99};const m=f.MATERIALS,D=Object.keys(m),L=D.length;for(let t=0,e=0;e<L;t=t?2*t:1,e++)f.MATERIAL_NAMES[t]=D[e];const N=f.BRUSH_TYPES,b=Object.keys(N),M=b.length;for(let t=1,e=0;e<M;t=t?2*t:1,e++)f.BRUSH_TYPE_NAMES[t]=b[e];f.SIDE_PRIORITY_NAMES=Object.keys(f.SIDE_PRIORITIES);const y=Object.keys(f.BRUSH_TYPES).filter(t=>t.startsWith("X")),U=y.length;for(let t=f.BRUSH_TYPES[y[0]],e=0;e<U;t=t?2*t:1,e++)f.BRUSHES_X_VALUES[t]=+y[e].slice(1);const F={MY_CUSTOM_SIZE_KEYBIND:{requiredKeys:[o.KEYS.CONTROL,o.KEYS.SHIFT],keys:[o.KEYS.G],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},STEP:{defaultFunction:"step",keys:[o.KEYS.ARROW_RIGHT],triggerType:o.TRIGGER_TYPES.MEDIUM_REPEATING},BACK_STEP:{defaultFunction:"backStep",keys:[o.KEYS.ARROW_LEFT],triggerType:o.TRIGGER_TYPES.MEDIUM_REPEATING},STEP_FAST:{defaultFunction:"step",keys:[o.KEYS.ARROW_UP],triggerType:o.TRIGGER_TYPES.FAST_REPEATING},BACK_STEP_FAST:{defaultFunction:"backStep",keys:[o.KEYS.ARROW_DOWN],triggerType:o.TRIGGER_TYPES.FAST_REPEATING},START:{defaultFunction:"start",keys:[o.KEYS.SPACE],triggerType:o.TRIGGER_TYPES.ONCE},STOP:{defaultFunction:"stop",defaultParams:["test"],keys:[o.KEYS.ESCAPE],triggerType:o.TRIGGER_TYPES.ONCE},CLEAR:{defaultFunction:"clear",requiredKeys:[o.KEYS.CONTROL],keys:[o.KEYS.BACKSPACE],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},DISABLE_WORKERS:{defaultFunction:"updatePhysicsUnitType",defaultParams:[!1],requiredKeys:[o.KEYS.CONTROL],keys:[o.KEYS.O],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},ENABLE_WORKERS:{defaultFunction:"updatePhysicsUnitType",defaultParams:[!0],requiredKeys:[o.KEYS.CONTROL],keys:[o.KEYS.P],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},SELECT_SAND:{defaultFunction:"updateSelectedMaterial",defaultParams:[f.MATERIALS.SAND],cancelKeys:[o.KEYS.CONTROL],keys:[o.KEYS.DIGIT_1,o.KEYS.NUMPAD_1],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},SELECT_WATER:{defaultFunction:"updateSelectedMaterial",defaultParams:[f.MATERIALS.WATER],cancelKeys:[o.KEYS.CONTROL],keys:[o.KEYS.DIGIT_2,o.KEYS.NUMPAD_2],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},SELECT_STONE:{defaultFunction:"updateSelectedMaterial",defaultParams:[f.MATERIALS.STONE],cancelKeys:[o.KEYS.CONTROL],keys:[o.KEYS.DIGIT_3,o.KEYS.NUMPAD_3],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},SELECT_GRAVEL:{defaultFunction:"updateSelectedMaterial",defaultParams:[f.MATERIALS.GRAVEL],cancelKeys:[o.KEYS.CONTROL],keys:[o.KEYS.DIGIT_4,o.KEYS.NUMPAD_4],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},SELECT_INVERTED_WATER:{defaultFunction:"updateSelectedMaterial",defaultParams:[f.MATERIALS.INVERTED_WATER],cancelKeys:[o.KEYS.CONTROL],keys:[o.KEYS.DIGIT_5,o.KEYS.NUMPAD_5],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},SELECT_CONTAMINANT:{defaultFunction:"updateSelectedMaterial",defaultParams:[f.MATERIALS.CONTAMINANT],cancelKeys:[o.KEYS.CONTROL],keys:[o.KEYS.DIGIT_6,o.KEYS.NUMPAD_6],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},SELECT_LAVA:{defaultFunction:"updateSelectedMaterial",defaultParams:[f.MATERIALS.LAVA],cancelKeys:[o.KEYS.CONTROL],keys:[o.KEYS.DIGIT_7,o.KEYS.NUMPAD_7],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},SELECT_ELECTRICITY:{defaultFunction:"updateSelectedMaterial",defaultParams:[f.MATERIALS.ELECTRICITY],cancelKeys:[o.KEYS.CONTROL],keys:[o.KEYS.DIGIT_8,o.KEYS.NUMPAD_8],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},SELECT_COPPER:{defaultFunction:"updateSelectedMaterial",defaultParams:[f.MATERIALS.COPPER],cancelKeys:[o.KEYS.CONTROL],keys:[o.KEYS.DIGIT_9,o.KEYS.NUMPAD_9],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},SELECT_AIR:{defaultFunction:"updateSelectedMaterial",defaultParams:[f.MATERIALS.AIR],cancelKeys:[o.KEYS.CONTROL],keys:[o.KEYS.DIGIT_0,o.KEYS.NUMPAD_0],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},BRUSH_PIXEL:{defaultFunction:"updateBrushType",defaultParams:[f.BRUSH_TYPES.PIXEL],requiredKeys:[o.KEYS.CONTROL],keys:[o.KEYS.DIGIT_1,o.KEYS.NUMPAD_1],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},BRUSH_VERTICAL_CROSS:{defaultFunction:"updateBrushType",defaultParams:[f.BRUSH_TYPES.VERTICAL_CROSS],requiredKeys:[o.KEYS.CONTROL],keys:[o.KEYS.DIGIT_2,o.KEYS.NUMPAD_2],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},BRUSH_X3:{defaultFunction:"updateBrushType",defaultParams:[f.BRUSH_TYPES.X3],requiredKeys:[o.KEYS.CONTROL],keys:[o.KEYS.DIGIT_3,o.KEYS.NUMPAD_3],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},BRUSH_BIG_DOT:{defaultFunction:"updateBrushType",defaultParams:[f.BRUSH_TYPES.BIG_DOT],requiredKeys:[o.KEYS.CONTROL],keys:[o.KEYS.DIGIT_4,o.KEYS.NUMPAD_4],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},BRUSH_X5:{defaultFunction:"updateBrushType",defaultParams:[f.BRUSH_TYPES.X5],requiredKeys:[o.KEYS.CONTROL],keys:[o.KEYS.DIGIT_5,o.KEYS.NUMPAD_5],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},BRUSH_X15:{defaultFunction:"updateBrushType",defaultParams:[f.BRUSH_TYPES.X15],requiredKeys:[o.KEYS.CONTROL],keys:[o.KEYS.DIGIT_6,o.KEYS.NUMPAD_6],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},BRUSH_X25:{defaultFunction:"updateBrushType",defaultParams:[f.BRUSH_TYPES.X25],requiredKeys:[o.KEYS.CONTROL],keys:[o.KEYS.DIGIT_7,o.KEYS.NUMPAD_7],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},BRUSH_X55:{defaultFunction:"updateBrushType",defaultParams:[f.BRUSH_TYPES.X55],requiredKeys:[o.KEYS.CONTROL],keys:[o.KEYS.DIGIT_8,o.KEYS.NUMPAD_9],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0},BRUSH_X99:{defaultFunction:"updateBrushType",defaultParams:[f.BRUSH_TYPES.X99],requiredKeys:[o.KEYS.CONTROL],keys:[o.KEYS.DIGIT_0,o.KEYS.NUMPAD_0],triggerType:o.TRIGGER_TYPES.ONCE,preventDefault:!0}};class v{constructor(){this._physicsCore=new B}step(t,e,i,s,r,n){const[a,o]=this._physicsCore.step(t,e,i,s,r,n,w.MATERIALS,w.MATERIAL_GROUPS,w.D,w.MATERIAL_STATES,w.MATERIAL_STATES_GROUPS,w.SIDE_PRIORITIES);t=a,i=o}}class B{static D={b:1,r:2,l:4,br:8,bl:16,t:32,tr:64,tl:128};static#bt=0;static#Mt=null;static#yt=65536;static#Ut=0;static#Ft={I:0,B:1,R:2,L:3,BR:4,BL:5,T:6,TR:7,TL:8};static#vt=B.D.bl<<1;static#Bt=new Uint8Array(B.#vt<<1);static#xt=B.D.bl<<1;static#wt=new Uint8Array(B.#xt<<1);static#Gt=B.D.tl<<1;static#Vt=new Uint8Array(B.#Gt<<1);static{const t=B.D,e=B.#yt,i=B.#Mt=new Float32Array(e);for(let t=0;t<e;t++)i[t]=Math.random();const s=B.#Bt,r=s.length;for(let e=0;e<r;e++)s[e]=B.#Ht(t,e);const n=B.#wt,a=n.length;for(let e=0;e<a;e++)n[e]=B.#Yt(t,e);const o=B.#Vt,h=o.length;for(let e=0;e<h;e++)o[e]=B.#kt(t,e)}step(t,e,i,s,r,n,a,o,h,l,_,u){function c(t){return!!C||!P&&(O?g[B.#Ut++&I]<.5:t%r<d)}const E=t.length-1,d=r>>1,T=a.AIR,S=a.STONE,A=o.LIQUIDS,R=o.MELTABLE,p=o.DOWN_MAIN_CONTAINED_SKIPABLE,g=B.#Mt,I=B.#yt-1,O=s===u.RANDOM,C=s===u.LEFT,P=s===u.RIGH,{B:f,R:m,L:D,BR:L,BL:N,T:b,TR:M,TL:y}=B.#Ft,U=B.#Bt,F=B.#vt,v=B.#wt,x=B.#xt,w=B.#Vt,G=B.#Gt;e.fill(0);for(let s=E;s>=0;s--){const u=t[s];if(u===T||e[s]||u===S)continue;const E=s%r,d=s/r|0,O=E>0,C=E<r-1,P=d>0,V=d<n-1,H=V?s+r:s,Y=P?s-r:s,k=O?s-1:s,z=C?s+1:s,W=t[H],K=t[z],X=t[k],Z=t[Y];if(u&p&&0===(W^u|K^u|X^u|Z^u))continue;const q=V&&O?s+r-1:s,j=V&&C?s+r+1:s,Q=P&&O?s-r-1:s,$=P&&C?s-r+1:s;let J=u,tt=-1,et=T;if(u===a.SAND){const e=W&o.TRANSPIERCEABLE,i=U[(W===T||0!==(W&o.TRANSPIERCEABLE))*h.b|(t[j]===T)*h.br|(t[q]===T)*h.bl|c(s)*F];i===f?tt=H:i===L?tt=j:i===N&&(tt=q),-1!==tt&&(X&A||K&A)&&(et=e)}else if(u===a.WATER){const e=v[(W===T)*h.b|(t[j]===T)*h.br|(t[q]===T)*h.bl|(K===T)*h.r|(X===T)*h.l|c(s)*x];e===f?tt=H:e===L?tt=j:e===N?tt=q:e===m?tt=z:e===D&&(tt=k)}else if(u===a.GRAVEL){const t=W&A;W!==T&&0===(W&o.TRANSPIERCEABLE)||(tt=H),t&&(X&A||K&A)&&(et=t)}else if(u===a.INVERTED_WATER){const e=w[(Z===T)*h.t|(t[$]===T)*h.tr|(t[Q]===T)*h.tl|(K===T)*h.r|(X===T)*h.l|c(s)*G];e===b?tt=Y:e===M?tt=$:e===y?tt=Q:e===m?tt=z:e===D&&(tt=k)}else if(u===a.CONTAMINANT){let i=v[(W===T)*h.b];const r=.5;i===f?tt=H:(i=v[(t[j]===T)*h.br|(t[q]===T)*h.bl|(K===T)*h.r|(X===T)*h.l|c(s)*x],i===L?tt=j:i===N?tt=q:i===m?tt=z:i===D&&(tt=k),X&o.CONTAMINABLE&&g[B.#Ut++&I]>r&&(t[k]=u,e[k]=1),K&o.CONTAMINABLE&&g[B.#Ut++&I]>r&&(t[z]=u,e[z]=1),W&o.CONTAMINABLE&&g[B.#Ut++&I]>r&&(t[H]=u,e[H]=1),Z&o.CONTAMINABLE&&g[B.#Ut++&I]>r&&(t[Y]=u,e[Y]=1))}else if(u===a.LAVA)if(X&A||K&A||Z&A||W&A)t[s]=a.STONE,e[s]=1;else{let i=v[(W===T)*h.b];const r=.935,n=.9992;i===f?tt=H:g[B.#Ut++&I]>r?(i=v[(t[j]===T)*h.br|(t[q]===T)*h.bl|(K===T)*h.r|(X===T)*h.l|c(s)*x],i===L?tt=j:i===N?tt=q:i===m?tt=z:i===D&&(tt=k)):(X&R||K&R||Z&R||W&R)&&g[B.#Ut++&I]>n&&(X&R?(t[k]=u,e[k]=1):K&R?(t[z]=u,e[z]=1):W&R?(t[H]=u,e[H]=1):Z&R&&(t[Y]=u,e[Y]=1))}else if(u===a.ELECTRICITY){const t=l.COPPER.ORIGIN;if(W===T)tt=H;else{let s,r,n,o,h=a.COPPER,l=_.COPPER.SOURCEABLE;W===h&&(0===(s=i[H])||s&l)&&(i[H]=t,e[H]=2),Z===h&&(0===(r=i[Y])||r&l)&&(i[Y]=t,e[Y]=2),K===h&&(0===(n=i[z])||n&l)&&(i[z]=t,e[z]=2),X===h&&(0===(o=i[k])||o&l)&&(i[k]=t,e[k]=2)}}else if(u===a.COPPER){const t=i[s],r=_.COPPER.ACTIVATED,n=l.COPPER.ORIGIN,o=a.ELECTRICITY;t===n?W!==o&&Z!==o&&K!==o&&X!==o&&(i[s]=l.COPPER.DISABLED,e[s]=2):t?t===l.COPPER.LIT?(W===u&&i[H]===l.COPPER.DISABLED&&(i[s]=l.COPPER.DISABLED,e[s]=2,e[Y]=2,e[H]=2,e[z]=2,e[k]=2),Z===u&&i[Y]===l.COPPER.DISABLED&&(i[s]=l.COPPER.DISABLED,e[s]=2,e[Y]=2,e[H]=2,e[z]=2,e[k]=2),K===u&&i[z]===l.COPPER.DISABLED&&(i[s]=l.COPPER.DISABLED,e[s]=2,e[Y]=2,e[H]=2,e[z]=2,e[k]=2),X===u&&i[k]===l.COPPER.DISABLED&&(i[s]=l.COPPER.DISABLED,e[s]=2,e[Y]=2,e[H]=2,e[z]=2,e[k]=2)):t===l.COPPER.DISABLED&&((W!==u||i[H]!==n&&i[H])&&(Z!==u||i[Y]!==n&&i[Y])&&(K!==u||i[z]!==n&&i[z])&&(X!==u||i[k]!==n&&i[k])||(i[s]=0)):(W===u&&i[H]&r&&(i[s]=l.COPPER.LIT,e[s]=2,e[Y]=2,e[z]=2,e[k]=2),Z===u&&i[Y]&r&&(i[s]=l.COPPER.LIT,e[s]=2,e[H]=2,e[z]=2,e[k]=2),K===u&&i[z]&r&&(i[s]=l.COPPER.LIT,e[s]=2,e[Y]=2,e[H]=2,e[k]=2),X===u&&i[k]&r&&(i[s]=l.COPPER.LIT,e[s]=2,e[Y]=2,e[H]=2,e[z]=2))}-1!==tt&&(e[tt]=1,t[tt]=J,t[s]=et)}return[t,i]}static#Ht(t,e){const i=e&B.#vt,s=B.#Ft,r=e&t.b,n=e&t.br,a=e&t.bl;if(r)return s.B;if(i){if(a)return s.BL;if(n)return s.BR}else{if(n)return s.BR;if(a)return s.BL}return s.I}static#Yt(t,e){const i=e&B.#xt,s=B.#Ft,r=e&t.b,n=e&t.r,a=e&t.l,o=e&t.br,h=e&t.bl;if(r)return s.B;if(i){if(h)return s.BL;if(o)return s.BR;if(a)return s.L;if(n)return s.R}else{if(o)return s.BR;if(h)return s.BL;if(n)return s.R;if(a)return s.L}return s.I}static#kt(t,e){const i=e&B.#Gt,s=B.#Ft,r=e&t.t,n=e&t.r,a=e&t.l,o=e&t.tr,h=e&t.tl;if(r)return s.T;if(i){if(h)return s.TL;if(o)return s.TR;if(a)return s.L;if(n)return s.R}else{if(o)return s.TR;if(h)return s.TL;if(n)return s.R;if(a)return s.L}return s.I}}class x{static DEFAULT_PIXEL_SIZE=18;static DEFAULT_MAP_WIDTH=50;static DEFAULT_MAP_HEIGHT=35;#zt=null;constructor(t,e,i){this._pixelSize=this.#zt=t||x.DEFAULT_PIXEL_SIZE,this._mapWidth=e||x.DEFAULT_MAP_WIDTH,this._mapHeight=i||x.DEFAULT_MAP_HEIGHT}getLocalMapPixel(t){const e=this._pixelSize,[i,s]=this.globalDimensions,[r,n]=t;for(let t=0;t<s;t+=e)for(let s=0;s<i;s+=e)if(r>=s&&r<s+e&&n>=t&&n<t+e)return[s/e,t/e]}getAdjacency(t,e,i=1){const s=w.D,r=this._mapWidth,n=r*i,a=t%r,o=t/r|0,h=a>=i,l=a+i<r,_=o>=i,u=o+i<this._mapHeight;return e===s.b?u?t+n:t:e===s.t?_?t-n:t:e===s.l?h?t-i:t:e===s.r?l?t+i:t:e===s.bl?u&&h?t+n-i:t:e===s.br?u&&l?t+n+i:t:e===s.tl?_&&h?t-n-i:t:e===s.tr?_&&l?t-n+i:t:void 0}getDrawableGridLines(){const t=this._pixelSize,[e,i]=this.globalDimensions,s=[];for(let r=0;r<e;r+=t)s.push(l.getLine([r,0],[r,i]));for(let r=0;r<i;r+=t)s.push(l.getLine([0,r],[e,r]));return s}indexToMapPos(t){const e=this._mapWidth;return[t%e,t/e|0]}mapPosToIndex(t){return t[1]*this._mapWidth+t[0]}mapPosToIndexCoords(t,e){return e*this._mapWidth+t}getCenter(t){const e=this._mapWidth>>1,i=this._mapHeight>>1;return t?[e*this._pixelSize,i*this._pixelSize]:[e,i]}get globalWidth(){return this._mapWidth*this._pixelSize}get globalHeight(){return this._mapHeight*this._pixelSize}get globalDimensions(){return[this.globalWidth,this.globalHeight]}get arraySize(){return this._mapWidth*this._mapHeight}get displayDimensions(){return this._mapWidth+"x"+this._mapHeight}get lastPixelSize(){return this.#zt}get pixelSize(){return this._pixelSize}get mapWidth(){return this._mapWidth}get mapHeight(){return this._mapHeight}get dimensions(){return[this._mapWidth,this._mapHeight]}set pixelSize(t){return this._pixelSize=t}set mapWidth(t){return this._mapWidth=t}set mapHeight(t){return this._mapHeight=t}set lastPixelSize(t){return this.#zt=t}}class w{static MATERIALS=f.MATERIALS;static MATERIAL_GROUPS=f.MATERIAL_GROUPS;static MATERIAL_NAMES=f.MATERIAL_NAMES;static MATERIAL_STATES=f.MATERIAL_STATES;static MATERIAL_STATES_GROUPS=f.MATERIAL_STATES_GROUPS;static D=f.D;static SIDE_PRIORITIES=f.SIDE_PRIORITIES;static SIDE_PRIORITY_NAMES=f.SIDE_PRIORITY_NAMES;static EXPORT_STATES=f.EXPORT_STATES;static EXPORT_SEPARATOR=f.EXPORT_SEPARATOR;static BRUSH_TYPES=f.BRUSH_TYPES;static BRUSH_TYPE_NAMES=f.BRUSH_TYPE_NAMES;static#Wt=f.BRUSHES_X_VALUES;static#Kt=f.BRUSH_GROUPS;static WORKER_RELATIVE_PATH=f.WORKER_RELATIVE_PATH;static#Xt=f.WORKER_MESSAGE_TYPES;static#Zt=f.WORKER_MESSAGE_GROUPS;static PHYSICS_UNIT_TYPE=f.PHYSICS_UNIT_TYPE;static#qt=f.INITIALIZED_STATES;static#jt=[];static#Qt=null;static#$t=null;static DEFAULT_WORLD_START_SETTINGS=f.DEFAULT_WORLD_START_SETTINGS;static DEFAULT_USER_SETTINGS=f.DEFAULT_USER_SETTINGS;static DEFAULT_COLOR_SETTINGS=f.DEFAULT_COLOR_SETTINGS;static DEFAULT_MATERIAL=w.MATERIALS.SAND;static DEFAULT_BRUSH_TYPE=w.BRUSH_TYPES.PIXEL;static DEFAULT_BACK_STEP_SAVING_COUNT=f.DEFAULT_BACK_STEP_SAVING_COUNT;static DEFAULT_MAP_RESOLUTIONS=f.DEFAULT_MAP_RESOLUTIONS;static DEFAULT_KEYBINDS=F;#Jt=!0;#te=null;constructor(e,i,s,r,n){this._CVS=e instanceof E?e:new E(e),this._worldStartSettings=this.getAdjustedSettings(s,w.DEFAULT_WORLD_START_SETTINGS),this._CVS.fpsLimit=this._worldStartSettings.aimedFPS,this._initialized=this._worldStartSettings.autoStart?w.#qt.NOT_INITIALIZED:w.#qt.INITIALIZED,this._mapGrid=new x(this._worldStartSettings.mapPixelSize,this._worldStartSettings.mapWidth,this._worldStartSettings.mapHeight),this._pixels=new Uint16Array(this._mapGrid.arraySize),this._lastPixels=new Uint16Array(this._mapGrid.arraySize),this._pxStepUpdated=new Uint8Array(this._mapGrid.arraySize),this._pxStates=new Uint8Array(this._mapGrid.arraySize),this._backStepSavingMaxCount=w.DEFAULT_BACK_STEP_SAVING_COUNT,this._backStepSaves=[],this._isMouseWithinSimulation=!0,this._isRunning=!1,this._selectedMaterial=w.MATERIALS.SAND,this._sidePriority=w.SIDE_PRIORITIES.RANDOM,this._lastStepTime=null,this._queuedBufferOperations=[],this.updatePhysicsUnitType(this._worldStartSettings.usesWebWorkers),this._userSettings=this.getAdjustedSettings(r,w.DEFAULT_USER_SETTINGS),this._colorSettings=this.getAdjustedSettings(n,w.DEFAULT_COLOR_SETTINGS),this._brushType=w.BRUSH_TYPES.PIXEL,this._mapGridRenderStyles=this._CVS.render.profile1.update(this._colorSettings.grid,null,null,null,1),this._mapBorderRenderStyles=this._CVS.render.profile2.update(this._colorSettings.border,null,null,null,2),this._imgMap=this._CVS.ctx.createImageData(...this._mapGrid.globalDimensions),this._offscreenCanvas=new OffscreenCanvas(...this._mapGrid.globalDimensions),this._offscreenCtx=this._offscreenCanvas.getContext("2d"),this._loopExtra=null,this._stepExtra=null,this.#ee(),this.#ie(),this.#se(),this.setKeyBinds();const a=this._worldStartSettings.cameraCenterPos;void 0!==a&&this._CVS.centerViewAt(a||this._mapGrid.getCenter(!0)),this._worldStartSettings.zoom&&this._CVS.zoomAtPos(this._CVS.getCenter(),this._worldStartSettings.zoom),this._CVS.loopingCB=this.#re.bind(this),this._CVS.setMouseMove(),this._CVS.setMouseLeave(),this._CVS.setMouseDown(this.#ne.bind(this)),this._CVS.setMouseUp(this.#ae.bind(this)),this._CVS.setKeyUp(null,!0),this._CVS.setKeyDown(null,!0),this._CVS.onResizeCB=()=>{const t=this.autoSimulationSizing;t&&this.autoFitSize(t)},this._CVS.start(),this._mouseListenerIds=[this._CVS.mouse.addListener([[0,0],this._mapGrid.globalDimensions],h.LISTENER_TYPES.ENTER,()=>this._isMouseWithinSimulation=!0),this._CVS.mouse.addListener([[0,0],this._mapGrid.globalDimensions],h.LISTENER_TYPES.MOVE,()=>this._isMouseWithinSimulation=!0),this._CVS.mouse.addListener([[0,0],this._mapGrid.globalDimensions],h.LISTENER_TYPES.LEAVE,()=>this.#oe())],this._initialized=w.#qt.READY,this.autoSimulationSizing&&this.autoFitSize(this.autoSimulationSizing),t.isFunction(i)&&i(this),this._initialized=w.#qt.NOT_INITIALIZED,this._worldStartSettings.autoStart&&this.start()}#re(t){const e=this.mouse,i=this._userSettings,s=this._loopExtra;s&&s(t),e.clicked&&!this.keyboard.isDown(o.KEYS.SHIFT)&&this.#he(e),i.showGrid&&this.#le(),i.showBorder&&this.#_e(),this._isRunning&&this.useLocalPhysics&&this.step(),this._offscreenCtx.putImageData(this._imgMap,0,0),this.ctx.drawImage(this._offscreenCanvas,0,0),i.visualEffectsEnabled&&this.#ue()}#ue(){if(!this.#Jt)return void this._queuedBufferOperations.push(()=>this.#ue());const t=this._pixels,e=t.length,i=this._pxStates,s=this._mapGrid,r=w.MATERIALS,n=w.MATERIAL_GROUPS,a=(w.MATERIAL_STATES_GROUPS,w.D,s.mapWidth),o=s.pixelSize,h=o/4,_=Math.random(),u=(this.render.batchStroke.bind(this.render),this.render.batchFill.bind(this.render));for(let s=0;s<e;s++){const e=t[s];if(0===(e&n.HAS_VISUAL_EFFECTS))continue;const c=s/a|0,E=(s-c*a)*o,d=c*o,T=i[s];e===r.ELECTRICITY?u(l.getPositionsRect([E-h,d-h],[E+o+h,d+o+h]),[255,235,0,.45*_]):e===r.COPPER&&T===w.MATERIAL_STATES.COPPER.LIT?u(l.getPositionsRect([E-h,d-h],[E+o+h,d+o+h]),[255,235,0,.35*_]):e===r.COPPER&&T===w.MATERIAL_STATES.COPPER.ORIGIN?u(l.getPositionsRect([E-h,d-h],[E+o+h,d+o+h]),[255,235,220,.4]):e===r.COPPER&&T===w.MATERIAL_STATES.COPPER.DISABLED&&u(l.getPositionsRect([E-h,d-h],[E+o+h,d+o+h]),[0,0,220,.3])}}#le(){const t=w.#Qt,e=t.length,i=this.render.batchStroke.bind(this.render),s=this._mapGridRenderStyles;for(let r=0;r<e;r++)i(t[r],s)}#_e(){this.render.batchStroke(w.#$t,this._mapBorderRenderStyles)}updateImgMapFromPixels(t){if(!this.#Jt)return void this._queuedBufferOperations.push(()=>this.updateImgMapFromPixels(t));const e=this._pixels,i=this._lastPixels,s=e.length,r=this._mapGrid,n=!t&&i.length===s&&r.lastPixelSize===r.pixelSize,a=r.mapWidth;for(let t=0;t<s;t++){const s=e[t];if(n&&s===i[t])continue;const r=t/a|0;this.#ce(t-r*a,r,s)}n||(r.lastPixelSize=r.pixelSize),this._lastPixels=this.#Ee()}#ce(t,e,i){const s=this._imgMap.data,r=this._mapGrid.pixelSize,n=this._imgMap.width,a=t*r,o=e*r,h=w.#jt[i];for(let t=0;t<r;t++)s.set(h,4*((o+t)*n+a))}step(){const t=w.#Xt,e=this._physicsUnit;if(this.useLocalPhysics&&this.#Jt){const t=this._stepExtra;this.saveStep(),t&&t(),e.step(this._pixels,this._pxStepUpdated,this._pxStates,this._sidePriority,this._mapGrid.mapWidth,this._mapGrid.mapHeight),this.updateImgMapFromPixels()}else this.#Jt&&this.#de(t.STEP)}backStep(){if(!this.#Jt)return void this._queuedBufferOperations.push(()=>this.backStep());const t=this._backStepSaves,e=t.length;if(e){let i=t[e-1];const s=i[0],r=s.length,n=this.#Ee();let a=r!==n.length;for(let t=0;t<r;t++)if(s[t]!==n[t]){a=!0;break}a||(i=t[e-2]),i&&this.load(i[0],i[1]),t.pop()}}saveStep(){if(this.backStepSavingEnabled){const t=this._backStepSaves,e=t.length,i=t[e-1]?.[0],s=i?.length,r=this.#Ee();if(i){let t=s!==r.length;for(let e=0;e<s;e++)if(i[e]!==r[e]){t=!0;break}if(!t)return}t.push([r,this._mapGrid.dimensions]),e+1>this._backStepSavingMaxCount&&t.shift()}}start(t){this._initialized!==w.#qt.INITIALIZED&&setTimeout(()=>this._initialized=w.#qt.INITIALIZED),this._isRunning&&!t||(this._isRunning=!0,this.usesWebWorkers&&this.#de(w.#Xt.START_LOOP))}stop(){this._isRunning&&(this._isRunning=!1,this.usesWebWorkers&&this._physicsUnit.postMessage({type:w.#Xt.STOP_LOOP}))}updatePhysicsUnitType(t=!0){if(this.#Te(f.NOT_INITIALIZED_PHYSICS_TYPE_WARN))return;const e=t&&!this.isFileServed;e&&this.usesWebWorkers||!e&&this.useLocalPhysics||(this._physicsUnit=e?new Worker(w.WORKER_RELATIVE_PATH,{type:"classic"}):new v,e?(this.#Jt=!0,this._physicsUnit.onmessage=this.#Se.bind(this),this._physicsUnit.postMessage({type:w.#Xt.INIT,pixels:this._pixels,pxStepUpdated:this._pxStepUpdated,pxStates:this._pxStates,sidePriority:this._sidePriority,mapWidth:this._mapGrid.mapWidth,mapHeight:this._mapGrid.mapHeight,aimedFps:this._CVS.fpsLimit}),this._isRunning&&this.start(!0)):t&&this.isFileServed&&this.#Ae(f.FILE_SERVED_WARN))}autoFitSize(t=w.DEFAULT_MAP_RESOLUTIONS.DEFAULT,e=this._CVS.width,i=this._CVS.height){!0!==t&&null!==t||(t=w.DEFAULT_MAP_RESOLUTIONS.DEFAULT);const s=e/t|0,r=i/t|0;return this.updateMapPixelSize(t),this.updateMapSize(s,r),[s,r]}updateMapPixelSize(t=x.DEFAULT_PIXEL_SIZE){if(this.#Te(f.NOT_INITIALIZED_PIXEL_SIZE_WARN))return;if(!this.#Jt)return void this._queuedBufferOperations.push(()=>this.updateMapPixelSize(t));const e=this._mapGrid;t!==e.pixelSize&&(e.pixelSize=t,this._imgMap=this.ctx.createImageData(...e.globalDimensions),this._offscreenCanvas.width=e.globalDimensions[0],this._offscreenCanvas.height=e.globalDimensions[1],this.#ie(),this.#ee(),this.updateImgMapFromPixels(),this.#Re())}updateMapSize(t,e){if(this.#Te(f.NOT_INITIALIZED_MAP_SIZE_WARN))return;if(!this.#Jt)return void this._queuedBufferOperations.push(()=>this.updateMapSize(t,e));const i=this._mapGrid,s=i.mapWidth,r=i.mapHeight;if(t&&t!==s||e&&e!==r){const n=this.#Ee();e=i.mapHeight=e||i.mapHeight,t=i.mapWidth=t||i.mapWidth,this.#pe(s,r,t,e,n),this.#ee(),this._imgMap=this.ctx.createImageData(...i.globalDimensions),this._offscreenCanvas.width=i.globalDimensions[0],this._offscreenCanvas.height=i.globalDimensions[1],this.updateImgMapFromPixels(),this.#Re()}}updateSidePriority(t){return this.usesWebWorkers&&this._physicsUnit.postMessage({type:w.#Xt.SIDE_PRIORITY,sidePriority:t}),this._sidePriority=t}getPixelAtMapPos(t){const e=this._mapGrid.mapPosToIndex(t);return this.usesWebWorkers?this._lastPixels[e]:this._pixels[e]}updateSelectedMaterial(t){return t=+t,w.MATERIAL_NAMES[t]?this._selectedMaterial=t:this._selectedMaterial}updateBrushType(t){return t=+t,Object.values(w.BRUSH_TYPES).includes(t)?this._brushType=t:this._brushType}updateColors(t){this._colorSettings=this.getAdjustedSettings(t,this._colorSettings),t.grid&&this._mapGridRenderStyles.update(this._colorSettings.grid),t.border&&this._mapBorderRenderStyles.update(this._colorSettings.border),this.#ie(),this.updateImgMapFromPixels(!0)}#pe(t,e,i,s,r){const n=this._mapGrid.arraySize,a=this._pixels=new Uint16Array(n),o=i-t,h=t<i?t:i,l=e<s?e:s;this._pxStepUpdated=new Uint8Array(n),this._pxStates=new Uint8Array(n),this.usesWebWorkers&&this._physicsUnit.postMessage({type:w.#Xt.MAP_SIZE,mapWidth:this._mapGrid.mapWidth,mapHeight:this._mapGrid.mapHeight,arraySize:n});for(let e=0,i=0,s=0;e<l;e++)a.set(r.subarray(s,s+h),i),s+=t,i+=t+o}getAdjustedSettings(t,e){const i={...e};return t&&Object.entries(t).forEach(([t,e])=>i[t]=e),i}#Te(t){if(this._userSettings&&this._initialized===w.#qt.NOT_INITIALIZED)return this.#Ae(t),!0}#Ae(t){this.warningsDisabled||console.warn(t)}#Se(t){const e=t.data,i=e.type,s=w.#Xt,r=this._stepExtra;i&w.#Zt.GIVES_PIXELS_TO_MAIN&&(this._pixels=new Uint16Array(e.pixels),this._pxStates=new Uint16Array(e.pxStates),this.#Jt=!0),i===s.STEP&&(this.updateImgMapFromPixels(),this.#ge(),r&&r(),this._isRunning&&(this.#Jt=!1,this.#de(s.PIXELS)))}#de(t){const e=this._pixels,i=this._pxStates;this.saveStep(),this.usesWebWorkers?this._physicsUnit.postMessage({type:t,pixels:e,pxStates:i},[e.buffer,i.buffer]):this.#Jt=!0}#ge(){const t=this._queuedBufferOperations,e=t.length;for(let i=0;i<e;i++)t[0](),t.shift()}#ie(){const t=Object.entries(this._colorSettings).filter(t=>t[0].toUpperCase()===t[0]).map(t=>t[1]),e=t.length,i=4*this._mapGrid.pixelSize,s=w.#jt;for(let r=0,n=0;n<e;r=r?2*r:1,n++){const e=new Uint8ClampedArray(i),[a,o,h,l]=t[n],_=255*l;for(let t=0;t<i;t++){const i=4*t;e[i]=a,e[i+1]=o,e[i+2]=h,e[i+3]=_}s[r]=e}}#ee(){w.#Qt=this._mapGrid.getDrawableGridLines(),w.#$t=l.getRect([0,0],...this._mapGrid.globalDimensions)}#Re(){const t=this.mouse,e=this._mapGrid.globalDimensions;t.updateListener(h.LISTENER_TYPES.ENTER,this._mouseListenerIds[0],[[0,0],e]),t.updateListener(h.LISTENER_TYPES.MOVE,this._mouseListenerIds[1],[[0,0],e]),t.updateListener(h.LISTENER_TYPES.LEAVE,this._mouseListenerIds[2],[[0,0],e])}setKeyBinds(t=w.DEFAULT_KEYBINDS){const e=this._CVS.typingDevice,i=o.LISTENER_TYPES.DOWN;Object.entries(t).filter(t=>t[1].defaultFunction).forEach(([t,s])=>{const{defaultFunction:r,defaultParams:n,keys:a,triggerType:o}=s;e.addListener(i,a,(t,e)=>this.#Ie(t,e,()=>this[r](...n||[]),s),o)}),t.MY_CUSTOM_SIZE_KEYBIND&&e.addListener(i,t.MY_CUSTOM_SIZE_KEYBIND.keys,(e,i)=>this.#Ie(e,i,()=>{this.updateMapSize(48,38),this.updateMapPixelSize(18)},t.MY_CUSTOM_SIZE_KEYBIND),t.MY_CUSTOM_SIZE_KEYBIND.triggerType)}#Ie(e,i,s,r){const n=t.isFunction(s),{requiredKeys:a,cancelKeys:o,preventDefault:h}=r;h&&void 0===i.target.value&&i.preventDefault(),n?a&&!e.isDown(a)||o&&e.isDown(o)||s.bind(this)():this.#Ae(f.STANDALONE_KEYBIND_WARN)}#ne(t){t.rightClicked||this.#he(t)}#ae(){this.#te=null}#oe(){this.#te=null,this._isMouseWithinSimulation=!1}#he(t){const e=this._mapGrid.getLocalMapPixel(t.pos);if(this._isMouseWithinSimulation&&e){const t=this._isRunning,[i,s]=e,[r,n]=this.#te||e,a=i-r,o=s-n,h=Math.max(Math.abs(a),Math.abs(o));if(this.smoothDrawingEnabled&&h)for(let t=0;t<h;t++){const e=(t+1)/h;this.placePixelsWithBrush(r+a*e|0,n+o*e|0)}else this.placePixelsWithBrush(i,s);this.#te=e,t||this.updateImgMapFromPixels()}}#Oe(t,e){const i=this._CVS.zoom+(e<0?this.zoomInIncrement:this.zoomOutIncrement);return i>this.minZoomThreshold&&i<this.maxZoomThreshold&&(this._CVS.zoomAtPos(t,i),t)}#se(){const t=this._CVS;if(E.preventNativeZoom((e,i)=>{this.dragAndZoomCanvasEnabled&&!i&&this.#Oe(t.getCenter(),e)}),this.dragAndZoomCanvasEnabled){const e=t.frame,i=t.mouse;let s=!1,r=[0,0];return e.addEventListener("wheel",t=>{this.dragAndZoomCanvasEnabled&&this.#Oe(i.rawPos,t.deltaY)&&(r=[...i.rawPos])}),e.addEventListener("mousedown",e=>{this.dragAndZoomCanvasEnabled&&(e.button===h.BUTTON_TYPES.RIGHT?(s=!0,r=[e.clientX,e.clientY]):e.button===h.BUTTON_TYPES.MIDDLE&&t.resetTransformations(!0))}),e.addEventListener("mousemove",e=>{if(this.dragAndZoomCanvasEnabled&&s){const{clientX:i,clientY:s}=e,[n,a]=t.viewPos,o=i-r[0],h=s-r[1];t.moveViewAt([n+o,a+h]),r=[i,s]}}),e.addEventListener("mouseup",t=>{s&&t.button===h.BUTTON_TYPES.RIGHT&&(s=!1)}),e.addEventListener("contextmenu",t=>t.preventDefault()),!0}return!1}placePixel(t,e=this._selectedMaterial){if(!this.#Jt)return void this._queuedBufferOperations.push(()=>this.placePixel(t,e));const i=this._mapGrid.mapPosToIndex(t);this._pixels[i]=e,this._pxStates[i]=0}placePixelAtCoords(t,e,i=this._selectedMaterial){if(!this.#Jt)return void this._queuedBufferOperations.push(()=>this.placePixelAtCoords(t,e,i));const s=this._mapGrid.mapPosToIndexCoords(t,e);this._pixels[s]=i,this._pxStates[s]=0}placePixelAtIndex(t,e=this._selectedMaterial){this.#Jt?(this._pixels[t]=e,this._pxStates[t]=0):this._queuedBufferOperations.push(()=>this.placePixelAtIndex(t,e))}placePixelsWithBrush(t,e,i=this._brushType){const s=w.BRUSH_TYPES;if(i&w.#Kt.SMALL_OPTIMIZED)i!==s.LINE3&&i!==s.VERTICAL_CROSS||this.fillArea([t,e-1],[t,e+1]),i!==s.ROW3&&i!==s.VERTICAL_CROSS||(t&&this.placePixelAtCoords(t-1,e),t!==this._mapGrid.mapWidth-1&&this.placePixelAtCoords(t+1,e)),this.placePixelAtCoords(t,e);else if(i===s.BIG_DOT)t-2>=0&&this.placePixelAtCoords(t-2,e),t+2<this._mapGrid.mapWidth&&this.placePixelAtCoords(t+2,e),this.placePixelAtCoords(t,e-2),this.placePixelAtCoords(t,e+2),this.fillArea([t-1,e-1],[t+1,e+1]);else if(i&w.#Kt.X){const s=w.#Wt[i]/2|0;this.fillArea([t-s,e-s],[t+s,e+s])}}clear(){this.fill(w.MATERIALS.AIR)}fill(t=this._selectedMaterial){if(!this.#Jt)return void this._queuedBufferOperations.push(()=>this.fill(t));const e=this._pixels,i=this._lastPixels,s=e.length;i.set(new Uint16Array(s).subarray(0,i.length).fill(t+1)),e.set(new Uint16Array(s).fill(t)),this._isRunning||this.updateImgMapFromPixels()}fillArea(t,e,i=this._selectedMaterial){if(!this.#Jt)return void this._queuedBufferOperations.push(()=>this.fillArea(t,e,i));const s=this._pixels.length,r=this._mapGrid,n=r.mapWidth,a=t[0]<0?0:t[0],o=t[1]<0?0:t[1],h=e[0]<0?0:e[0],l=e[1]<0?0:e[1];for(let t=r.mapPosToIndex([a,o]);t<s;t++){let e=t/n|0,s=t-e*n,r=s>h,_=e>l,u=s<a,c=e<o;if(r&&!_&&(t+=n-(h-a+2)+1,e=t/n|0,s=t-e*n,r=s>h,_=e>l,u=s<a,c=e<o),u&&(t+=a,s=t-e*n,r=s>h,u=s<a),_)break;this.placePixelAtIndex(t,i)}this._isRunning||this.updateImgMapFromPixels()}#Ee(){const t=this._mapGrid.arraySize,e=new Uint16Array(t);return e.set(this._pixels.subarray(0,t)),e}load(t,e=null){if(!this.#Te(f.NOT_INITIALIZED_LOAD_WARN))if(this.#Jt){if(t){if(t instanceof Uint16Array)this.#pe(e[0],e[1],this._mapGrid.mapWidth,this._mapGrid.mapHeight,t);else if("string"==typeof t){const[i,s,r]=t.split(w.EXPORT_SEPARATOR),n=r.split(","),[a,o,h]=s.split(",").map(t=>+t);let l=null;if(e&&(this.updateMapSize(a,o),this.updateMapPixelSize(h)),i==w.EXPORT_STATES.RAW)l=new Uint16Array(n);else if(i==w.EXPORT_STATES.COMPACTED){let t=n.length,e=0;l=new Uint16Array(a*o);for(let i=0;i<t;i+=2){const t=n[i+1];l.set(new Uint16Array(t).fill(n[i]),e),e+=+t}}this.#pe(a,o,this._mapGrid.mapWidth,this._mapGrid.mapHeight,l)}else this._pixels=new Uint16Array(Object.values(t));this.updateImgMapFromPixels()}}else this._queuedBufferOperations.push(()=>this.load(t,e))}exportAsText(t,e){if(!this.#Jt)return void this._queuedBufferOperations.push(()=>e&&e(this.exportAsText(t)));let i=this._pixels,s=i.length,r=w.EXPORT_STATES.COMPACTED,n="";if(t)r=w.EXPORT_STATES.RAW,n+=i.toString();else{let t,e=-1;n=[];for(let r=0;r<s;r++){const s=i[r];t===s?n[e][1]++:n[++e]=[s,1],t=s}n=n.toString()}return r+w.EXPORT_SEPARATOR+this._mapGrid.dimensions+","+this._mapGrid.pixelSize+w.EXPORT_SEPARATOR+n}PERF_TEST_FUN(){this.updateMapPixelSize(2),this.updateMapSize(400,300),this.fill(w.MATERIALS.AIR)}PERF_TEST_FULL_WATER_REG(){this._userSettings.showGrid=!1,this.updateMapPixelSize(1),this.updateMapSize(700,600),this.fill(w.MATERIALS.WATER)}PERF_TEST_FULL_WATER_HIGH(){this._userSettings.showGrid=!1,this.updateMapPixelSize(1),this.updateMapSize(1e3,1e3),this.fill(w.MATERIALS.WATER)}get CVS(){return this._CVS}get render(){return this._CVS._render}get ctx(){return this._CVS._ctx}get mouse(){return this._CVS.mouse}get keyboard(){return this._CVS.keyboard}get mapGrid(){return this._mapGrid}get loopExtra(){return this._loopExtra}get stepExtra(){return this._stepExtra}get pxStepUpdated(){return this._pxStepUpdated}get pxStates(){return this._pxStates}get lastPixels(){return this._lastPixels}get lastStepTime(){return this._lastStepTime}get pixels(){return this._pixels}get mapGridRenderStyles(){return this._mapGridRenderStyles}get mapBorderRenderStyles(){return this._mapBorderRenderStyles}get offscreenCanvas(){return this._offscreenCanvas}get imgMap(){return this._imgMap}get isMouseWithinSimulation(){return this._isMouseWithinSimulation}get selectedMaterial(){return this._selectedMaterial}get sidePriority(){return this._sidePriority}get isRunning(){return this._isRunning}get backStepSavingMaxCount(){return this._backStepSavingMaxCount}get backStepSaves(){return this._backStepSaves}get brushType(){return this._brushType}get worldStartSettings(){return this._worldStartSettings}get userSettings(){return this._userSettings}get colorSettings(){return this._colorSettings}get initialized(){return this._initialized}get queuedBufferOperations(){return this._queuedBufferOperations}get aimedFPS(){return this._CVS.fpsLimit}get backStepSavingEnabled(){return Boolean(this._backStepSavingMaxCount)}get useLocalPhysics(){return this._physicsUnit instanceof v}get usesWebWorkers(){return Boolean(this._physicsUnit)&&!(this._physicsUnit instanceof v)}get isFileServed(){return location.href.startsWith("file")}get showGrid(){return this._userSettings.showGrid}get showBorder(){return this._userSettings.showBorder}get smoothDrawingEnabled(){return this._userSettings.smoothDrawingEnabled}get visualEffectsEnabled(){return this._userSettings.visualEffectsEnabled}get warningsDisabled(){return this._userSettings.warningsDisabled}get dragAndZoomCanvasEnabled(){return this._userSettings.dragAndZoomCanvasEnabled}get autoSimulationSizing(){return this._userSettings.autoSimulationSizing}get zoomInIncrement(){return this._userSettings.zoomInIncrement}get zoomOutIncrement(){return this._userSettings.zoomOutIncrement}get minZoomThreshold(){return this._userSettings.minZoomThreshold}get maxZoomThreshold(){return this._userSettings.maxZoomThreshold}set loopExtra(t){this._loopExtra=t}set stepExtra(t){this._stepExtra=t}set selectedMaterial(t){return this.updateSelectedMaterial(t)}set isRunning(t){this._isRunning=t}set brushType(t){return this.updateBrushType(t)}set sidePriority(t){return this.updateSidePriority(t)}set backStepSavingMaxCount(t){this._backStepSavingMaxCount=t}set mapGridRenderStyles(t){this._mapGridRenderStyles=t}set mapBorderRenderStyles(t){return this._mapBorderRenderStyles=t}set showGrid(t){this._userSettings.showGrid=t}set showBorder(t){this._userSettings.showBorder=t}set smoothDrawingEnabled(t){this._userSettings.smoothDrawingEnabled=t}set visualEffectsEnabled(t){this._userSettings.visualEffectsEnabled=t}set warningsDisabled(t){this._userSettings.warningsDisabled=t}set aimedFPS(t){this._CVS.fpsLimit=t}set autoSimulationSizing(t){this._userSettings.autoSimulationSizing=t,t&&this.autoFitSize(t)}set dragAndZoomCanvasEnabled(t){this._userSettings.dragAndZoomCanvasEnabled=t,t||CVS.resetTransformations(!0)}set minZoomThreshold(t){this._userSettings.minZoomThreshold=t}set maxZoomThreshold(t){this._userSettings.maxZoomThreshold=t}set zoomInIncrement(t){this._userSettings.zoomInIncrement=t}set zoomOutIncrement(t){this._userSettings.zoomOutIncrement=t}}return{SETTINGS:f,DEFAULT_KEYBINDS:F,PhysicsCore:B,MapGrid:x,Simulation:w,FPSCounter:e,CDEUtils:t}});